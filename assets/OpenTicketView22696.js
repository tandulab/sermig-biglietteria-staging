import{o as L,c as h,a as z,p as x,i as j,_ as S,r as b,q,b as v,e as g,f as a,w as m,h as U,t as F,g as s,F as C,N as D,n as E,v as H,s as A,H as W,u as G}from"../index22696.js";import{u as J,g as K,i as Q,a as X,b as Y}from"./location22696.js";import{u as Z,e as O,s as ee}from"./helpers22696.js";const te={props:["filters"],setup(o,e){L(()=>{l.value=!0,k.value={first:0,rows:_.value.rows,sortField:null,sortOrder:null},k.value.page=0,o.filters.location&&T()});const d=J(),t=K(),y=h(()=>d.responseOrders),w=h(()=>d.status),{showLoader:n,hideLoader:f}=Z(),p=z(),_=x(),c=x(),i=x(),l=x(!0),k=x(),N=x(0);function T(){l.value=!0;let r=new Map;for(const u in o.filters)o.filters[u]&&(u=="location"&&o.filters.location.permalink?r.set("location_permalink",o.filters.location.permalink.trim()):r.set(u,o.filters[u].trim()));r.set("page",k.value.page+1),r.set("per_page",k.value.rows),setTimeout(()=>{B(r)},Math.random()*1e3+250)}const B=async function(r){await d.fetchOrderWithOpenTicket(r).then(()=>{l.value=!1}).catch(u=>{l.value=!1,O(p,u)})},P=async function(r){l.value=!0;const u={ticket_id:r.id,location:o.filters.location.permalink,used:r.used};await d.useOpenTicket(u).then(()=>{l.value=!1,ee(p,{message:"Stato aggiornato correttamente",error:!1}),T()}).catch(V=>{l.value=!1,O(p,V)})},R=r=>{i.value.toggle(r)},$=function(r){const u={course_name:r.course_name,start_at:r.start_at};e.emit("updateFilters",u),t.setNewOrderDialogVisibility(!0)},I=function(r){const u=new Map;u.set("id",r.id),u.set("location_permalink",o.filters.location.permalink),n(),d.downloadTicket(u).then(()=>{f()}).catch(V=>{f(),O(p,V)})},M=r=>{k.value=r,T()};return j(o.filters,()=>{T()}),{dt:_,responseOrders:y,loading:l,totalRecords:N,lazyParams:k,currentOrder:c,status:w,op:i,dialogStore:t,loadLazyData:T,onChangeUsedStatus:P,toggle:R,openDialog:$,downloadPDF:I,onPage:M,formatDataFromUnixTimestamps:Q}}};const oe={class:"order-table"},le={class:"flex flex-column align-items-center"},ne={key:0,class:"pi pi-exclamation-triangle cursor-pointer",style:{color:"#ff6767"}},ae={class:"flex flex-column align-items-center"};function se(o,e,d,t,y,w){const n=b("Column"),f=b("Checkbox"),p=b("Button"),_=b("DataTable"),c=q("tooltip");return v(),g("div",oe,[a(_,{value:t.responseOrders.orders,totalRecords:t.responseOrders.total,lazy:!0,paginator:!0,ref:"dt",rows:30,loading:t.loading,stripedRows:"",onPage:e[0]||(e[0]=i=>t.onPage(i))},{empty:m(()=>e[1]||(e[1]=[U(" Nessuna prenotazione trovata. ",-1)])),default:m(()=>[a(n,{header:"Codice ordine",field:"reservation_number",ref:"reservation_number"},null,512),a(n,{header:"Email",field:"email",ref:"email"},null,512),a(n,{header:"Data acquisto",field:"created_at",ref:"created_at"},{body:m(({data:i})=>[U(F(t.formatDataFromUnixTimestamps(i.created_at)),1)]),_:1},512),a(n,null,{header:m(()=>e[2]||(e[2]=[s("div",{class:"w-full text-center"},"Numero ticket",-1)])),body:m(({data:i})=>[s("div",le,F(i.tickets_number),1)]),_:1}),a(n,{header:"Codice ticket"},{body:m(({data:i})=>[(v(!0),g(C,null,D(i.codes,l=>(v(),g("div",{key:l.code,class:E(["py-1",l.used?"used":""])},F(l.code),3))),128))]),_:1}),a(n,null,{header:m(()=>e[3]||(e[3]=[s("div",{class:"w-full text-center"},"Scaduto",-1)])),body:m(({data:i})=>[(v(!0),g(C,null,D(i.codes,l=>(v(),g("div",{key:l.code,class:"py-1 flex flex-column align-items-center"},[l.expired?H((v(),g("i",ne,null,512)),[[c,"Scaduto"]]):A("",!0)]))),128))]),_:1}),a(n,null,{header:m(()=>e[4]||(e[4]=[s("div",{class:"w-full text-center"},"Utilizzato",-1)])),body:m(({data:i})=>[(v(!0),g(C,null,D(i.codes,l=>(v(),g("div",{key:l.code,class:"py-1 flex flex-column align-items-center"},[a(f,{disabled:l.expired,modelValue:l.used,"onUpdate:modelValue":k=>l.used=k,binary:!0,onChange:k=>t.onChangeUsedStatus(l),class:"check_in"},null,8,["disabled","modelValue","onUpdate:modelValue","onChange"])]))),128))]),_:1}),a(n,null,{header:m(()=>e[5]||(e[5]=[s("div",{class:"w-full text-center"},"PDF",-1)])),body:m(({data:i})=>[s("div",ae,[a(p,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",icon:"pi pi-download",text:"",rounded:"",onClick:l=>t.downloadPDF(i)},null,8,["onClick"])])]),_:1})]),_:1},8,["value","totalRecords","loading"])])}const re=S(te,[["render",se]]),ie={setup(o,e){const d=x({});return{form:d,resetField:function(){d.value.reservation_number=null,d.value.ticket_code=null,d.value.email=null,e.emit("onSubmit",d.value)}}}},ce={class:"formgrid grid px-0 align-items-center"},de={class:"field col-3 flex flex-column"},ue={class:"field col-3 flex flex-column"},me={class:"field col-3 flex flex-column"},fe={class:"flex col-12 justify-content-end mt-1"};function pe(o,e,d,t,y,w){const n=b("InputText"),f=b("Button"),p=b("AccordionTab"),_=b("Accordion");return v(),W(_,{activeIndex:0},{default:m(()=>[a(p,{header:"FILTRI"},{default:m(()=>[s("div",ce,[s("div",de,[e[5]||(e[5]=s("label",{for:"typology"},"Filtra per codice prenotazione",-1)),a(n,{modelValue:t.form.reservation_number,"onUpdate:modelValue":e[0]||(e[0]=c=>t.form.reservation_number=c),placeholder:""},null,8,["modelValue"])]),s("div",ue,[e[6]||(e[6]=s("label",{for:"typology"},"Filtra per codice ticket",-1)),a(n,{modelValue:t.form.ticket_code,"onUpdate:modelValue":e[1]||(e[1]=c=>t.form.ticket_code=c),placeholder:""},null,8,["modelValue"])]),s("div",me,[e[7]||(e[7]=s("label",{for:"typology"},"Filtra per email",-1)),a(n,{modelValue:t.form.email,"onUpdate:modelValue":e[2]||(e[2]=c=>t.form.email=c),placeholder:""},null,8,["modelValue"])])]),s("div",fe,[a(f,{label:"Ricerca",class:"mr-2",onClick:e[3]||(e[3]=c=>o.$emit("onSubmit",t.form))}),a(f,{label:"Annulla",class:"p-button-outlined",onClick:e[4]||(e[4]=c=>t.resetField())})])]),_:1})]),_:1})}const _e=S(ie,[["render",pe]]),ve={setup(){L(()=>{f.value&&(o.value.location=f.value),p()});const o=x({}),e=x(),d=G(),t=X(),y=z(),w=h(()=>d.currentUser),n=h(()=>t.allLocations),f=h(()=>t.getCurrentLocation),p=async function(){await t.fetchAllLocations().then(()=>{f.value||(o.value.location=n.value[0],t.updateCurrenLocation(n.value[0]))}).catch(c=>{O(y,c)})};return{filters:o,orderTable:e,user:w,locations:n,fetchAllLocations:p,formatDate:Y,onUpdateFilters:function(c){let i=o.value.location.permalink;o.value.reservation_number=c.reservation_number,o.value.location.permalink=i,o.value.ticket_code=c.ticket_code,o.value.email=c.email}}},components:{OpenTicketTable:re,OpenTicketFilter:_e}};const be={class:"flex justify-content-between align-items-center"},ge={class:"field flex flex-column mt-3"},ke={key:0,style:{color:"#495057"}},xe={class:"capitalize text-xl"},ye={class:"flex gap-4"},we={class:"col-12 mt-3"};function Te(o,e,d,t,y,w){const n=b("Dropdown"),f=b("OpenTicketFilter"),p=b("OpenTicketTable");return v(),g("div",null,[s("div",be,[s("div",ge,[a(n,{modelValue:t.filters.location,"onUpdate:modelValue":e[0]||(e[0]=_=>t.filters.location=_),options:t.locations,optionLabel:"name",placeholder:"Filtra per location",class:"location"},null,8,["modelValue","options"])]),t.filters&&t.filters.date?(v(),g("div",ke,[e[2]||(e[2]=s("i",{class:"pi pi-calendar mr-2 text-xl"},null,-1)),s("span",xe,F(t.formatDate(t.filters.date)),1)])):A("",!0)]),s("div",ye,[s("div",we,[a(f,{onOnSubmit:e[1]||(e[1]=_=>t.onUpdateFilters(_))}),a(p,{filters:t.filters,ref:"orderTable",class:"mt-4"},null,8,["filters"])])])])}const Ve=S(ve,[["render",Te]]);export{Ve as default};
