import{l as De,m as Ce,o as Y,p as D,a as $,c as M,_ as Q,r as C,q as pe,b as f,e as g,g as l,f as i,n as J,t as w,w as x,s as L,F as te,h as F,v as ce,x as Pe,B as Me,C as fe,Z as xe,D as ie,y as dt,O as ut,z as mt,A as ft,E as pt,G as _t,H as W,I as ge,J as re,K as Te,L as Le,T as vt,M as yt,i as le,N as he,P as gt,Q as je,u as ht}from"../index17073.js";import{u as oe,a as _e,f as Fe,b as Se,c as bt,d as kt,e as Ve,g as be,h as Ue,i as Ct,D as de,j as Ae}from"./location17073.js";import{u as me,s as Z,e as E,p as Ee,a as wt,b as Oe,c as ke,d as Re}from"./helpers17073.js";import{F as xt}from"./vee-validate.esm17073.js";class Ne{static async fetchAll(e){const n=e.location_permalink;return delete e.location_permalink,(await De(`/ticket_office/${n}/search/tickets`,e)).data}static async fetchAllOpenTickets(e){const n=e.location_permalink;return delete e.location_permalink,(await De(`/ticket_office/${n}/orders/search_codes`,e)).data}}const we=Ce({id:"ticket",state:()=>({ticket:{},tickets:[],response_tickets:{},open_tickets_codes:{}}),getters:{allTickets:o=>o.response_tickets.available_ticket_types,allOpenTickets:o=>o.open_tickets_codes.open_tickets,responseTickets:o=>o.response_tickets,getTotalTickets:o=>o.response_tickets?o.response_tickets.total:0,getCurrentTicket:o=>o.ticket},actions:{async fetchAllTickets(o){await Ne.fetchAll(o).then(e=>this.response_tickets=e)},async fetchAllOpenTickets(o){await Ne.fetchAllOpenTickets(o).then(e=>this.open_tickets_codes=e)}}}),Dt={computed:{Code(){return Code}},props:["location_permalink","time_slot"],setup(o,e){Y(()=>{n.value=Object.assign({},o.time_slot)});const n=D({}),t=we(),v=oe(),{showLoader:p,hideLoader:a}=me(),u=$(),b=D(),m=D(),c=M(()=>t.allOpenTickets),d=M(()=>v.paymentStatus),h=M(()=>v.paymentModeList),y=M(()=>{const O=v.getPaymentMethods;return Object.entries(O).map(([r,S])=>({id:r,label:S}))}),s=M(()=>v.getCurrentOrder),V=async function(O){const r={code:O.query.toUpperCase(),location_permalink:o.location_permalink};await t.fetchAllOpenTickets(r)},R=async function(){var r,S;const O={id:o.location_permalink,order_id:n.value.id,status:(r=n.value)==null?void 0:r.status,payment_method:n.value.payment_method,open_ticket_codes:[],api_version:"v2",notes:(S=n.value)==null?void 0:S.notes};if(n.value.status&&n.value.status=="payed"&&!n.value.payment_method){b.value="Seleziona un metodo di pagamento";return}for(const k of n.value.open_tickets_used)if(k.expired){m.value="Uno o più codici biglietto risultano scaduti";return}if(n.value.open_tickets_used&&n.value.open_tickets_used.length>0){let k=[];n.value.open_tickets_used.forEach(B=>{k.push(B.code)}),O.open_ticket_codes=k}j(O)},j=async function(O){p(),await v.updateOrder(O).then(()=>{a(),Z(u,{message:"Stato aggiornato correttamente",error:!1}),e.emit("closeDialog",s.value)}).catch(r=>{a(),E(u,r)})};return{form:n,open_tickets:c,paymentList:d,paymentModeList:h,changeStatus:R,errorMessage:b,errorMessageVoucher:m,dynamicPaymentMethods:y,fetchAllOpenTickets:V,onChangeStatus:function(){(n.value.status=="free"||n.value.status=="to_pay")&&(n.value.payment_method=null)}}}},Ot={key:0,class:"formgrid grid flex-column mt-3"},St={class:"field col-12"},Vt={class:"field col-12"},Tt={class:"p-error",id:"dd-error"},Lt={key:0,class:"field col-12 flex flex-column"},At={key:0,class:"pi pi-exclamation-triangle",style:{color:"#ff6767"}},Nt={class:"p-error",id:"dd-error"},Pt={class:"flex align-items-center justify-content-end mt-3"};function Mt(o,e,n,t,v,p){const a=C("Dropdown"),u=C("AutoComplete"),b=C("Button"),m=pe("tooltip");return f(),g(te,null,[t.form?(f(),g("div",Ot,[l("div",St,[e[9]||(e[9]=l("label",{for:"status"},"Stato pagamento",-1)),i(a,{modelValue:t.form.status,"onUpdate:modelValue":e[0]||(e[0]=c=>t.form.status=c),options:t.paymentList,optionLabel:"name",optionValue:"id",class:"w-full",onChange:e[1]||(e[1]=c=>t.onChangeStatus())},null,8,["modelValue","options"])]),l("div",Vt,[e[10]||(e[10]=l("label",{for:"payment_method"},"Modalità pagamento",-1)),i(a,{modelValue:t.form.payment_method,"onUpdate:modelValue":e[2]||(e[2]=c=>t.form.payment_method=c),options:t.dynamicPaymentMethods,optionLabel:"label",optionValue:"id",class:J(["w-full",{"p-invalid":t.errorMessage}]),disabled:t.form.status!="payed",onChange:e[3]||(e[3]=c=>t.errorMessage=null)},null,8,["modelValue","options","disabled","class"]),l("small",Tt,w(t.errorMessage||" "),1)]),t.form.payment_method=="voucher"&&t.form.status=="payed"?(f(),g("div",Lt,[e[11]||(e[11]=l("label",{for:"user_zip"},"Codice biglietto",-1)),i(u,{modelValue:t.form.open_tickets_used,"onUpdate:modelValue":e[4]||(e[4]=c=>t.form.open_tickets_used=c),suggestions:t.open_tickets,class:J(["uppercase w-full",{"p-invalid":t.errorMessageVoucher}]),onComplete:e[5]||(e[5]=c=>t.fetchAllOpenTickets(c)),emptySearchMessage:"Nessun risultato",emptySelectionMessage:"Nessun risultato",optionLabel:"code",optionValue:"code",multiple:"",onChange:e[6]||(e[6]=c=>t.errorMessageVoucher=null)},{option:x(({option:c})=>[l("span",{class:"flex flex-row justify-content-between",style:Pe({color:c.expired?"#ff6767":null})},[F(w(c.code)+" ",1),c.expired?ce((f(),g("i",At,null,512)),[[m,"Scaduto"]]):L("",!0)],4)]),_:1},8,["modelValue","suggestions","class"]),l("small",Nt,w(t.errorMessageVoucher||" "),1)])):L("",!0)])):L("",!0),l("div",Pt,[i(b,{label:"Annulla",text:"",onClick:e[7]||(e[7]=c=>o.$emit("closeDialog",null))}),i(b,{label:"Conferma",onClick:e[8]||(e[8]=c=>t.changeStatus())})])],64)}const jt=Q(Dt,[["render",Mt]]);var Ft={root:function(e){var n=e.instance;return["p-confirm-popup p-component",{"p-ripple-disabled":n.$primevue.config.ripple===!1}]},content:"p-confirm-popup-content",icon:"p-confirm-popup-icon",message:"p-confirm-popup-message",footer:"p-confirm-popup-footer",rejectButton:function(e){var n=e.instance;return["p-confirm-popup-reject",n.confirmation&&!n.confirmation.rejectClass?"p-button-sm p-button-text":null]},acceptButton:function(e){var n=e.instance;return["p-confirm-popup-accept",n.confirmation&&!n.confirmation.acceptClass?"p-button-sm":null]}},Ut=Me.extend({name:"confirmpopup",classes:Ft}),Et={name:"BaseConfirmPopup",extends:_t,props:{group:String},style:Ut,provide:function(){return{$parentInstance:this}}},Be={name:"ConfirmPopup",extends:Et,inheritAttrs:!1,data:function(){return{visible:!1,confirmation:null,autoFocusAccept:null,autoFocusReject:null,target:null}},target:null,outsideClickListener:null,scrollHandler:null,resizeListener:null,container:null,confirmListener:null,closeListener:null,mounted:function(){var e=this;this.confirmListener=function(n){n&&n.group===e.group&&(e.confirmation=n,e.target=n.target,e.confirmation.onShow&&e.confirmation.onShow(),e.visible=!0)},this.closeListener=function(){e.visible=!1,e.confirmation=null},fe.on("confirm",this.confirmListener),fe.on("close",this.closeListener)},beforeUnmount:function(){fe.off("confirm",this.confirmListener),fe.off("close",this.closeListener),this.unbindOutsideClickListener(),this.scrollHandler&&(this.scrollHandler.destroy(),this.scrollHandler=null),this.unbindResizeListener(),this.container&&(xe.clear(this.container),this.container=null),this.target=null,this.confirmation=null},methods:{accept:function(){this.confirmation.accept&&this.confirmation.accept(),this.visible=!1},reject:function(){this.confirmation.reject&&this.confirmation.reject(),this.visible=!1},onHide:function(){this.confirmation.onHide&&this.confirmation.onHide(),this.visible=!1},onAcceptKeydown:function(e){(e.code==="Space"||e.code==="Enter"||e.code==="NumpadEnter")&&(this.accept(),ie.focus(this.target),e.preventDefault())},onRejectKeydown:function(e){(e.code==="Space"||e.code==="Enter"||e.code==="NumpadEnter")&&(this.reject(),ie.focus(this.target),e.preventDefault())},onEnter:function(e){this.autoFocusAccept=this.confirmation.defaultFocus===void 0||this.confirmation.defaultFocus==="accept",this.autoFocusReject=this.confirmation.defaultFocus==="reject",this.target=document.activeElement,this.bindOutsideClickListener(),this.bindScrollListener(),this.bindResizeListener(),xe.set("overlay",e,this.$primevue.config.zIndex.overlay)},onAfterEnter:function(){this.focus()},onLeave:function(){this.autoFocusAccept=null,this.autoFocusReject=null,ie.focus(this.target),this.target=null,this.unbindOutsideClickListener(),this.unbindScrollListener(),this.unbindResizeListener()},onAfterLeave:function(e){xe.clear(e)},alignOverlay:function(){ie.absolutePosition(this.container,this.target,!1);var e=ie.getOffset(this.container),n=ie.getOffset(this.target),t=0;e.left<n.left&&(t=n.left-e.left),this.container.style.setProperty("--overlayArrowLeft","".concat(t,"px")),e.top<n.top&&(this.container.setAttribute("data-p-confirm-popup-flipped","true"),!this.isUnstyled&&ie.addClass(this.container,"p-confirm-popup-flipped"))},bindOutsideClickListener:function(){var e=this;this.outsideClickListener||(this.outsideClickListener=function(n){e.visible&&e.container&&!e.container.contains(n.target)&&!e.isTargetClicked(n)?(e.confirmation.onHide&&e.confirmation.onHide(),e.visible=!1):e.alignOverlay()},document.addEventListener("click",this.outsideClickListener))},unbindOutsideClickListener:function(){this.outsideClickListener&&(document.removeEventListener("click",this.outsideClickListener),this.outsideClickListener=null)},bindScrollListener:function(){var e=this;this.scrollHandler||(this.scrollHandler=new dt(this.target,function(){e.visible&&(e.visible=!1)})),this.scrollHandler.bindScrollListener()},unbindScrollListener:function(){this.scrollHandler&&this.scrollHandler.unbindScrollListener()},bindResizeListener:function(){var e=this;this.resizeListener||(this.resizeListener=function(){e.visible&&!ie.isTouchDevice()&&(e.visible=!1)},window.addEventListener("resize",this.resizeListener))},unbindResizeListener:function(){this.resizeListener&&(window.removeEventListener("resize",this.resizeListener),this.resizeListener=null)},focus:function(){var e=this.container.querySelector("[autofocus]");e&&e.focus({preventScroll:!0})},isTargetClicked:function(e){return this.target&&(this.target===e.target||this.target.contains(e.target))},containerRef:function(e){this.container=e},onOverlayClick:function(e){ut.emit("overlay-click",{originalEvent:e,target:this.target})},onOverlayKeydown:function(e){e.code==="Escape"&&(fe.emit("close",this.closeListener),ie.focus(this.target))},getCXOptions:function(e,n){return{contenxt:{icon:e,iconClass:n.class}}}},computed:{message:function(){return this.confirmation?this.confirmation.message:null},acceptLabel:function(){return this.confirmation?this.confirmation.acceptLabel||this.$primevue.config.locale.accept:null},rejectLabel:function(){return this.confirmation?this.confirmation.rejectLabel||this.$primevue.config.locale.reject:null},acceptIcon:function(){return this.confirmation?this.confirmation.acceptIcon:null},rejectIcon:function(){return this.confirmation?this.confirmation.rejectIcon:null}},components:{CPButton:mt,Portal:ft},directives:{focustrap:pt}},Rt=["aria-modal"];function Bt(o,e,n,t,v,p){var a=C("CPButton"),u=C("Portal"),b=pe("focustrap");return f(),W(u,null,{default:x(function(){return[i(vt,re({name:"p-confirm-popup",onEnter:p.onEnter,onAfterEnter:p.onAfterEnter,onLeave:p.onLeave,onAfterLeave:p.onAfterLeave},o.ptm("transition")),{default:x(function(){return[v.visible?ce((f(),g("div",re({key:0,ref:p.containerRef,role:"alertdialog",class:o.cx("root"),"aria-modal":v.visible,onClick:e[2]||(e[2]=function(){return p.onOverlayClick&&p.onOverlayClick.apply(p,arguments)}),onKeydown:e[3]||(e[3]=function(){return p.onOverlayKeydown&&p.onOverlayKeydown.apply(p,arguments)})},o.ptmi("root")),[o.$slots.container?ge(o.$slots,"container",{key:0,message:v.confirmation,onAccept:p.accept,onReject:p.reject,acceptCallback:p.accept,rejectCallback:p.reject}):(f(),g(te,{key:1},[o.$slots.message?(f(),W(Te(o.$slots.message),{key:1,message:v.confirmation},null,8,["message"])):(f(),g("div",re({key:0,class:o.cx("content")},o.ptm("content")),[ge(o.$slots,"icon",{},function(){return[o.$slots.icon?(f(),W(Te(o.$slots.icon),{key:0,class:J(o.cx("icon"))},null,8,["class"])):v.confirmation.icon?(f(),g("span",re({key:1,class:[v.confirmation.icon,o.cx("icon")]},o.ptm("icon")),null,16)):L("",!0)]}),l("span",re({class:o.cx("message")},o.ptm("message")),w(v.confirmation.message),17)],16)),l("div",re({class:o.cx("footer")},o.ptm("footer")),[i(a,{label:p.rejectLabel,onClick:e[0]||(e[0]=function(m){return p.reject()}),onKeydown:p.onRejectKeydown,autofocus:v.autoFocusReject,class:J([o.cx("rejectButton"),v.confirmation.rejectClass]),unstyled:o.unstyled,pt:o.ptm("rejectButton")},Le({_:2},[p.rejectIcon||o.$slots.rejecticon?{name:"icon",fn:x(function(m){return[ge(o.$slots,"rejecticon",{},function(){return[l("span",re({class:[p.rejectIcon,m.class]},o.ptm("rejectButton").icon,{"data-pc-section":"rejectbuttonicon"}),null,16)]})]}),key:"0"}:void 0]),1032,["label","onKeydown","autofocus","class","unstyled","pt"]),i(a,{label:p.acceptLabel,onClick:e[1]||(e[1]=function(m){return p.accept()}),onKeydown:p.onAcceptKeydown,autofocus:v.autoFocusAccept,class:J([o.cx("acceptButton"),v.confirmation.acceptClass]),unstyled:o.unstyled,pt:o.ptm("acceptButton")},Le({_:2},[p.acceptIcon||o.$slots.accepticon?{name:"icon",fn:x(function(m){return[ge(o.$slots,"accepticon",{},function(){return[l("span",re({class:[p.acceptIcon,m.class]},o.ptm("acceptButton").icon,{"data-pc-section":"acceptbuttonicon"}),null,16)]})]}),key:"0"}:void 0]),1032,["label","onKeydown","autofocus","class","unstyled","pt"])],16)],64))],16,Rt)),[[b]]):L("",!0)]}),_:3},16,["onEnter","onAfterEnter","onLeave","onAfterLeave"])]}),_:3})}Be.render=Bt;const It={props:["order"],setup(o,{emit:e}){Y(()=>{r.value&&O.value&&r.value.forEach(U=>{U.permalink===O.value&&(a.value=U.name)})});const n=D(0),t=D([]),v=D(!1),p=D(!0),a=D(),u=yt(),b=D([]),m=D({}),c=D(null),d=D(!1),h=D({...o.order});le(()=>o.order,U=>{Object.assign(h,U)});const y=we(),s=oe(),V=$(),R=_e(),j=M(()=>y.allTickets),T=M(()=>s.getCurrentOrder),O=M(()=>R.getCurrentLocation),r=M(()=>R.allLocations),S=M(()=>{const U=o.order.payment_method,I=s.getPaymentMethods;return U?I[U]:"-"}),k=M(()=>{const U=s.getPaymentMethods;return Object.entries(U).map(([I,q])=>({id:I,label:q}))}),B=M(()=>s.paymentMethodAccountList),ue=[{label:"Acconto",value:"deposit"},{label:"Saldo",value:"balance"}],A=U=>U==="deposit"?"Acconto":U==="balance"?"Saldo":"-",z=(U,I)=>{c.value=U,u.require({target:I.currentTarget,message:"Sei sicuro di voler eliminare questo acconto?",icon:"pi pi-info-circle",rejectClass:"p-button-secondary p-button-outlined p-button-sm",acceptClass:"p-button-danger p-button-sm",rejectLabel:"Annulla",acceptLabel:"Elimina",accept:async()=>{var q;await s.deletePayment({location:((q=O.value)==null?void 0:q.permalink)??"",id:o.order.id,payment_id:c.value.id}),await se(),Z(V,{message:"Acconto eliminato con successo",error:!1})}})},H=function(){let U={amount:"",payment_method:"",typology:"",id:"-1"};h.value.payments.push(U),b.value.push(U)},ae=async function(U){var I,q;d.value=!0;try{let{newData:X}=U;const ve={amount:X.amount,payment_method:X.payment_method,typology:X.typology};X.id!=-1?await s.updatePayment({location:((I=O.value)==null?void 0:I.permalink)??"",id:o.order.id,payment_id:X.id,payment:ve}):await s.createPayment({location:((q=O.value)==null?void 0:q.permalink)??"",id:o.order.id,payment:ve}),await se()}catch(X){E(V,X)}finally{d.value=!1}},ne=function(U,I){m.value.payments.splice(I,1)},se=async function(){var U;try{const I=await s.getPayment({location:((U=O.value)==null?void 0:U.permalink)??"",id:o.order.id});h.value.payments.splice(0,h.value.payments.length,...I.payments),h.value.paid_amount=I.paid_amount,h.value.remaining_amount=I.remaining_amount}catch{h.value.remaining_amount="0.0",h.value.paid_amount="0.0",h.value.payments=[]}};return{tickets:j,active:n,partialTotals:t,showOrderDetail:v,currentOrder:T,showSecondTab:p,currentLocation:O,selectedLocation:a,editingRows:b,localOrder:h,loadingPayments:d,formatExplicitDate:Fe,formatDate:Se,confirm1:z,addAmount:H,onRowEditSave:ae,deleteSlot:ne,dynamicPaymentMethods:k,typologyOptions:ue,getPayments:se,paymentMethodAccountList:B,prettyPaymentStatus:Ee,formatPrettyDate:bt,formatDataAndHourFromUnixTimestamps:kt,prettyPaymentMethod:wt,methodLabel:S,prettyTypology:A}},components:{ConfirmPopup:Be}};const zt={class:"mt-3 line-height-3"},qt={class:"flex gap-3"},Ht={class:"m-0 mb-1"},Kt={class:"m-0 mb-1"},Jt={class:"m-0 mb-1"},Gt={class:"m-0 mb-1"},Wt={key:0},Qt={class:"flex gap-3 mt-4"},Xt={class:"m-0 mb-1"},Zt={class:"m-0 mb-1"},Yt={key:0,class:"m-0 mb-1"},$t={class:"flex gap-3 mt-4"},eo={class:"m-0 mb-1"},to={class:"m-0 mb-1"},oo={class:"m-0 mb-1"},no={key:0,class:"m-0 mb-1"},lo={key:1,class:"m-0 mb-1"},io={key:2,class:"m-0 mb-1"},ao={class:"m-0 mb-1"},so={class:"m-0 mb-1"},ro={key:0},co={key:1},uo={class:"m-0 mb-1"},mo={key:0},fo={key:1},po={class:"m-0 mb-1"},_o={key:0},vo={key:1},yo={class:"ml-5"},go={class:"field flex justify-content-between align-items-end mt-4 mb-3"},ho={key:1,class:"flex gap-3 mt-4"};function bo(o,e,n,t,v,p){const a=C("Badge"),u=C("Button"),b=C("InputNumber"),m=C("Column"),c=C("Dropdown"),d=C("DataTable"),h=C("ConfirmPopup");return f(),g("div",zt,[l("div",qt,[e[3]||(e[3]=l("i",{class:"pi pi-user mt-1"},null,-1)),l("div",null,[l("p",Ht,w(n.order.user_name)+" "+w(n.order.user_surname||"-"),1),l("p",Kt,w(n.order.user_email),1),l("p",Jt,w(n.order.user_phone),1),l("p",Gt,[F(w(n.order.country)+" ",1),n.order.user_zip?(f(),g("span",Wt," - "+w(n.order.user_zip),1)):L("",!0)])])]),l("div",Qt,[e[4]||(e[4]=l("i",{class:"pi pi-map-marker mt-1"},null,-1)),l("div",null,[l("p",Xt,w(t.selectedLocation),1),l("p",Zt,w(n.order.course_name),1),n.order.date?(f(),g("p",Yt,w(t.formatPrettyDate(n.order.date))+" "+w(n.order.start_at),1)):L("",!0)])]),l("div",$t,[e[8]||(e[8]=l("i",{class:"pi pi-shopping-cart mt-1"},null,-1)),l("div",null,[l("p",eo,w(n.order.reservation_number),1),l("p",to,w(t.formatDataAndHourFromUnixTimestamps(n.order.created_at)),1),l("p",oo,w(n.order.created_by),1),n.order.status?(f(),g("p",no,[i(a,{value:t.prettyPaymentStatus(n.order.status),class:J([n.order.status,"px-3 border-round-lg"])},null,8,["value","class"])])):L("",!0),n.order.status=="payed"?(f(),g("p",lo,w(t.methodLabel),1)):L("",!0),n.order.open_tickets_used&&n.order.status=="payed"?(f(),g("p",io,[(f(!0),g(te,null,he(n.order.open_tickets_used,y=>(f(),g("span",{key:y},[i(a,{value:y.code,class:"mr-2 voucher"},null,8,["value"])]))),128))])):L("",!0),l("p",ao,"Codice sconto utilizzato: "+w(t.localOrder.discount_code||"-"),1),l("p",so,[e[5]||(e[5]=F(" Totale ordine: ",-1)),t.localOrder.total?(f(),g("span",ro,"€ "+w((+t.localOrder.total).toFixed(2)),1)):(f(),g("span",co,"-"))]),t.localOrder.multi_payment&&t.localOrder.paid_amount!="0.0"?(f(),g(te,{key:3},[l("p",uo,[e[6]||(e[6]=F(" Acconto versato: ",-1)),t.localOrder.paid_amount?(f(),g("span",mo,"€ "+w((+t.localOrder.paid_amount).toFixed(2)),1)):(f(),g("span",fo,"-"))]),l("p",po,[e[7]||(e[7]=F(" Saldo rimanente: ",-1)),t.localOrder.remaining_amount?(f(),g("span",_o,"€ "+w((+t.localOrder.remaining_amount).toFixed(2)),1)):(f(),g("span",vo,"-"))])],64)):t.localOrder.multi_payment&&(!t.localOrder.payments||t.localOrder.payments.length===0)?(f(),W(u,{key:4,label:"Acconto / Saldo",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[0]||(e[0]=y=>t.addAmount()),class:"mt-2"})):L("",!0)])]),t.localOrder.payments&&t.localOrder.payments.length?(f(),g(te,{key:0},[l("div",yo,[l("div",go,[e[9]||(e[9]=l("label",null,"Pagamenti",-1)),t.localOrder.remaining_amount!=="0.0"?(f(),W(u,{key:0,label:"Acconto / Saldo",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[1]||(e[1]=y=>t.addAmount())})):L("",!0)]),i(d,{value:t.localOrder.payments,dataKey:"id",size:"small",editingRows:t.editingRows,"onUpdate:editingRows":e[2]||(e[2]=y=>t.editingRows=y),editMode:"row",onRowEditSave:t.onRowEditSave,loading:t.loadingPayments},{default:x(()=>[i(m,{field:"amount",header:"Importo"},{editor:x(({data:y,field:s})=>[i(b,{modelValue:y[s],"onUpdate:modelValue":V=>y[s]=V,inputId:"currency-germany",mode:"currency",currency:"EUR",locale:"it-IT",class:"w-full"},null,8,["modelValue","onUpdate:modelValue"])]),body:x(y=>[F(w(y.data.amount?Number(y.data.amount).toFixed(2):"0.00")+" € ",1)]),_:1}),i(m,{field:"paid_at",header:"Data pagamento"},{body:x(y=>[F(w(y.data.paid_at),1)]),editor:x(({data:y,field:s})=>[F(w(y[s]),1)]),_:1}),i(m,{field:"payment_method",header:"Metodo"},{editor:x(({data:y,field:s})=>[i(c,{modelValue:y[s],"onUpdate:modelValue":V=>y[s]=V,options:t.dynamicPaymentMethods,optionLabel:"label",optionValue:"id",class:"w-full",placeholder:"Seleziona metodo..."},null,8,["modelValue","onUpdate:modelValue","options"])]),body:x(y=>[F(w(t.prettyPaymentMethod(y.data.payment_method)),1)]),_:1}),i(m,{field:"typology",header:"Tipologia"},{editor:x(({data:y,field:s})=>[i(c,{modelValue:y[s],"onUpdate:modelValue":V=>y[s]=V,options:t.typologyOptions,optionLabel:"label",optionValue:"value",class:"w-full",placeholder:"Seleziona tipologia"},null,8,["modelValue","onUpdate:modelValue","options"])]),body:x(y=>[F(w(t.prettyTypology(y.data.typology)),1)]),_:1}),i(m,{rowEditor:!0,style:{width:"8rem"},bodyStyle:"text-align:right"}),i(m,{header:""},{body:x(y=>[y.data.id!=="-1"?(f(),W(u,{key:0,icon:"pi pi-trash",class:"p-button-text p-button-sm p-button-danger",onClick:s=>t.confirm1(y.data,s)},null,8,["onClick"])):L("",!0)]),_:1})]),_:1},8,["value","editingRows","onRowEditSave","loading"])]),i(h)],64)):L("",!0),n.order.notes?(f(),g("div",ho,[e[10]||(e[10]=l("i",{class:"pi pi-comment mt-1"},null,-1)),l("div",null,w(n.order.notes),1)])):L("",!0)])}const ko=Q(It,[["render",bo]]),Co={props:["order","location_permalink"],setup(o,e){Y(()=>{o.order&&o.order.notes&&(n.value=o.order.notes)});const n=D(),{showLoader:t,hideLoader:v}=me(),p=$(),a=oe(),u=M(()=>a.getCurrentOrder);return{notes:n,updateOrder:async function(){const m={id:o.location_permalink,order_id:o.order.id,notes:n.value,api_version:"v2"};t(),await a.updateOrder(m).then(()=>{v(),Z(p,{message:"Nota aggiornata correttamente",error:!1}),e.emit("closeDialog",u.value)}).catch(c=>{v(),E(p,c)})}}}},wo={class:"pt-5 px-2"},xo={class:"flex align-items-center justify-content-end mt-3"};function Do(o,e,n,t,v,p){const a=C("Textarea"),u=C("Button");return f(),g("div",wo,[i(a,{modelValue:t.notes,"onUpdate:modelValue":e[0]||(e[0]=b=>t.notes=b),rows:"8",cols:"30",class:"w-full"},null,8,["modelValue"]),l("div",xo,[i(u,{label:"Annulla",text:"",onClick:e[1]||(e[1]=b=>o.$emit("closeDialog",null))}),i(u,{label:"Conferma",onClick:e[2]||(e[2]=b=>t.updateOrder())})])])}const Oo=Q(Co,[["render",Do]]),So={props:["order","location_permalink","date"],setup(o,e){Y(()=>{var d;o.order&&o.order.note&&(n.value=(d=o.order.note)==null?void 0:d.note)});const n=D(),{showLoader:t,hideLoader:v}=me(),p=$(),a=oe(),u=async function(){var h;const d={location:o.location_permalink,time_slot_note:{course_id:o.order.course_id,start_at:o.order.start_at,date:o.date,note:n.value}};(h=o.order.note)!=null&&h.id?b(d):m(d)},b=async function(d){t(),d.id=o.order.note.id,await a.updateNote(d).then(()=>{v(),Z(p,{message:"Nota aggiornata correttamente",error:!1}),e.emit("closeDialog",null)}).catch(h=>{v(),E(p,h)})},m=async function(d){t(),await a.createNote(d).then(()=>{v(),Z(p,{message:"Nota creata correttamente",error:!1}),e.emit("closeDialog",null)}).catch(h=>{v(),E(p,h)})};return{notes:n,addNote:u,deleteNote:async function(){const d={location:o.location_permalink,id:o.order.note.id};t(),await a.deleteNote(d).then(()=>{v(),Z(p,{message:"Nota eliminata correttamente",error:!1}),e.emit("closeDialog",null)}).catch(h=>{v(),E(p,h)})}}}},Vo={class:"pt-5 px-2"},To={class:"flex align-items-center justify-content-end mt-3"};function Lo(o,e,n,t,v,p){var b,m;const a=C("Textarea"),u=C("Button");return f(),g("div",Vo,[i(a,{modelValue:t.notes,"onUpdate:modelValue":e[0]||(e[0]=c=>t.notes=c),rows:"8",cols:"30",class:"w-full"},null,8,["modelValue"]),l("div",To,[(m=(b=n.order)==null?void 0:b.note)!=null&&m.id?(f(),W(u,{key:0,label:"Elimina",text:"",onClick:e[1]||(e[1]=c=>t.deleteNote()),severity:"danger",class:"mr-2"})):L("",!0),i(u,{label:"Conferma",onClick:e[2]||(e[2]=c=>t.addNote())})])])}const Ao=Q(So,[["render",Lo]]),No={props:["filters"],setup(o,e){Y(()=>{T.value=!0,O.value={first:0,rows:y.value.rows,sortField:null,sortOrder:null},O.value.page=0,o.filters.location&&ne()});const n=oe(),t=Ve(),v=M(()=>n.responseOrders),p=M(()=>n.status),a=gt(),u=M(()=>a.submitDialog),b=M(()=>n.paymentStatus),m=M(()=>n.getDeleteResponse),{showLoader:c,hideLoader:d}=me(),h=$(),y=D(),s=D(),V=D(),R=D(),j=D(),T=D(!0),O=D(),r=D(0),S=D([]),k=D([]),B=D(!1),ue=D(!1),A=D(),z=D(!1),H=D(!1),ae=D();function ne(){T.value=!0;let _=new Map;for(const N in o.filters){if(N=="date"){let P="";be(o.filters.date)=="Invalid DateTime"?P=Ue(o.filters.date):P=be(o.filters.date),_.set("date",P),ae.value=P}else o.filters.location&&_.set("location_permalink",o.filters.location.permalink);N=="course"&&o.filters.course.id!="-1"&&_.set("course",o.filters.course.id),N=="hour"&&o.filters.hour!="Tutti gli orari"&&_.set("hour",o.filters.hour),N=="name"&&_.set("name",o.filters.name)}setTimeout(()=>{se(_)},Math.random()*1e3+250)}const se=async function(_){await n.fetchAllOrders(_).then(()=>{T.value=!1}).catch(N=>{T.value=!1,E(h,N)})},U=_=>{V.value.toggle(_),A.value.toggle(_)},I=(_,N)=>_>_+N?"red":"green",q=function(_,N){N&&(V.value.note=N,V.value.toggle(_))},X=function(_){_.order&&v.value.time_slots&&v.value.time_slots.forEach((N,P)=>{N.orders.forEach((K,G)=>{K.id==_.order.id&&(v.value.time_slots[P].orders[G]=_.order,_.check_in_done!=null&&(v.value.time_slots[P].check_in_done+=_.check_in_done))})})},ve=async function(_,N){let P=[],K=!1;k.value.forEach(ee=>{if(ee.id==_.id){K=!0;return}});for(let ee of _.tickets)P.push(ee.order_item_id);const G={check_in:N,order_item_ids:P,location_permalink:o.filters.location};await n.checkInOrder(G).then(()=>{X(m.value),Z(h,{message:"Check-in registrato correttamente",error:!1}),K&&ye(k.value,m.value.order)}).catch(ee=>{E(h,ee)})},ze=async function(_,N){let P=[],K=!1;k.value.forEach(ee=>{if(ee.id==_.id){K=!0;return}});for(let ee of _.tickets)P.push(ee.order_item_id);const G={order_item_ids:P,no_show:N,location_permalink:o.filters.location.permalink};await n.noShowOrder(G).then(()=>{X(m.value),Z(h,{message:"No-show registrato correttamente",error:!1}),K&&ye(k.value,m.value.order)}).catch(ee=>{E(h,ee)})},qe=async function(_,N,P){const K={id:_,check_in:N,location_permalink:o.filters.location.permalink};await n.checkInTicket(K).then(()=>{Z(h,{message:"Check-in registrato correttamente",error:!1}),X(m.value),ye(k.value,m.value.order)}).catch(G=>{E(h,G)})},He=async function(_,N,P){const K={id:_,no_show:N,location_permalink:o.filters.location.permalink};await n.noShowTicket(K).then(()=>{Z(h,{message:"No-show registrato correttamente",error:!1}),X(m.value),ye(k.value,m.value.order)}).catch(G=>{E(h,G)})},ye=function(_,N){let P=Ke(k.value,m.value.order.id);P!=-1&&k.value.splice(P,1),k.value.push(m.value.order)},Ke=function(_,N){for(let P=0;P<_.length;P++)if(_[P].id===N)return P;return-1},Je=function(_){const N={course_name:_.course_name,start_at:_.start_at,date:o.filters.date,hour:_.start_at,max_seats:_.is_free_slot?null:_.remaing_seats+""};e.emit("updateFilters",N)},Ge=function(_){B.value=!0,R.value=_},We=function(_){X({order:_}),B.value=!1,z.value=!1},Qe=function(){H.value=!1,ne()},Xe=function(_){return _!=null&&_.created_by&&(_==null?void 0:_.created_by)=="WEB"?"WEB":"KALATA"},Ze=function(_,N){let P=0;if(_&&_.tickets){_.tickets.forEach(G=>{N?G.no_show&&(P+=1):G.check_in&&(P+=1)});let K=_.tickets.length;if(P!=K&&P!=0)return P+"/"+K}},Ye=function(_,N){A.value.data=N,A.value.toggle(_)},$e=function(_,N){j.value=N.id;let P="Sei sicuro di voler eliminare questa prenotazione?";P+='<br><br> <i>N.B. Eventuali voucher presenti nella prenotazione vanno liberati manualmente dalla sezione "Data aperta"</i>',a.setDialog("Elimina prenotazione","Elimina","Annulla",P),a.setBtnSubmit(!1),a.setDynamicDialogVisibility(!0)},et=function(){if(c(),j.value){const _={id:j.value,location_permalink:o.filters.location.permalink};n.deleteOrder(_).then(()=>{d(),Z(h,{message:"La prenotazione è stata eliminata correttamente",error:!1}),v.value.time_slots&&v.value.time_slots.forEach((N,P)=>{N.orders.forEach((K,G)=>{K.id==j.value&&(v.value.time_slots[P].orders.splice(G,1),m.value,v.value.time_slots[P].check_in_done+=m.value.check_in_done,v.value.time_slots[P].confirmed_seats+=m.value.confirmed_seats,v.value.time_slots[P].remaing_seats-=m.value.confirmed_seats)})})}).catch(N=>{d(),E(h,N)})}},tt=function(_){S.value=_.data?[_.data]:[]},ot=function(_){k.value=_.data?[_.data]:[]},nt=function(_){ue.value=!0,s.value=_},lt=function(_){z.value=!0,s.value=_},it=function(_){H.value=!0,s.value=_},at=function(_){const N=new Map;N.set("id",_.id),N.set("location_permalink",o.filters.location.permalink),c(),n.downloadTicket(N).then(()=>{d()}).catch(P=>{d(),E(h,P)})},st=function(_,N){c(),ke(_,N.location.permalink).then(()=>{d()}).catch(()=>{d()})},rt=function(_,N){c(),Oe(_,N.location.permalink).then(()=>{d()}).catch(()=>{d()})},ct=async()=>{await ne(),s.value&&s.value.id&&(await n.fetchOrderDetail(s.value.id),s.value={...n.getCurrentOrder})};return le(u,_=>{_&&et()}),le(o.filters,()=>{o.filters.location&&ne()}),{dt:y,responseOrders:v,loading:T,totalRecords:r,lazyParams:O,currentOrder:s,status:p,expandedRows:S,expandedRows1:k,op:V,dialogStore:t,paymentList:b,visibleDialog:B,currentTimeSlot:R,visibleMenu:A,visibleDetailDialog:ue,visibleNotesDialog:z,toast:h,visibleAddNotesDialog:H,formattedDate:ae,loadLazyData:ne,toggle:U,getProgressClass:I,showNotes:q,checkAll:ve,noShowAll:ze,openDialog:Je,checkInSingleTicket:qe,noShowSingleTicket:He,prettyPaymentStatus:Ee,openPaymentStatusDialog:Ge,onClosePaymentStatusDialog:We,getRowClass:Xe,printPDF:Oe,showLabelCheckbox:Ze,confirmDeleteOrder:$e,showMenu:Ye,openOrderDetailDialog:nt,openNotesDialog:lt,downloadPDF:at,handleRowToggle:tt,handleRowToggle1:ot,openPDFTab:st,openPDFTicketTab:rt,onRefreshOrder:ct,openAddNotesDialog:it,onCloseNoteDialog:Qe,formatDataFromUnixTimestamps:Ct,printOrderPDF:ke}},components:{PaymentStatusDialog:jt,OrderDetailDialog:ko,NotesDialog:Oo,AddNotesDialog:Ao}};const Po={class:"order-table"},Mo={class:""},jo={style:{width:"15rem"}},Fo={class:"m-0 text-right",style:{"font-size":"12px"}},Uo={key:0,class:"pi pi-exclamation-triangle cursor-pointer",style:{color:"var(--orange-400)"}},Eo={style:{width:"15rem"}},Ro={class:"m-0 text-right",style:{"font-size":"12px"}},Bo={key:0},Io=["onClick"],zo={key:0},qo={class:"flex justify-content-center"},Ho={class:"flex flex-column",style:{"margin-top":"8px"}},Ko={class:"text-sm",style:{"min-height":"15px"}},Jo={class:"flex justify-content-center"},Go={class:"flex flex-column",style:{"margin-top":"8px"}},Wo={class:"text-sm",style:{"min-height":"15px"}},Qo=["onClick"],Xo={class:"p-3"},Zo={class:"overlay-menu"},Yo=["onClick"],$o=["onClick"],en=["onClick"],tn=["onClick"],on=["onClick"],nn=["disabled","onClick"],ln=["disabled","onClick"],an={key:0},sn={key:1},rn={class:"flex justify-content-center"},cn={class:"flex justify-content-center"},dn={class:"flex justify-content-center"},un={key:0,class:"flex mx-4"};function mn(o,e,n,t,v,p){const a=C("Column"),u=C("ProgressBar"),b=C("Button"),m=C("Badge"),c=C("Checkbox"),d=C("OverlayPanel"),h=C("DataTable"),y=C("PaymentStatusDialog"),s=C("Dialog"),V=C("OrderDetailDialog"),R=C("NotesDialog"),j=C("AddNotesDialog"),T=pe("tooltip"),O=pe("badge");return f(),g("div",Po,[i(h,{value:t.responseOrders.time_slots,totalRecords:t.responseOrders.total,lazy:!0,paginator:!1,ref:"dt",loading:t.loading,stripedRows:"",expandedRows:t.expandedRows,"onUpdate:expandedRows":e[1]||(e[1]=r=>t.expandedRows=r),onRowExpand:t.handleRowToggle},{empty:x(()=>e[9]||(e[9]=[F(" Nessuna prenotazione trovata. ",-1)])),expansion:x(r=>[i(h,{value:r.data.orders,class:"m-4 mx-4 table-order-detail",expandedRows:t.expandedRows1,"onUpdate:expandedRows":e[0]||(e[0]=S=>t.expandedRows1=S),rowClass:t.getRowClass,onRowExpand:t.handleRowToggle1},{empty:x(()=>e[10]||(e[10]=[F(" Nessuna prenotazione trovata. ",-1)])),expansion:x(S=>[i(h,{value:S.data.tickets,class:"m-4 mx-5"},{default:x(()=>[i(a,{header:"Codice biglietto",field:"code"}),i(a,{header:"Tipo biglietto",field:"type"},{body:x(({data:k})=>[i(m,{value:k.ticket_name,class:J([k.ticket_name,"px-3 border-round-lg"])},null,8,["value","class"])]),_:1}),i(a,{header:"Prezzo"},{body:x(({data:k})=>[k.ticket_price?(f(),g("span",an," € "+w((+k.ticket_price).toFixed(2)),1)):(f(),g("span",sn,"-"))]),_:1}),i(a,null,{header:x(()=>e[20]||(e[20]=[l("div",{class:"flex justify-content-center w-full"},"Check-in",-1)])),body:x(({data:k})=>[l("div",rn,[i(c,{modelValue:k.check_in,"onUpdate:modelValue":B=>k.check_in=B,binary:!0,onChange:B=>t.checkInSingleTicket(k.id,k.check_in,S.data),class:"check_in"},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:2},1024),i(a,null,{header:x(()=>e[21]||(e[21]=[l("div",{class:"flex justify-content-center w-full"},"No-show",-1)])),body:x(({data:k})=>[l("div",cn,[i(c,{modelValue:k.no_show,"onUpdate:modelValue":B=>k.no_show=B,binary:!0,onChange:B=>t.noShowSingleTicket(k.id,k.no_show,S.data),class:"no_show"},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:2},1024),i(a,{field:"tickets_url"},{header:x(()=>e[22]||(e[22]=[l("div",{class:"flex justify-content-center w-full"},null,-1)])),body:x(({data:k})=>[l("div",dn,[ce(i(b,{link:"",icon:"pi pi-print",href:k.tickets_url,target:"_blank",style:{color:"var(--surface-400)"},text:"",rounded:"",onClick:B=>t.openPDFTicketTab(k.id,n.filters)},null,8,["href","onClick"]),[[T,"Stampa",void 0,{top:!0}]])])]),_:1})]),_:2},1032,["value"])]),default:x(()=>[i(a,{header:"Codice",field:"reservation_number"}),i(a,{header:"Acquirente"},{body:x(({data:S})=>[F(w(S.user_name)+" "+w(S.user_surname)+" ",1),!S.user_name&&!S.user_surname?(f(),g("span",Bo,"-")):L("",!0)]),_:1}),i(a,{header:"Gruppo"},{body:x(({data:S})=>[l("div",{class:"group cursor-pointer",onClick:k=>t.showNotes(k,S.group_name)},w(S.group_name||"-"),9,Io)]),_:1}),i(a,{header:"Pagamento"},{body:x(({data:S})=>[S.status?(f(),g("span",zo,[i(m,{value:t.prettyPaymentStatus(S.status),class:J([S.status,"px-3 border-round-lg"])},null,8,["value","class"])])):L("",!0)]),_:1}),i(a,{header:"Q.ta",field:"tickets_number"}),i(a,null,{header:x(()=>e[11]||(e[11]=[l("div",{class:"flex justify-content-center w-full"},"Check-in",-1)])),body:x(({data:S})=>[l("div",qo,[l("div",Ho,[i(c,{modelValue:S.check_in,"onUpdate:modelValue":k=>S.check_in=k,binary:!0,onChange:k=>t.checkAll(S,S.check_in),class:"check_in"},null,8,["modelValue","onUpdate:modelValue","onChange"]),l("span",Ko,w(t.showLabelCheckbox(S,!1)),1)])])]),_:1}),i(a,null,{header:x(()=>e[12]||(e[12]=[l("div",{class:"flex justify-content-center w-full"},"No-show",-1)])),body:x(({data:S})=>[l("div",Jo,[l("div",Go,[i(c,{modelValue:S.no_show,"onUpdate:modelValue":k=>S.no_show=k,binary:!0,onChange:k=>t.noShowAll(S,S.no_show),class:"no_show"},null,8,["modelValue","onUpdate:modelValue","onChange"]),l("span",Wo,w(t.showLabelCheckbox(S,!0)),1)])])]),_:1}),i(a,{header:"Note"},{body:x(({data:S})=>[l("div",{class:"notes cursor-pointer",onClick:k=>t.showNotes(k,S.notes)},w(S.notes||"-"),9,Qo),i(d,{ref:"op"},{default:x(()=>[l("div",Xo,w(t.op.note),1)]),_:1},512)]),_:1}),i(a,{header:"",style:{"padding-right":"0",width:"4rem"}},{body:x(({data:S})=>[i(b,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",icon:"pi pi-ellipsis-v",text:"",rounded:"",onClick:k=>t.showMenu(k,S)},null,8,["onClick"]),i(d,{ref:"visibleMenu"},{default:x(()=>[l("ul",Zo,[l("li",{onClick:k=>t.openOrderDetailDialog(t.visibleMenu.data)},e[13]||(e[13]=[l("i",{class:"pi pi-eye mr-3"},null,-1),F("Dettaglio ordine ",-1)]),8,Yo),l("li",{onClick:k=>t.openOrderDetailDialog(t.visibleMenu.data)},e[14]||(e[14]=[l("i",{class:"pi pi-shopping-cart mr-3"},null,-1),F("Dettaglio pagamento ",-1)]),8,$o),l("li",{onClick:k=>t.openPDFTab(t.visibleMenu.data,n.filters)},e[15]||(e[15]=[l("i",{class:"pi pi-print mr-3"},null,-1),F("Stampa ",-1)]),8,en),l("li",{onClick:k=>t.downloadPDF(t.visibleMenu.data)},e[16]||(e[16]=[l("i",{class:"pi pi-download mr-3"},null,-1),F("Scarica PDF ",-1)]),8,tn),l("li",{onClick:k=>t.openNotesDialog(t.visibleMenu.data)},e[17]||(e[17]=[l("i",{class:"pi pi-comment mr-3"},null,-1),F("Modifica nota ",-1)]),8,on),l("li",{disabled:!t.visibleMenu.data.can_change_status,onClick:k=>t.openPaymentStatusDialog(t.visibleMenu.data)},e[18]||(e[18]=[l("i",{class:"pi pi-pencil mr-3"},null,-1),F("Cambia stato ",-1)]),8,nn),l("li",{disabled:!t.visibleMenu.data.can_cancel,onClick:k=>t.confirmDeleteOrder(k,t.visibleMenu.data)},e[19]||(e[19]=[l("i",{class:"pi pi-trash mr-3"},null,-1),F("Elimina ",-1)]),8,ln)])]),_:2},1536)]),_:1}),i(a,{expander:"",class:"pl-0 ml-0"})]),_:2},1032,["value","expandedRows","rowClass","onRowExpand"]),r.data.orders&&r.data.orders.length>0?(f(),g("div",un,e[23]||(e[23]=[l("div",null,[l("div",{class:"p-0 m-0 flex align-items-center"},[l("p",{style:{width:"2rem",height:"5px"},class:"mr-2 web my-0"}),l("span",{class:"text-sm"},"WEB")]),l("div",{class:"p-0 m-0 flex align-items-center justify-content-between"},[l("p",{style:{width:"2rem",height:"5px"},class:"mr-2 kalata"}),l("span",{class:"text-sm"},"SUPERGA")])],-1)]))):L("",!0)]),default:x(()=>[i(a,{header:"Percorso",field:"course_name",filterMatchMode:"contains",ref:"course_name"},null,512),i(a,{header:"Orario",field:"start_at",filterMatchMode:"contains",ref:"start_at"},{body:x(({data:r})=>[l("div",Mo,[l("span",{class:J(r.is_free_slot?"free":"")},w(r.start_at),3)])]),_:1},512),i(a,{header:"Posti prenotati",ref:"availabe_tickets",field:"availabe_tickets"},{body:x(({data:r})=>[l("div",jo,[l("p",Fo,[F(w(r.confirmed_seats)+"/"+w(r.remaing_seats+r.confirmed_seats)+" ",1),r.confirmed_seats>r.remaing_seats+r.confirmed_seats?ce((f(),g("i",Uo,null,512)),[[T,r.confirmed_seats-(r.remaing_seats+r.confirmed_seats)+" posti in overbooking",void 0,{top:!0}]]):L("",!0)]),i(u,{value:r.confirmed_seats*100/(r.remaing_seats+r.confirmed_seats),showValue:!1,style:{height:"10px"},class:J(["available-progress",t.getProgressClass(r.confirmed_seats,r.remaing_seats)])},null,8,["value","class"])])]),_:1},512),i(a,{header:"Check-in",ref:"confirmed_tickets",field:"confirmed_tickets"},{body:x(({data:r})=>[l("div",Eo,[l("p",Ro,w(r.check_in_done)+"/"+w(r.confirmed_seats),1),i(u,{value:r.check_in_done*100/(r.remaing_seats+r.confirmed_seats),showValue:!1,style:{height:"10px"},class:"check-in-progress"},null,8,["value"])])]),_:1},512),i(a,null,{body:x(({data:r})=>[ce(i(b,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",class:J(["mr-2 text-primary",{"is-present":r.note&&r.note!==0}]),icon:"pi pi-comment",text:"",rounded:"",onClick:S=>t.openAddNotesDialog(r)},null,8,["class","onClick"]),[[T,"Nota",void 0,{top:!0}],[O,void 0,void 0,{danger:!0}]]),ce(i(b,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-0 text-primary",icon:"pi pi-calendar",text:"",rounded:"",onClick:S=>t.openDialog(r)},null,8,["onClick"]),[[T,"Prenota",void 0,{top:!0}]])]),_:1}),i(a,{expander:"",style:{width:"5rem"}})]),_:1},8,["value","totalRecords","loading","expandedRows","onRowExpand"]),i(s,{visible:t.visibleDialog,"onUpdate:visible":e[3]||(e[3]=r=>t.visibleDialog=r),modal:"",header:"Stato pagamento",style:{width:"35rem"}},{default:x(()=>[i(y,{location_permalink:n.filters.location.permalink,time_slot:t.currentTimeSlot,onCloseDialog:e[2]||(e[2]=r=>t.onClosePaymentStatusDialog(r))},null,8,["location_permalink","time_slot"])]),_:1},8,["visible"]),i(s,{visible:t.visibleDetailDialog,"onUpdate:visible":e[4]||(e[4]=r=>t.visibleDetailDialog=r),modal:"",header:"Dettaglio ordine",style:{width:"70rem"},onAfterHide:t.loadLazyData},{default:x(()=>[i(V,{order:t.currentOrder},null,8,["order"])]),_:1},8,["visible","onAfterHide"]),i(s,{visible:t.visibleNotesDialog,"onUpdate:visible":e[6]||(e[6]=r=>t.visibleNotesDialog=r),modal:"",header:"Modifica nota",style:{width:"35rem"}},{default:x(()=>[i(R,{order:t.currentOrder,location_permalink:n.filters.location.permalink,onCloseDialog:e[5]||(e[5]=r=>t.onClosePaymentStatusDialog(r))},null,8,["order","location_permalink"])]),_:1},8,["visible"]),i(s,{visible:t.visibleAddNotesDialog,"onUpdate:visible":e[8]||(e[8]=r=>t.visibleAddNotesDialog=r),modal:"",header:"Nota",style:{width:"35rem"}},{default:x(()=>[i(j,{date:t.formattedDate,order:t.currentOrder,location_permalink:n.filters.location.permalink,onCloseDialog:e[7]||(e[7]=r=>t.onCloseNoteDialog(r))},null,8,["date","order","location_permalink"])]),_:1},8,["visible"])])}const fn=Q(No,[["render",mn]]),pn={props:["filters"],setup(o,e){Y(()=>{h(),n.value=o.filters,n.value.date=new Date,V()});const n=D({}),t=_e(),v=oe(),p=$(),a=D([]),u=D(),b=de.now().plus({years:1}),m=M(()=>t.allLocations),c=M(()=>v.getCalendar),d=async function(T){await v.fetchCalendar(T).then(()=>{}).catch(O=>{E(p,O)})},h=async function(){await t.fetchAllLocations().then(()=>{}).catch(T=>{E(p,T)})},y=function(){if(o.filters.location){const T=m.value.find(O=>O.permalink===o.filters.location);a.value=T.courses}},s=function(T){let O={};O.month=de.fromJSDate(new Date(T)).month,O.year=de.fromJSDate(new Date(T)).year,O.location_permalink=o.filters.location.permalink?o.filters.location.permalink:o.filters.location,u.value={month:O.month,year:O.year},d(O)},V=function(){let T=de.now(),O={location_permalink:"",month:"",year:""};O.location_permalink=o.filters.location.permalink?o.filters.location.permalink:o.filters.location,O.month=T.month+"",O.year=T.year+"",d(O)},R=function(T){if(c.value.web_dates&&c.value.web_dates.length!=0){let O=T.month+1;O=O<10?"0"+O:O;let r=T.day<10?"0"+T.day:T.day,S=T.year+"-"+O+"-"+r;return c.value.web_dates.find(k=>k==S)}},j=function(T){let O={location_permalink:o.filters.location.permalink?o.filters.location.permalink:o.filters.location,month:T.month,year:T.year};d(O)};return le(o.filters,()=>{if(u.value){let T={location_permalink:o.filters.location.permalink?o.filters.location.permalink:o.filters.location,month:u.value.month,year:u.value.year};d(T)}else V()}),{form:n,courses:a,maxAllowedDate:b,locations:m,calendar:c,getCourses:y,onDateChange:s,getDayFromDate:R,onMonthChange:j}}};const _n={class:"flex calendar-filter"},vn={key:0,class:"special-day"};function yn(o,e,n,t,v,p){const a=C("Calendar");return f(),g("div",_n,[i(a,{modelValue:t.form.date,"onUpdate:modelValue":e[0]||(e[0]=u=>t.form.date=u),inline:"",onDateSelect:e[1]||(e[1]=u=>t.onDateChange(u)),onMonthChange:e[2]||(e[2]=u=>t.onMonthChange(u)),maxDate:t.maxAllowedDate.toJSDate()},{date:x(u=>[t.getDayFromDate(u.date)?(f(),g("div",vn,[l("span",null,w(u.date.day),1)])):(f(),g(te,{key:1},[F(w(u.date.day),1)],64))]),_:1},8,["modelValue","maxDate"])])}const gn=Q(pn,[["render",yn]]);class hn{static async fetchAll(e){const n=e.location_permalink;return delete e.location_permalink,(await De(`/ticket_office/${n}/search/courses`,e)).data}}const Ie=Ce({id:"course",state:()=>({course:{},courses:[],response_courses:{}}),getters:{allCourses:o=>o.response_courses.tickets,responseCourses:o=>o.response_courses,getTotalCourses:o=>o.response_courses?o.response_courses.total:0,getCurrentCourse:o=>o.course},actions:{async fetchAllCourses(o){await hn.fetchAll(o).then(e=>this.response_courses=e)}}}),bn={props:["filters"],setup(o,e){Y(()=>{n.value=Object.assign({},o.filters),n.value.date=de.now().toFormat("dd/MM/yyyy"),a.value=Re(8,20),a.value.unshift("Tutti gli orari"),n.value.hour="Tutti gli orari"});const n=D({}),t=D([]),v=_e(),p=$(),a=D([]),u=oe(),b=Ie(),m=M(()=>v.allLocations),c=M(()=>u.responseOrders),d=M(()=>b.allCourses),h=function(){n.value.name=null,n.value.course=t.value[0].name,n.value.hour=a.value[0],e.emit("onSubmit",n.value)},y=async function(){const s={location_permalink:n.value.location.permalink,api_version:"v2"};await b.fetchAllCourses(s).then(()=>{}).catch(V=>{E(p,V)})};return le(m,()=>{o.filters.location&&m.value&&(n.value=Object.assign({},o.filters),n.value.hour||(n.value.hour="Tutti gli orari"),y())}),le(o.filters,()=>{o.filters.location&&m.value&&n.value.location&&n.value.location!=o.filters.location&&(n.value=Object.assign({},o.filters),n.value.hour||(n.value.hour="Tutti gli orari"))}),le(d,()=>{var s;t.value=Object.assign([],d.value),t.value&&((s=t.value[0])==null?void 0:s.id)!="-1"&&t.value.unshift({id:"-1",name:"Tutti i percorsi"}),n.value.course=t.value[0].name}),{form:n,courses:t,hours:a,locations:m,responseOrders:c,resetField:h}}},kn={class:"formgrid grid px-0 align-items-center"},Cn={key:0,class:"field col-4 flex flex-column"},wn={key:1,class:"field col-3 flex flex-column"},xn={class:"field col-4 flex flex-column"},Dn={class:"flex col-12 justify-content-end pt-1"};function On(o,e,n,t,v,p){const a=C("Dropdown"),u=C("InputText"),b=C("Button"),m=C("AccordionTab"),c=C("Accordion");return f(),W(c,{activeIndex:0},{default:x(()=>[i(m,{header:"FILTRI"},{default:x(()=>[l("div",kn,[t.form.location&&t.courses?(f(),g("div",Cn,[e[5]||(e[5]=l("label",{for:"typology"},"Filtra per percorso",-1)),i(a,{modelValue:t.form.course,"onUpdate:modelValue":e[0]||(e[0]=d=>t.form.course=d),options:t.courses,optionLabel:"name",optionValue:"name",placeholder:""},null,8,["modelValue","options"])])):L("",!0),t.responseOrders?(f(),g("div",wn,[e[6]||(e[6]=l("label",{for:"typology"},"Filtra per orario (dalle)",-1)),i(a,{modelValue:t.form.hour,"onUpdate:modelValue":e[1]||(e[1]=d=>t.form.hour=d),options:t.hours,placeholder:""},null,8,["modelValue","options"])])):L("",!0),e[8]||(e[8]=l("div",{class:"col-12"},null,-1)),l("div",xn,[e[7]||(e[7]=l("label",{for:"typology"},"Filtra per acquirente",-1)),i(u,{modelValue:t.form.name,"onUpdate:modelValue":e[2]||(e[2]=d=>t.form.name=d),placeholder:""},null,8,["modelValue"])])]),l("div",Dn,[i(b,{label:"Ricerca",class:"mr-2",onClick:e[3]||(e[3]=d=>o.$emit("onSubmit",t.form))}),i(b,{label:"Annulla",class:"p-button-outlined",onClick:e[4]||(e[4]=d=>t.resetField())})])]),_:1})]),_:1})}const Sn=Q(bn,[["render",On]]),Vn={props:["form","price","index","ticket"],setup(o,e){const n=D(0),t=function(){n.value++,p()},v=function(){n.value>0&&n.value--,p()},p=function(){n.value==null&&(n.value=0);const a={counter:n.value,price:o.price,index:o.index,ticket:o.ticket};e.emit("changeCounter",a)};return{counter:n,decrement:v,increment:t,emitEvent:p}}};const Tn={class:"btn-plus-min flex align-items-center"},Ln={class:"counter"};function An(o,e,n,t,v,p){const a=C("Button"),u=C("InputNumber");return f(),g("div",Tn,[i(a,{icon:"pi pi-minus",rounded:"",outlined:"",severity:"secondary",onClick:t.decrement,disabled:t.counter===0},null,8,["onClick","disabled"]),l("div",Ln,[i(u,{modelValue:t.counter,"onUpdate:modelValue":[e[0]||(e[0]=b=>t.counter=b),e[1]||(e[1]=b=>t.emitEvent())],min:0},null,8,["modelValue"])]),i(a,{icon:"pi pi-plus",rounded:"",outlined:"",severity:"secondary",onClick:t.increment},null,8,["onClick"])])}const Nn=Q(Vn,[["render",An]]),Pn={props:["tickets","form"],setup(o,e){Y(()=>{v.value=!1,a.discount={},p.value=null,o.form.max_seats&&o.form.max_seats<0?(m.value=!0,c.value=-o.form.max_seats):m.value=!1});const n=D(0),t=D([]),v=D(!1),p=D(),a=oe(),u=$(),b=D(!1),m=D(!1),c=D(),d=M(()=>a.getDiscount),h=function(j){t.value[j.index]={partial_total:j.price*j.counter,ticket:j.ticket,quantity:j.counter},n.value=0;let T=0;t.value.forEach(O=>{n.value+=O.partial_total,T+=O.quantity}),m.value||(o.form.max_seats&&T>+o.form.max_seats?(c.value=T-+o.form.max_seats,b.value=!0):(c.value=null,b.value=!1)),p.value&&s()},y=function(){s()},s=async function(){let j=[];t.value.forEach(O=>{j.push({id:O.ticket.id,quantity:O.quantity})});const T={discount_code:p.value,location_permalink:o.form.location_permalink,tickets:j};await a.cost(T).then(()=>{}).catch(O=>{E(u,O)})};return{total:n,partialTotals:t,showDiscount:v,discountCode:p,discount:d,showAlert:b,showAlert2:m,numOverbooking:c,onChangeCounter:h,applyDiscount:y,checkDisabled:function(){let j=!1;(!t.value||t.value.length==0)&&(j=!0);let T=0;return t.value.forEach(O=>{T+=O.quantity}),T==0&&(j=!0),e.emit("disableSecondoTab",!0),j},nextTab:function(){const j={discount_code:p.value,partial_total:t.value};e.emit("nextTab",j)}}},components:{PlusMinusButton:Nn}};const Mn={key:0},jn={key:1},Fn={key:0},Un={key:1},En={key:0,class:"flex justify-content-between align-items-center"},Rn={class:"flex align-items-center col-9"},Bn={class:"col-7 pl-0"},In={class:"text-right col-2"},zn={class:"col-3 flex justify-content-end"},qn={key:2,class:"mt-3 mb-5"},Hn={class:"flex align-items-center justify-content-between py-0"},Kn={class:"col-9 flex"},Jn={class:"col-2 text-right font-bold"},Gn={class:"col-3 flex justify-content-end"};function Wn(o,e,n,t,v,p){const a=C("Message"),u=C("PlusMinusButton"),b=C("Button");return f(),g(te,null,[t.showAlert?(f(),W(a,{key:0,severity:"warn",closable:!1},{default:x(()=>[F("Attenzione! Si sta andando in overbooking di "+w(t.numOverbooking)+" ",1),t.numOverbooking==1?(f(),g("span",Mn,"posto")):(f(),g("span",jn,"posti"))]),_:1})):L("",!0),t.showAlert2?(f(),W(a,{key:1,severity:"warn",closable:!1},{default:x(()=>[F("Attenzione! Lo slot orario è già in overbooking di "+w(t.numOverbooking)+" ",1),t.numOverbooking==1?(f(),g("span",Fn,"posto")):(f(),g("span",Un,"posti"))]),_:1})):L("",!0),(f(!0),g(te,null,he(n.tickets,(m,c)=>{var d,h,y;return f(),g("div",{key:m.id},[((d=m.course)==null?void 0:d.id)==((h=n.form.course)==null?void 0:h.id)?(f(),g("div",En,[l("div",Rn,[l("b",Bn,w(m.name),1),l("div",In,"€ "+w((y=m.price)==null?void 0:y.toFixed(2)),1)]),l("div",zn,[i(u,{onChangeCounter:e[0]||(e[0]=s=>t.onChangeCounter(s)),price:m.price,index:c,ticket:m},null,8,["price","index","ticket"])])])):L("",!0)])}),128)),n.tickets&&n.tickets.length==0?(f(),g("div",qn,e[2]||(e[2]=[l("i",null,"Nessuna tipologia di biglietto trovata.",-1)]))):L("",!0),e[4]||(e[4]=l("hr",{class:"mt-3"},null,-1)),l("div",Hn,[l("div",Kn,[l("div",{class:J(["pl-0",t.discount&&t.discount.total_amount?"col-2":"col-7"])},e[3]||(e[3]=[l("b",null,"Totale",-1)]),2),l("div",Jn,"€ "+w(t.total.toFixed(2)),1)]),l("div",Gn,[i(b,{label:"Prosegui",onClick:e[1]||(e[1]=m=>t.nextTab()),disabled:t.checkDisabled()},null,8,["disabled"])])])],64)}const Qn=Q(Pn,[["render",Wn]]);class Xn{static async fetchAll(){return(await je("/countries")).data.countries}}const Zn=Ce({id:"country",state:()=>({country:{},countries:[]}),getters:{allCountries:o=>o.countries},actions:{async fetchAllCountries(){await Xn.fetchAll().then(o=>this.countries=o)}}});class Yn{static async fetchAll(){return(await je("/provinces")).data.provinces}}const $n=Ce({id:"province",state:()=>({province:{},provinces:[]}),getters:{allProvinces:o=>o.provinces,getCurrentProvince:o=>o.province},actions:{async fetchAllProvinces(){await Yn.fetchAll().then(o=>this.provinces=o)}}}),el={computed:{Code(){return Code}},props:["location_permalink"],setup(o,e){Y(()=>{R(),j()});const n=we(),t=Zn(),v=oe(),p=$n(),a=D({}),u=D(),b=D(),m=M(()=>t.allCountries),c=M(()=>n.allOpenTickets),d=M(()=>v.paymentStatus),h=M(()=>v.paymentModeList),y=M(()=>p.allProvinces),s=M(()=>{const S=v.getPaymentMethods;return Object.entries(S).map(([k,B])=>({id:k,label:B}))}),V=M(()=>v.paymentMethodAccountList),R=async function(){await t.fetchAllCountries().then(()=>{a.value.country_id=88,a.value.status={id:"payed",name:"Pagato"}})},j=async function(){await p.fetchAllProvinces()},T=async function(S){const k={code:S.query.toUpperCase(),location_permalink:o.location_permalink};await n.fetchAllOpenTickets(k)},O=function(){a.value.status.id&&(a.value.status.id=="free"||a.value.status.id=="to_pay")&&(a.value.payment_method=null)},r=function(){if(a.value.status&&a.value.status.id=="payed"){if(!a.value.payment_method){u.value="Seleziona un metodo di pagamento";return}if(a.value.open_ticket_codes){for(const S of a.value.open_ticket_codes)if(S.expired){b.value="Uno o più codici biglietto risultano scaduti";return}}}e.emit("nextTab",a.value)};return le(()=>a.value.multi_payment,S=>{S&&(a.value.status={id:"to_pay",name:"Da pagare"})}),{form:a,countries:m,paymentList:d,paymentModeList:h,errorMessage:u,errorMessageVoucher:b,open_tickets:c,provinces:y,dynamicPaymentMethods:s,paymentMethodAccountList:V,fetchAllOpenTickets:T,onChangeStatus:O,onConfirm:r}}};const tl={key:0,class:"formgrid grid"},ol={class:"field col-6"},nl={class:"field col-6"},ll={class:"field col-6"},il={class:"field col-6"},al={class:"field col-6"},sl={class:"field col-6"},rl={class:"field col-6"},cl={class:"field col-6"},dl={key:0,class:"field col-6"},ul={for:"payment_method"},ml={key:0},fl={class:"p-float-label mb-0"},pl={class:"p-error",id:"dd-error"},_l={key:1,class:"field col-6 flex flex-column"},vl={key:0,class:"pi pi-exclamation-triangle",style:{color:"#ff6767"}},yl={class:"p-error",id:"dd-error"},gl={class:"field col-12"},hl={key:2,class:"col-12 pl-0 flex"},bl={class:"field col-6"},kl={class:"field col-6"},Cl={class:"p-float-label mb-0"},wl={class:"p-error",id:"dd-error"},xl={class:"field col-12"},Dl={class:"field flex flex-column"},Ol={class:"col-12 flex justify-content-end"};function Sl(o,e,n,t,v,p){const a=C("InputText"),u=C("Dropdown"),b=C("AutoComplete"),m=C("Checkbox"),c=C("InputNumber"),d=C("Textarea"),h=C("Button"),y=pe("tooltip");return t.form?(f(),g("div",tl,[l("div",ol,[e[20]||(e[20]=l("label",{for:"user_name"},"Nome",-1)),i(a,{type:"text",modelValue:t.form.user_name,"onUpdate:modelValue":e[0]||(e[0]=s=>t.form.user_name=s),class:"w-full"},null,8,["modelValue"])]),l("div",nl,[e[21]||(e[21]=l("label",{for:"user_surname"},"Cognome",-1)),i(a,{type:"text",modelValue:t.form.user_surname,"onUpdate:modelValue":e[1]||(e[1]=s=>t.form.user_surname=s),class:"w-full"},null,8,["modelValue"])]),l("div",ll,[e[22]||(e[22]=l("label",{for:"user_surname"},"Nome gruppo",-1)),i(a,{type:"text",modelValue:t.form.group_name,"onUpdate:modelValue":e[2]||(e[2]=s=>t.form.group_name=s),class:"w-full"},null,8,["modelValue"])]),l("div",il,[e[23]||(e[23]=l("label",{for:"user_email"},"Email",-1)),i(a,{type:"text",modelValue:t.form.user_email,"onUpdate:modelValue":e[3]||(e[3]=s=>t.form.user_email=s),class:"w-full"},null,8,["modelValue"])]),l("div",al,[e[24]||(e[24]=l("label",{for:"user_phone"},"Telefono",-1)),i(a,{type:"text",modelValue:t.form.user_phone,"onUpdate:modelValue":e[4]||(e[4]=s=>t.form.user_phone=s),class:"w-full"},null,8,["modelValue"])]),l("div",sl,[e[25]||(e[25]=l("label",{for:"country_id"},"Nazione",-1)),i(u,{modelValue:t.form.country_id,"onUpdate:modelValue":e[5]||(e[5]=s=>t.form.country_id=s),options:t.countries,optionLabel:"name",optionValue:"id",class:"w-full"},null,8,["modelValue","options"])]),l("div",rl,[e[26]||(e[26]=l("label",{for:"province"},"Provincia",-1)),i(u,{modelValue:t.form.user_zip,"onUpdate:modelValue":e[6]||(e[6]=s=>t.form.user_zip=s),options:t.provinces,optionLabel:"name",optionValue:"name",class:"w-full"},null,8,["modelValue","options"])]),l("div",cl,[e[27]||(e[27]=l("label",{for:"status"},"Stato pagamento",-1)),i(u,{modelValue:t.form.status,"onUpdate:modelValue":e[7]||(e[7]=s=>t.form.status=s),options:t.paymentList,optionLabel:"name",class:"w-full mb-0",onChange:e[8]||(e[8]=s=>t.onChangeStatus())},null,8,["modelValue","options"])]),t.form.status&&t.form.status.id=="payed"?(f(),g("div",dl,[l("label",ul,[e[28]||(e[28]=F("Modalità pagamento",-1)),t.form.status&&t.form.status.id=="payed"?(f(),g("span",ml,"*")):L("",!0)]),l("span",fl,[i(u,{modelValue:t.form.payment_method,"onUpdate:modelValue":e[9]||(e[9]=s=>t.form.payment_method=s),options:t.dynamicPaymentMethods,optionLabel:"label",class:J(["w-full",{"p-invalid":t.errorMessage}]),disabled:t.form.status&&t.form.status.id!="payed",onChange:e[10]||(e[10]=s=>t.errorMessage=null)},null,8,["modelValue","options","disabled","class"])]),l("small",pl,w(t.errorMessage||" "),1)])):L("",!0),t.form.payment_method&&t.form.payment_method.id=="voucher"?(f(),g("div",_l,[e[29]||(e[29]=l("label",{for:"user_zip"},"Codice biglietto",-1)),i(b,{modelValue:t.form.open_ticket_codes,"onUpdate:modelValue":e[11]||(e[11]=s=>t.form.open_ticket_codes=s),suggestions:t.open_tickets,class:J(["uppercase w-full",{"p-invalid":t.errorMessageVoucher}]),onComplete:e[12]||(e[12]=s=>t.fetchAllOpenTickets(s)),emptySearchMessage:"Nessun risultato",emptySelectionMessage:"Nessun risultato",optionLabel:"code",optionValue:"code",multiple:"",onChange:e[13]||(e[13]=s=>t.errorMessageVoucher=null)},{option:x(({option:s})=>[l("span",{class:"flex flex-row justify-content-between",style:Pe({color:s.expired?"#ff6767":null})},[F(w(s.code)+" ",1),s.expired?ce((f(),g("i",vl,null,512)),[[y,"Scaduto"]]):L("",!0)],4)]),_:1},8,["modelValue","suggestions","class"]),l("small",yl,w(t.errorMessageVoucher||" "),1)])):L("",!0),l("div",gl,[i(m,{modelValue:t.form.multi_payment,"onUpdate:modelValue":e[14]||(e[14]=s=>t.form.multi_payment=s),binary:!0,class:"deposit"},null,8,["modelValue"]),e[30]||(e[30]=l("label",{for:"payment_method",class:"text-sm ml-2"},"Acconto",-1))]),e[34]||(e[34]=l("div",{class:"field col-6"},null,-1)),t.form.multi_payment?(f(),g("div",hl,[l("div",bl,[e[31]||(e[31]=l("label",{for:"deposit"},"Importo acconto*",-1)),i(c,{modelValue:t.form.amount,"onUpdate:modelValue":e[15]||(e[15]=s=>t.form.amount=s),inputId:"currency-germany",mode:"currency",currency:"EUR",locale:"it-IT",class:"w-full"},null,8,["modelValue"])]),l("div",kl,[e[32]||(e[32]=l("label",{for:"payment_method_deposit"},"Modalità pagamento*",-1)),l("span",Cl,[i(u,{modelValue:t.form.payment_method_deposit,"onUpdate:modelValue":e[16]||(e[16]=s=>t.form.payment_method_deposit=s),options:t.dynamicPaymentMethods,optionLabel:"label",class:J(["w-full",{"p-invalid":t.errorMessage}]),onChange:e[17]||(e[17]=s=>t.errorMessage=null)},null,8,["modelValue","options","class"])]),l("small",wl,w(t.errorMessage||" "),1)])])):L("",!0),l("div",xl,[l("div",Dl,[e[33]||(e[33]=l("label",{for:"notes"},"Note",-1)),i(d,{modelValue:t.form.notes,"onUpdate:modelValue":e[18]||(e[18]=s=>t.form.notes=s),rows:"5",cols:"30"},null,8,["modelValue"])])]),l("div",Ol,[i(h,{label:"Conferma",onClick:e[19]||(e[19]=s=>t.onConfirm())})])])):L("",!0)}const Vl=Q(el,[["render",Sl],["__scopeId","data-v-0fc8f9e0"]]);var Tl={root:function(e){var n=e.instance;return["p-contextmenu p-component",{"p-ripple-disabled":n.$primevue.config.ripple===!1}]},menu:"p-contextmenu-root-list",menuitem:function(e){var n=e.instance,t=e.processedItem;return["p-menuitem",{"p-menuitem-active p-highlight":n.isItemActive(t),"p-focus":n.isItemFocused(t),"p-disabled":n.isItemDisabled(t)}]},content:"p-menuitem-content",action:"p-menuitem-link",icon:"p-menuitem-icon",label:"p-menuitem-text",submenuIcon:"p-submenu-icon",submenu:"p-submenu-list",separator:"p-menuitem-separator"};Me.extend({name:"contextmenu",classes:Tl});const Ll={props:["form"],setup(o,e){Y(()=>{V()});const n=D(0),t=D([]),v=D(!1),p=D(!0),a=D(),u=D([]),{showLoader:b,hideLoader:m}=me(),c=we(),d=oe(),h=$(),y=M(()=>c.allTickets),s=M(()=>d.getCurrentOrder),V=async function(){const A={location_permalink:o.form.location_permalink,api_version:"v2",date:j(o.form.date),course_id:o.form.course.id};await c.fetchAllTickets(A).then(()=>{}).catch(z=>{E(h,z)})},R=function(A){n.value+=1,a.value=A.discount_code,t.value=Object.assign([],A.partial_total),p.value=!1},j=function(A){return be(A).includes("Invalid")?Ue(A):be(A)},T=function(A){O(A)},O=async function(A){var ne,se,U,I;const z=[{start_at:o.form.hour,tickets:[]}];t.value.forEach(q=>{q.quantity!=0&&z[0].tickets.push({id:q.ticket.id,quantity:q.quantity})});let H=[];A.open_ticket_codes&&A.open_ticket_codes.forEach(q=>{H.push(q.code)});const ae={location_permalink:o.form.location_permalink,country_id:A.country_id,status:A.status.id,group_name:A.group_name,user_email:A.user_email,user_name:A.user_name,user_phone:A.user_phone,user_surname:A.user_surname,user_zip:A.user_zip,api_version:"v2",date:o.form.date?j(o.form.date):"",notes:A.notes,time_slots:z,payment_method:((ne=A.payment_method)==null?void 0:ne.id)||null,course_id:(U=(se=o.form)==null?void 0:se.course)==null?void 0:U.id,open_ticket_codes:H,multi_payment:A.multi_payment,payments:[]};A.multi_payment&&(ae.payments=[{amount:A.amount,typology:"deposit",payment_method:(I=A.payment_method_deposit)==null?void 0:I.id}]),a.value&&(ae.discount_code=a.value),await d.createOrder(ae).then(()=>{n.value+=1,p.value=!0,v.value=!0}).catch(q=>{E(h,q)})},r=function(){ke(s==null?void 0:s.value,o.form.location_permalink),e.emit("closeDialog",!0)},S=function(A){p.value=A},k=function(){ke(s==null?void 0:s.value,o.form.location_permalink),B()},B=async function(){let A=[];if(!s.value&&!o.form.location_permalink)return;for(let H of s.value.tickets)A.push(H.order_item_id);const z={check_in:!0,order_item_ids:A,location_permalink:o.form.location_permalink};await d.checkInOrder(z).then(()=>{Z(h,{message:"Check-in registrato correttamente",error:!1}),e.emit("closeDialog",!0)}).catch(H=>{E(h,H)})},ue=function(){b();const A={location_permalink:o.form.location_permalink,order_id:s.value.id};d.sendEmail(A).then(()=>{Z(h,{message:"Email inviata correttamente al cliente",error:!1}),m(),e.emit("closeDialog",!0)}).catch(z=>{m(),E(h,z)})};return le(s,()=>{u.value=[],s.value.tickets.forEach(A=>{const z=u.value.find(H=>H.ticket_name===A.ticket_name);if(!z)A.quantity=1,u.value.push(A);else{let H=u.value.indexOf(z);u.value[H].quantity+=1}})}),{tickets:y,active:n,partialTotals:t,showOrderDetail:v,currentOrder:s,tmp_tickets:u,showSecondTab:p,formatExplicitDate:Fe,formatDate:Se,onNextTab:R,onConfirmPayment:T,printPDF:Oe,onPrintPDF:r,onDisableSecondoTab:S,printAndCheckIn:k,sendEmail:ue}},components:{NewOrderTicketTab:Qn,NewOrderFormTab:Vl}};const Al={key:0,class:"info-box"},Nl={class:"font-medium"},Pl={class:"font-medium"},Ml={key:0,class:"capitalize"},jl={key:0,class:"flex pb-4"},Fl={class:"flex flex-column"},Ul={key:0,class:"pb-1 pr-1"},El={key:1,class:"pb-1"},Rl={class:"py-5"},Bl={class:"m-0 text-center line-height-3"},Il={key:0,class:"col-offset-3 col-6 flex justify-content-center flex-column align-items-center mt-4 order-summary"},zl={class:"flex flex-column col-12"},ql={key:0,class:"pb-1",style:{"min-width":"8rem"}},Hl={key:1,class:"pb-1"},Kl={key:2},Jl={class:"flex flex-column col-12"},Gl={key:0,class:"p-0 m-0 font-medium flex justify-content-between"},Wl={class:"pb-1"},Ql={class:"flex align-items-center justify-content-center mt-4"};function Xl(o,e,n,t,v,p){var d,h;const a=C("NewOrderTicketTab"),u=C("TabPanel"),b=C("NewOrderFormTab"),m=C("Button"),c=C("TabView");return f(),g(te,null,[n.form?(f(),g("div",Al,[l("p",Nl,[e[7]||(e[7]=l("i",{class:"pi pi-map-marker mr-3 font-medium"},null,-1)),F(w((d=n.form.course)==null?void 0:d.name),1)]),l("p",Pl,[e[8]||(e[8]=l("i",{class:"pi pi-calendar mr-3 font-medium"},null,-1)),n.form.date?(f(),g("span",Ml,w(t.formatDate((h=n.form)==null?void 0:h.date)),1)):L("",!0),F(" - "+w(n.form.hour),1)]),t.partialTotals&&t.partialTotals.length>0?(f(),g("div",jl,[e[9]||(e[9]=l("i",{class:"pi pi-ticket mr-3 font-medium mt-1"},null,-1)),l("div",Fl,[(f(!0),g(te,null,he(t.partialTotals,y=>{var s;return f(),g("p",{class:"p-0 m-0 font-medium flex justify-content-between",key:y},[y&&y.quantity!=0?(f(),g("span",Ul,w((s=y.ticket)==null?void 0:s.name),1)):L("",!0),y&&y.quantity!=0?(f(),g("span",El," x "+w(y.quantity)+" "+w(y.price),1)):L("",!0)])}),128))])])):L("",!0)])):L("",!0),i(c,{activeIndex:t.active,"onUpdate:activeIndex":e[6]||(e[6]=y=>t.active=y)},{default:x(()=>[i(u,{header:"Seleziona i biglietti",disabled:t.showOrderDetail},{default:x(()=>[i(a,{tickets:t.tickets,form:n.form,onNextTab:e[0]||(e[0]=y=>t.onNextTab(y)),onDisableSecondoTab:e[1]||(e[1]=y=>t.onDisableSecondoTab(y))},null,8,["tickets","form"])]),_:1},8,["disabled"]),i(u,{header:"Inserisci i dati",disabled:t.showSecondTab},{default:x(()=>[i(b,{onNextTab:e[2]||(e[2]=y=>t.onConfirmPayment(y)),location_permalink:n.form.location_permalink},null,8,["location_permalink"])]),_:1},8,["disabled"]),t.showOrderDetail?(f(),W(u,{key:0,header:"Ordine completato"},{default:x(()=>{var y,s;return[l("div",Rl,[l("div",Bl,[e[10]||(e[10]=F(" Ordine ",-1)),l("b",null,w(t.currentOrder.reservation_number),1),e[11]||(e[11]=F(" registrato correttamente!",-1)),e[12]||(e[12]=l("br",null,null,-1))]),t.currentOrder?(f(),g("div",Il,[e[14]||(e[14]=l("p",{class:"my-2"},[l("b",null,"Riepilogo ordine:")],-1)),l("div",zl,[(f(!0),g(te,null,he(t.tmp_tickets,V=>(f(),g("p",{class:"p-0 m-0 font-medium flex justify-content-between flex-1",key:V},[V&&V.quantity!=0?(f(),g("span",ql,w(V.ticket_name),1)):L("",!0),V&&V.quantity!=0?(f(),g("span",Hl," x "+w(V.quantity),1)):L("",!0),V.ticket_price?(f(),g("span",Kl," € "+w((+V.ticket_price).toFixed(2)),1)):L("",!0)]))),128))]),l("div",Jl,[t.currentOrder.total?(f(),g("p",Gl,[e[13]||(e[13]=l("span",{class:"pb-1 pr-1"},"Totale ordine ",-1)),l("span",Wl,[l("b",null,"€ "+w((+((y=t.currentOrder)==null?void 0:y.total)).toFixed(2)),1)])])):L("",!0)])])):L("",!0),l("div",Ql,[i(m,{icon:"pi pi-envelope",class:"mr-3",rounted:"",outlined:"",label:"Invia biglietti",onClick:e[3]||(e[3]=V=>t.sendEmail()),disable:!((s=t.currentOrder)!=null&&s.user_email)},null,8,["disable"]),i(m,{icon:"pi pi-print",onClick:e[4]||(e[4]=V=>t.onPrintPDF()),class:"mr-3",rounted:"",outlined:"",label:"Stampa"}),i(m,{icon:"pi print-check-icon",onClick:e[5]||(e[5]=V=>t.printAndCheckIn()),class:"mr-3",rounted:"",outlined:"",label:"Stampa e Check-in"})])])]}),_:1})):L("",!0)]),_:1},8,["activeIndex"])],64)}const Zl=Q(Ll,[["render",Xl]]),Yl={props:["filters","date"],setup(o,e){Y(()=>{p.value=Re(8,24),n.value=Object.assign({},o.filters)});const n=D({}),t=Ie(),v=$(),p=D(),a=D(!1),u=Ve(),b=D(!1),m=M(()=>t.allCourses),c=M(()=>u.showNewOrderDialog),d=async function(){const V={location_permalink:o.filters.location_permalink,api_version:"v2"};await t.fetchAllCourses(V).catch(R=>{E(v,R)})},h=function(){u.setNewOrderDialogVisibility(!1),n.value.hour="",n.value.course=null,e.emit("onCloseDialog")},y=function(V){n.value.date=o.date,u.setNewOrderDialogVisibility(V)},s=function(){b.value=n.value.open_ticket};return le(o.filters,()=>{if(d(),n.value=Object.assign({},o.filters),o.filters.course&&!o.filters.course.id){let V=m.value.find(R=>R.name===o.filters.course.name);V&&(n.value.course=V)}}),{courses:m,form:n,hours:p,disableForm:b,visible:a,onCloseDialog:h,updateDialog:y,onChecked:s,dialogVisible:c,dialogStore:u}},components:{NewOrderDialog:Zl}},$l={class:"formgrid grid px-0 align-items-center mt-4"},ei={key:0,class:"field flex flex-column w-full col-12"},ti={key:1,class:"field flex flex-column w-full col-12"},oi={class:"flex justify-content-end align-items-center mt-2"},ni={class:"flex align-items-center justify-content-between w-full"};function li(o,e,n,t,v,p){const a=C("Dropdown"),u=C("Button"),b=C("NewOrderDialog"),m=C("Dialog"),c=C("Card");return f(),W(c,{class:"mt-4"},{content:x(()=>[e[10]||(e[10]=l("h2",{class:"mt-1"},"Nuova prenotazione",-1)),l("div",$l,[n.filters.location_permalink?(f(),g("div",ei,[e[7]||(e[7]=l("label",{for:"typology"},"Scegli il percorso",-1)),i(a,{modelValue:t.form.course,"onUpdate:modelValue":e[0]||(e[0]=d=>t.form.course=d),options:t.courses,optionLabel:"name",disabled:t.disableForm,placeholder:""},null,8,["modelValue","options","disabled"])])):L("",!0),n.filters.location_permalink?(f(),g("div",ti,[e[8]||(e[8]=l("label",{for:"typology"},"Seleziona l'orario",-1)),i(a,{modelValue:t.form.hour,"onUpdate:modelValue":e[1]||(e[1]=d=>t.form.hour=d),options:t.hours,disabled:t.disableForm,placeholder:""},null,8,["modelValue","options","disabled"])])):L("",!0)]),l("div",oi,[i(u,{label:"Prenota",disabled:!t.form.course||!t.form.hour,onClick:e[2]||(e[2]=d=>t.updateDialog(!0))},null,8,["disabled"])]),i(m,{visible:t.dialogVisible,"onUpdate:visible":e[5]||(e[5]=d=>t.dialogVisible=d),modal:"",header:"Nuova prenotazione",style:{width:"60rem"},breakpoints:{"1199px":"75vw","575px":"90vw"},closable:!1,onHide:e[6]||(e[6]=d=>t.onCloseDialog())},{header:x(()=>[l("div",ni,[e[9]||(e[9]=l("h2",null,"Nuova prenotazione",-1)),i(u,{icon:"pi pi-times",text:"",rounded:"",onClick:e[3]||(e[3]=d=>t.updateDialog(!1))})])]),default:x(()=>[i(b,{form:t.form,onCloseDialog:e[4]||(e[4]=d=>t.onCloseDialog())},null,8,["form"])]),_:1},8,["visible"])]),_:1})}const ii=Q(Yl,[["render",li]]),ai={props:["location_permalink"],setup(o,e){Y(()=>{t.value.start_date=de.local().startOf("day").toFormat("dd/MM/yyyy"),t.value.end_date=de.local().endOf("day").toFormat("dd/MM/yyyy"),t.value.created_at="false",t.value.start_hour="00:00",t.value.end_hour="23:59"});const n=$(),t=D({}),v=_e(),{showLoader:p,hideLoader:a}=me(),u=function(){let c=Ae(t.value.start_date)+" "+t.value.start_hour,d=Ae(t.value.end_date)+" "+t.value.end_hour;const h={from:c,to:d,location_permalink:o.location_permalink,created_at:"false"};b(h)},b=async function(c){p(),await v.downloadReport(c).then(()=>{a(),e.emit("onSubmit")}).catch(d=>{a(),E(n,d)})};return{form:t,onSubmit:u,setDefaultIfBlank:function(){(!t.value.start_hour||t.value.start_hour=="")&&(t.value.start_hour="00:00"),(!t.value.end_hour||t.value.end_hour=="")&&(t.value.end_hour="23:59")}}},components:{Form:xt}},si={class:"formgrid grid mt-3"},ri={class:"field col-6 flex flex-column"},ci={class:"field col-6 flex flex-column"},di={class:"flex align-items-center justify-content-end mt-6"};function ui(o,e,n,t,v,p){const a=C("Calendar"),u=C("InputMask"),b=C("Button"),m=C("Form");return f(),W(m,{onSubmit:t.onSubmit},{default:x(()=>[l("div",si,[l("div",ri,[e[7]||(e[7]=l("label",{from:"start_date"},"Dal",-1)),i(a,{inputId:"start_date",modelValue:t.form.start_date,"onUpdate:modelValue":e[0]||(e[0]=c=>t.form.start_date=c),dateFormat:"dd/mm/yy",manualInput:!0},null,8,["modelValue"]),e[8]||(e[8]=l("label",{from:"start_hour",class:"mt-3"},"Dalle",-1)),i(u,{id:"start_hour",modelValue:t.form.start_hour,"onUpdate:modelValue":e[1]||(e[1]=c=>t.form.start_hour=c),mask:"99:99",placeholder:"HH:mm",onBlur:e[2]||(e[2]=c=>t.setDefaultIfBlank())},null,8,["modelValue"])]),l("div",ci,[e[9]||(e[9]=l("label",{from:"end_date"},"Al",-1)),i(a,{inputId:"end_date",modelValue:t.form.end_date,"onUpdate:modelValue":e[3]||(e[3]=c=>t.form.end_date=c),dateFormat:"dd/mm/yy",manualInput:!0},null,8,["modelValue"]),e[10]||(e[10]=l("label",{from:"end_hour",class:"mt-3"},"Alle",-1)),i(u,{id:"end_hour",modelValue:t.form.end_hour,"onUpdate:modelValue":e[4]||(e[4]=c=>t.form.end_hour=c),mask:"99:99",placeholder:"HH:mm",onBlur:e[5]||(e[5]=c=>t.setDefaultIfBlank())},null,8,["modelValue"])])]),l("div",di,[i(b,{label:"Annulla",text:"",onClick:e[6]||(e[6]=c=>o.$emit("onSubmit"))}),i(b,{label:"Scarica",type:"submit"})])]),_:1},8,["onSubmit"])}const mi=Q(ai,[["render",ui]]),fi={setup(){const o=D({}),e=D({}),n=D(),t=D(!1),v=oe(),p=ht(),a=_e(),u=$(),b=Ve(),m=M(()=>p.currentUser),c=M(()=>a.allLocations),d=M(()=>a.getCurrentLocation),h=M(()=>v.getPaymentMethods);Y(()=>{d.value&&(o.value.location=d.value,e.value.location_permalink=d.value.permalink),s().then(()=>{y()})});const y=async function(){var k;let r={};const S=((k=d==null?void 0:d.value)==null?void 0:k.permalink)??null;S?r.location_permalink=S:r.location_permalink=c.value[0].permalink,await v.fetchPaymentMethods(r).then(()=>{}).catch(B=>{E(u,B)})},s=async function(){await a.fetchAllLocations().then(()=>{d.value||(o.value.location=c.value[0],e.value.location_permalink=c.value[0].permalink,a.updateCurrenLocation(c.value[0]))}).catch(r=>{E(u,r)})};return{filters:o,orderTable:n,order_filters:e,visibleDialog:t,user:m,locations:c,newPaymentMethods:h,fetchAllLocations:s,formatDate:Se,onUpdateFilters:function(r){r.course?o.value.course={id:r.course}:o.value.course="",r.name?o.value.name=r.name:o.value.name="",r.hour&&(r.hour.start_at?o.value.hour=r.hour.start_at:o.value.hour=r.hour)},onUpdateNewOrderFilters:function(r){r.start_at&&(e.value.hour=r.start_at),r.course_name&&(e.value.course={name:r.course_name}),r.date&&(e.value.date=r.date),r.hour&&(e.value.hour=r.hour),r.max_seats?e.value.max_seats=r.max_seats:e.value.max_seats=null,b.setNewOrderDialogVisibility(!0)},onCloseDialog:function(){n.value.loadLazyData()},onChangeLocation:function(){e.value.location_permalink=o.value.location.permalink,a.updateCurrenLocation(o.value.location)},onCloseReportDialog:function(){t.value=!1}}},components:{CalendarFilter:gn,OrderTable:fn,OrderFilter:Sn,NewOrderCard:ii,SalesReportsDialog:mi}};const pi={class:"flex justify-content-between align-items-center"},_i={class:"field flex flex-column mt-3"},vi={class:"text-xl font-medium pl-3 py-0"},yi={key:0,style:{color:"#495057"},class:"flex flex-column align-items-end"},gi={class:"capitalize text-xl"},hi={class:"flex gap-4"},bi={key:0,class:"col-3 mt-3"},ki={class:"col-9 mt-3"};function Ci(o,e,n,t,v,p){var y,s;const a=C("Button"),u=C("SalesReportsDialog"),b=C("Dialog"),m=C("CalendarFilter"),c=C("NewOrderCard"),d=C("OrderFilter"),h=C("OrderTable");return f(),g("div",null,[l("div",pi,[l("div",_i,[l("p",vi,w((s=(y=t.filters)==null?void 0:y.location)==null?void 0:s.name),1)]),t.filters&&t.filters.date?(f(),g("div",yi,[l("div",null,[e[6]||(e[6]=l("i",{class:"pi pi-calendar mr-2 text-xl"},null,-1)),l("span",gi,w(t.formatDate(t.filters.date)),1)]),i(a,{label:"Report visite",link:"",class:"m-0 p-0",onClick:e[0]||(e[0]=V=>t.visibleDialog=!0),icon:"pi pi-download"}),i(b,{visible:t.visibleDialog,"onUpdate:visible":e[2]||(e[2]=V=>t.visibleDialog=V),modal:"",header:"Report visite",style:{width:"35rem"}},{default:x(()=>[i(u,{onOnSubmit:e[1]||(e[1]=V=>t.onCloseReportDialog()),location_permalink:t.filters.location.permalink},null,8,["location_permalink"])]),_:1},8,["visible"])])):L("",!0)]),l("div",hi,[t.filters.location?(f(),g("div",bi,[i(m,{filters:t.filters},null,8,["filters"]),i(c,{date:t.filters.date,filters:t.order_filters,onOnCloseDialog:e[3]||(e[3]=V=>t.onCloseDialog())},null,8,["date","filters"])])):L("",!0),l("div",ki,[i(d,{filters:t.filters,onOnSubmit:e[4]||(e[4]=V=>t.onUpdateFilters(V))},null,8,["filters"]),t.filters.date?(f(),W(h,{key:0,filters:t.filters,ref:"orderTable",class:"mt-4",onUpdateFilters:e[5]||(e[5]=V=>t.onUpdateNewOrderFilters(V))},null,8,["filters"])):L("",!0)])])])}const Si=Q(fi,[["render",Ci]]);export{Si as default};
