import{l as Oe,m as we,o as Y,p as D,a as $,c as P,_ as X,r as C,q as pe,b as p,e as g,g as l,f as a,n as J,t as x,w,s as A,F as te,h as E,v as de,x as Pe,B as je,C as fe,Z as De,D as ie,y as dt,O as ut,z as mt,A as ft,E as pt,G as _t,H as Q,I as ge,J as ce,K as Le,L as Ae,T as vt,M as yt,i as le,N as he,P as gt,Q as Fe,u as ht}from"../index22696.js";import{u as oe,a as _e,f as Ue,b as Ve,c as bt,d as kt,e as be,g as Te,h as ke,i as Ct,D as ue,j as Ne}from"./location22696.js";import{u as me,s as Z,e as R,p as Ee,a as wt,b as Se,c as Ce,d as Re}from"./helpers22696.js";import{F as xt}from"./vee-validate.esm22696.js";class Me{static async fetchAll(e){const n=e.location_permalink;return delete e.location_permalink,(await Oe(`/ticket_office/${n}/search/tickets`,e)).data}static async fetchAllOpenTickets(e){const n=e.location_permalink;return delete e.location_permalink,(await Oe(`/ticket_office/${n}/orders/search_codes`,e)).data}}const xe=we({id:"ticket",state:()=>({ticket:{},tickets:[],response_tickets:{},open_tickets_codes:{}}),getters:{allTickets:o=>o.response_tickets.available_ticket_types,allOpenTickets:o=>o.open_tickets_codes.open_tickets,responseTickets:o=>o.response_tickets,getTotalTickets:o=>o.response_tickets?o.response_tickets.total:0,getCurrentTicket:o=>o.ticket},actions:{async fetchAllTickets(o){await Me.fetchAll(o).then(e=>this.response_tickets=e)},async fetchAllOpenTickets(o){await Me.fetchAllOpenTickets(o).then(e=>this.open_tickets_codes=e)}}}),Dt={computed:{Code(){return Code}},props:["location_permalink","time_slot"],setup(o,e){Y(()=>{n.value=Object.assign({},o.time_slot)});const n=D({}),t=xe(),y=oe(),{showLoader:_,hideLoader:i}=me(),f=$(),k=D(),d=D(),u=P(()=>t.allOpenTickets),m=P(()=>y.paymentStatus),h=P(()=>y.paymentModeList),V=P(()=>{const O=y.getPaymentMethods;return Object.entries(O).map(([c,S])=>({id:c,label:S}))}),r=P(()=>y.getCurrentOrder),s=async function(O){const c={code:O.query.toUpperCase(),location_permalink:o.location_permalink};await t.fetchAllOpenTickets(c)},F=async function(){var c,S;const O={id:o.location_permalink,order_id:n.value.id,status:(c=n.value)==null?void 0:c.status,payment_method:n.value.payment_method,open_ticket_codes:[],api_version:"v2",notes:(S=n.value)==null?void 0:S.notes};if(n.value.status&&n.value.status=="payed"&&!n.value.payment_method){k.value="Seleziona un metodo di pagamento";return}for(const b of n.value.open_tickets_used)if(b.expired){d.value="Uno o più codici biglietto risultano scaduti";return}if(n.value.open_tickets_used&&n.value.open_tickets_used.length>0){let b=[];n.value.open_tickets_used.forEach(B=>{b.push(B.code)}),O.open_ticket_codes=b}j(O)},j=async function(O){_(),await y.updateOrder(O).then(()=>{i(),Z(f,{message:"Stato aggiornato correttamente",error:!1}),e.emit("closeDialog",r.value)}).catch(c=>{i(),R(f,c)})};return{form:n,open_tickets:u,paymentList:m,paymentModeList:h,changeStatus:F,errorMessage:k,errorMessageVoucher:d,dynamicPaymentMethods:V,fetchAllOpenTickets:s,onChangeStatus:function(){(n.value.status=="free"||n.value.status=="to_pay")&&(n.value.payment_method=null)}}}},Ot={key:0,class:"formgrid grid flex-column mt-3"},St={class:"field col-12"},Vt={class:"field col-12"},Tt={class:"p-error",id:"dd-error"},Lt={key:0,class:"field col-12 flex flex-column"},At={key:0,class:"pi pi-exclamation-triangle",style:{color:"#ff6767"}},Nt={class:"p-error",id:"dd-error"},Mt={class:"flex align-items-center justify-content-end mt-3"};function Pt(o,e,n,t,y,_){const i=C("Dropdown"),f=C("AutoComplete"),k=C("Button"),d=pe("tooltip");return p(),g(te,null,[t.form?(p(),g("div",Ot,[l("div",St,[e[9]||(e[9]=l("label",{for:"status"},"Stato pagamento",-1)),a(i,{modelValue:t.form.status,"onUpdate:modelValue":e[0]||(e[0]=u=>t.form.status=u),options:t.paymentList,optionLabel:"name",optionValue:"id",class:"w-full",onChange:e[1]||(e[1]=u=>t.onChangeStatus())},null,8,["modelValue","options"])]),l("div",Vt,[e[10]||(e[10]=l("label",{for:"payment_method"},"Modalità pagamento",-1)),a(i,{modelValue:t.form.payment_method,"onUpdate:modelValue":e[2]||(e[2]=u=>t.form.payment_method=u),options:t.dynamicPaymentMethods,optionLabel:"label",optionValue:"id",class:J(["w-full",{"p-invalid":t.errorMessage}]),disabled:t.form.status!="payed",onChange:e[3]||(e[3]=u=>t.errorMessage=null)},null,8,["modelValue","options","disabled","class"]),l("small",Tt,x(t.errorMessage||" "),1)]),t.form.payment_method=="voucher"&&t.form.status=="payed"?(p(),g("div",Lt,[e[11]||(e[11]=l("label",{for:"user_zip"},"Codice biglietto",-1)),a(f,{modelValue:t.form.open_tickets_used,"onUpdate:modelValue":e[4]||(e[4]=u=>t.form.open_tickets_used=u),suggestions:t.open_tickets,class:J(["uppercase w-full",{"p-invalid":t.errorMessageVoucher}]),onComplete:e[5]||(e[5]=u=>t.fetchAllOpenTickets(u)),emptySearchMessage:"Nessun risultato",emptySelectionMessage:"Nessun risultato",optionLabel:"code",optionValue:"code",multiple:"",onChange:e[6]||(e[6]=u=>t.errorMessageVoucher=null)},{option:w(({option:u})=>[l("span",{class:"flex flex-row justify-content-between",style:Pe({color:u.expired?"#ff6767":null})},[E(x(u.code)+" ",1),u.expired?de((p(),g("i",At,null,512)),[[d,"Scaduto"]]):A("",!0)],4)]),_:1},8,["modelValue","suggestions","class"]),l("small",Nt,x(t.errorMessageVoucher||" "),1)])):A("",!0)])):A("",!0),l("div",Mt,[a(k,{label:"Annulla",text:"",onClick:e[7]||(e[7]=u=>o.$emit("closeDialog",null))}),a(k,{label:"Conferma",onClick:e[8]||(e[8]=u=>t.changeStatus())})])],64)}const jt=X(Dt,[["render",Pt]]);var Ft={root:function(e){var n=e.instance;return["p-confirm-popup p-component",{"p-ripple-disabled":n.$primevue.config.ripple===!1}]},content:"p-confirm-popup-content",icon:"p-confirm-popup-icon",message:"p-confirm-popup-message",footer:"p-confirm-popup-footer",rejectButton:function(e){var n=e.instance;return["p-confirm-popup-reject",n.confirmation&&!n.confirmation.rejectClass?"p-button-sm p-button-text":null]},acceptButton:function(e){var n=e.instance;return["p-confirm-popup-accept",n.confirmation&&!n.confirmation.acceptClass?"p-button-sm":null]}},Ut=je.extend({name:"confirmpopup",classes:Ft}),Et={name:"BaseConfirmPopup",extends:_t,props:{group:String},style:Ut,provide:function(){return{$parentInstance:this}}},Be={name:"ConfirmPopup",extends:Et,inheritAttrs:!1,data:function(){return{visible:!1,confirmation:null,autoFocusAccept:null,autoFocusReject:null,target:null}},target:null,outsideClickListener:null,scrollHandler:null,resizeListener:null,container:null,confirmListener:null,closeListener:null,mounted:function(){var e=this;this.confirmListener=function(n){n&&n.group===e.group&&(e.confirmation=n,e.target=n.target,e.confirmation.onShow&&e.confirmation.onShow(),e.visible=!0)},this.closeListener=function(){e.visible=!1,e.confirmation=null},fe.on("confirm",this.confirmListener),fe.on("close",this.closeListener)},beforeUnmount:function(){fe.off("confirm",this.confirmListener),fe.off("close",this.closeListener),this.unbindOutsideClickListener(),this.scrollHandler&&(this.scrollHandler.destroy(),this.scrollHandler=null),this.unbindResizeListener(),this.container&&(De.clear(this.container),this.container=null),this.target=null,this.confirmation=null},methods:{accept:function(){this.confirmation.accept&&this.confirmation.accept(),this.visible=!1},reject:function(){this.confirmation.reject&&this.confirmation.reject(),this.visible=!1},onHide:function(){this.confirmation.onHide&&this.confirmation.onHide(),this.visible=!1},onAcceptKeydown:function(e){(e.code==="Space"||e.code==="Enter"||e.code==="NumpadEnter")&&(this.accept(),ie.focus(this.target),e.preventDefault())},onRejectKeydown:function(e){(e.code==="Space"||e.code==="Enter"||e.code==="NumpadEnter")&&(this.reject(),ie.focus(this.target),e.preventDefault())},onEnter:function(e){this.autoFocusAccept=this.confirmation.defaultFocus===void 0||this.confirmation.defaultFocus==="accept",this.autoFocusReject=this.confirmation.defaultFocus==="reject",this.target=document.activeElement,this.bindOutsideClickListener(),this.bindScrollListener(),this.bindResizeListener(),De.set("overlay",e,this.$primevue.config.zIndex.overlay)},onAfterEnter:function(){this.focus()},onLeave:function(){this.autoFocusAccept=null,this.autoFocusReject=null,ie.focus(this.target),this.target=null,this.unbindOutsideClickListener(),this.unbindScrollListener(),this.unbindResizeListener()},onAfterLeave:function(e){De.clear(e)},alignOverlay:function(){ie.absolutePosition(this.container,this.target,!1);var e=ie.getOffset(this.container),n=ie.getOffset(this.target),t=0;e.left<n.left&&(t=n.left-e.left),this.container.style.setProperty("--overlayArrowLeft","".concat(t,"px")),e.top<n.top&&(this.container.setAttribute("data-p-confirm-popup-flipped","true"),!this.isUnstyled&&ie.addClass(this.container,"p-confirm-popup-flipped"))},bindOutsideClickListener:function(){var e=this;this.outsideClickListener||(this.outsideClickListener=function(n){e.visible&&e.container&&!e.container.contains(n.target)&&!e.isTargetClicked(n)?(e.confirmation.onHide&&e.confirmation.onHide(),e.visible=!1):e.alignOverlay()},document.addEventListener("click",this.outsideClickListener))},unbindOutsideClickListener:function(){this.outsideClickListener&&(document.removeEventListener("click",this.outsideClickListener),this.outsideClickListener=null)},bindScrollListener:function(){var e=this;this.scrollHandler||(this.scrollHandler=new dt(this.target,function(){e.visible&&(e.visible=!1)})),this.scrollHandler.bindScrollListener()},unbindScrollListener:function(){this.scrollHandler&&this.scrollHandler.unbindScrollListener()},bindResizeListener:function(){var e=this;this.resizeListener||(this.resizeListener=function(){e.visible&&!ie.isTouchDevice()&&(e.visible=!1)},window.addEventListener("resize",this.resizeListener))},unbindResizeListener:function(){this.resizeListener&&(window.removeEventListener("resize",this.resizeListener),this.resizeListener=null)},focus:function(){var e=this.container.querySelector("[autofocus]");e&&e.focus({preventScroll:!0})},isTargetClicked:function(e){return this.target&&(this.target===e.target||this.target.contains(e.target))},containerRef:function(e){this.container=e},onOverlayClick:function(e){ut.emit("overlay-click",{originalEvent:e,target:this.target})},onOverlayKeydown:function(e){e.code==="Escape"&&(fe.emit("close",this.closeListener),ie.focus(this.target))},getCXOptions:function(e,n){return{contenxt:{icon:e,iconClass:n.class}}}},computed:{message:function(){return this.confirmation?this.confirmation.message:null},acceptLabel:function(){return this.confirmation?this.confirmation.acceptLabel||this.$primevue.config.locale.accept:null},rejectLabel:function(){return this.confirmation?this.confirmation.rejectLabel||this.$primevue.config.locale.reject:null},acceptIcon:function(){return this.confirmation?this.confirmation.acceptIcon:null},rejectIcon:function(){return this.confirmation?this.confirmation.rejectIcon:null}},components:{CPButton:mt,Portal:ft},directives:{focustrap:pt}},Rt=["aria-modal"];function Bt(o,e,n,t,y,_){var i=C("CPButton"),f=C("Portal"),k=pe("focustrap");return p(),Q(f,null,{default:w(function(){return[a(vt,ce({name:"p-confirm-popup",onEnter:_.onEnter,onAfterEnter:_.onAfterEnter,onLeave:_.onLeave,onAfterLeave:_.onAfterLeave},o.ptm("transition")),{default:w(function(){return[y.visible?de((p(),g("div",ce({key:0,ref:_.containerRef,role:"alertdialog",class:o.cx("root"),"aria-modal":y.visible,onClick:e[2]||(e[2]=function(){return _.onOverlayClick&&_.onOverlayClick.apply(_,arguments)}),onKeydown:e[3]||(e[3]=function(){return _.onOverlayKeydown&&_.onOverlayKeydown.apply(_,arguments)})},o.ptmi("root")),[o.$slots.container?ge(o.$slots,"container",{key:0,message:y.confirmation,onAccept:_.accept,onReject:_.reject,acceptCallback:_.accept,rejectCallback:_.reject}):(p(),g(te,{key:1},[o.$slots.message?(p(),Q(Le(o.$slots.message),{key:1,message:y.confirmation},null,8,["message"])):(p(),g("div",ce({key:0,class:o.cx("content")},o.ptm("content")),[ge(o.$slots,"icon",{},function(){return[o.$slots.icon?(p(),Q(Le(o.$slots.icon),{key:0,class:J(o.cx("icon"))},null,8,["class"])):y.confirmation.icon?(p(),g("span",ce({key:1,class:[y.confirmation.icon,o.cx("icon")]},o.ptm("icon")),null,16)):A("",!0)]}),l("span",ce({class:o.cx("message")},o.ptm("message")),x(y.confirmation.message),17)],16)),l("div",ce({class:o.cx("footer")},o.ptm("footer")),[a(i,{label:_.rejectLabel,onClick:e[0]||(e[0]=function(d){return _.reject()}),onKeydown:_.onRejectKeydown,autofocus:y.autoFocusReject,class:J([o.cx("rejectButton"),y.confirmation.rejectClass]),unstyled:o.unstyled,pt:o.ptm("rejectButton")},Ae({_:2},[_.rejectIcon||o.$slots.rejecticon?{name:"icon",fn:w(function(d){return[ge(o.$slots,"rejecticon",{},function(){return[l("span",ce({class:[_.rejectIcon,d.class]},o.ptm("rejectButton").icon,{"data-pc-section":"rejectbuttonicon"}),null,16)]})]}),key:"0"}:void 0]),1032,["label","onKeydown","autofocus","class","unstyled","pt"]),a(i,{label:_.acceptLabel,onClick:e[1]||(e[1]=function(d){return _.accept()}),onKeydown:_.onAcceptKeydown,autofocus:y.autoFocusAccept,class:J([o.cx("acceptButton"),y.confirmation.acceptClass]),unstyled:o.unstyled,pt:o.ptm("acceptButton")},Ae({_:2},[_.acceptIcon||o.$slots.accepticon?{name:"icon",fn:w(function(d){return[ge(o.$slots,"accepticon",{},function(){return[l("span",ce({class:[_.acceptIcon,d.class]},o.ptm("acceptButton").icon,{"data-pc-section":"acceptbuttonicon"}),null,16)]})]}),key:"0"}:void 0]),1032,["label","onKeydown","autofocus","class","unstyled","pt"])],16)],64))],16,Rt)),[[k]]):A("",!0)]}),_:3},16,["onEnter","onAfterEnter","onLeave","onAfterLeave"])]}),_:3})}Be.render=Bt;const It={props:["order"],setup(o,{emit:e}){Y(()=>{c.value&&O.value&&c.value.forEach(U=>{U.permalink===O.value&&(i.value=U.name)})});const n=D(0),t=D([]),y=D(!1),_=D(!0),i=D(),f=yt(),k=D([]),d=D({}),u=D(null),m=D(!1),h=D({...o.order});le(()=>o.order,U=>{Object.assign(h,U)});const V=xe(),r=oe(),s=$(),F=_e(),j=P(()=>V.allTickets),T=P(()=>r.getCurrentOrder),O=P(()=>F.getCurrentLocation),c=P(()=>F.allLocations),S=P(()=>{const U=o.order.payment_method,I=r.getPaymentMethods;return U?I[U]:"-"}),b=P(()=>{const U=r.getPaymentMethods;return Object.entries(U).map(([I,q])=>({id:I,label:q}))}),B=P(()=>r.paymentMethodAccountList),se=[{label:"Acconto",value:"deposit"},{label:"Saldo",value:"balance"}],L=U=>U==="deposit"?"Acconto":U==="balance"?"Saldo":"-",z=(U,I)=>{u.value=U,f.require({target:I.currentTarget,message:"Sei sicuro di voler eliminare questo acconto?",icon:"pi pi-info-circle",rejectClass:"p-button-secondary p-button-outlined p-button-sm",acceptClass:"p-button-danger p-button-sm",rejectLabel:"Annulla",acceptLabel:"Elimina",accept:async()=>{var q;await r.deletePayment({location:((q=O.value)==null?void 0:q.permalink)??"",id:o.order.id,payment_id:u.value.id}),await re(),Z(s,{message:"Acconto eliminato con successo",error:!1})}})},H=function(){let U={amount:"",payment_method:"",typology:"",id:"-1"};h.value.payments.push(U),k.value.push(U)},ae=async function(U){var I,q;m.value=!0;try{let{newData:G}=U;const ve={amount:G.amount,payment_method:G.payment_method,typology:G.typology,paid_at:be(G.paid_at)};G.id!=-1?await r.updatePayment({location:((I=O.value)==null?void 0:I.permalink)??"",id:o.order.id,payment_id:G.id,payment:ve}):await r.createPayment({location:((q=O.value)==null?void 0:q.permalink)??"",id:o.order.id,payment:ve}),await re()}catch(G){R(s,G)}finally{m.value=!1}},ne=function(U,I){d.value.payments.splice(I,1)},re=async function(){var U;try{const I=await r.getPayment({location:((U=O.value)==null?void 0:U.permalink)??"",id:o.order.id});h.value.payments.splice(0,h.value.payments.length,...I.payments),h.value.paid_amount=I.paid_amount,h.value.remaining_amount=I.remaining_amount}catch{h.value.remaining_amount="0.0",h.value.paid_amount="0.0",h.value.payments=[]}};return{tickets:j,active:n,partialTotals:t,showOrderDetail:y,currentOrder:T,showSecondTab:_,currentLocation:O,selectedLocation:i,editingRows:k,localOrder:h,loadingPayments:m,formatExplicitDate:Ue,formatDate:Ve,confirm1:z,addAmount:H,onRowEditSave:ae,deleteSlot:ne,dynamicPaymentMethods:b,typologyOptions:se,getPayments:re,paymentMethodAccountList:B,prettyPaymentStatus:Ee,formatPrettyDate:bt,formatDataAndHourFromUnixTimestamps:kt,prettyPaymentMethod:wt,methodLabel:S,prettyTypology:L}},components:{ConfirmPopup:Be}};const zt={class:"mt-3 line-height-3"},qt={class:"flex gap-3"},Ht={class:"m-0 mb-1"},Kt={class:"m-0 mb-1"},Jt={class:"m-0 mb-1"},Gt={class:"m-0 mb-1"},Wt={key:0},Qt={class:"flex gap-3 mt-4"},Xt={class:"m-0 mb-1"},Zt={class:"m-0 mb-1"},Yt={key:0,class:"m-0 mb-1"},$t={class:"flex gap-3 mt-4"},eo={class:"m-0 mb-1"},to={class:"m-0 mb-1"},oo={class:"m-0 mb-1"},no={key:0,class:"m-0 mb-1"},lo={key:1,class:"m-0 mb-1"},ao={key:2,class:"m-0 mb-1"},io={class:"m-0 mb-1"},so={class:"m-0 mb-1"},ro={key:0},co={key:1},uo={class:"m-0 mb-1"},mo={key:0},fo={key:1},po={class:"m-0 mb-1"},_o={key:0},vo={key:1},yo={class:"ml-5"},go={class:"field flex justify-content-between align-items-end mt-4 mb-3"},ho={key:1,class:"flex gap-3 mt-4"};function bo(o,e,n,t,y,_){const i=C("Badge"),f=C("Button"),k=C("InputNumber"),d=C("Column"),u=C("Calendar"),m=C("Dropdown"),h=C("DataTable"),V=C("ConfirmPopup");return p(),g("div",zt,[l("div",qt,[e[3]||(e[3]=l("i",{class:"pi pi-user mt-1"},null,-1)),l("div",null,[l("p",Ht,x(n.order.user_name)+" "+x(n.order.user_surname||"-"),1),l("p",Kt,x(n.order.user_email),1),l("p",Jt,x(n.order.user_phone),1),l("p",Gt,[E(x(n.order.country)+" ",1),n.order.user_zip?(p(),g("span",Wt," - "+x(n.order.user_zip),1)):A("",!0)])])]),l("div",Qt,[e[4]||(e[4]=l("i",{class:"pi pi-map-marker mt-1"},null,-1)),l("div",null,[l("p",Xt,x(t.selectedLocation),1),l("p",Zt,x(n.order.course_name),1),n.order.date?(p(),g("p",Yt,x(t.formatPrettyDate(n.order.date))+" "+x(n.order.start_at),1)):A("",!0)])]),l("div",$t,[e[8]||(e[8]=l("i",{class:"pi pi-shopping-cart mt-1"},null,-1)),l("div",null,[l("p",eo,x(n.order.reservation_number),1),l("p",to,x(t.formatDataAndHourFromUnixTimestamps(n.order.created_at)),1),l("p",oo,x(n.order.created_by),1),n.order.status?(p(),g("p",no,[a(i,{value:t.prettyPaymentStatus(n.order.status),class:J([n.order.status,"px-3 border-round-lg"])},null,8,["value","class"])])):A("",!0),n.order.status=="payed"?(p(),g("p",lo,x(t.methodLabel),1)):A("",!0),n.order.open_tickets_used&&n.order.status=="payed"?(p(),g("p",ao,[(p(!0),g(te,null,he(n.order.open_tickets_used,r=>(p(),g("span",{key:r},[a(i,{value:r.code,class:"mr-2 voucher"},null,8,["value"])]))),128))])):A("",!0),l("p",io," Codice sconto utilizzato: "+x(t.localOrder.discount_code||"-"),1),l("p",so,[e[5]||(e[5]=E(" Totale ordine: ",-1)),t.localOrder.total?(p(),g("span",ro,"€ "+x((+t.localOrder.total).toFixed(2)),1)):(p(),g("span",co,"-"))]),t.localOrder.multi_payment&&t.localOrder.paid_amount!="0.0"?(p(),g(te,{key:3},[l("p",uo,[e[6]||(e[6]=E(" Acconto versato: ",-1)),t.localOrder.paid_amount?(p(),g("span",mo,"€ "+x((+t.localOrder.paid_amount).toFixed(2)),1)):(p(),g("span",fo,"-"))]),l("p",po,[e[7]||(e[7]=E(" Saldo rimanente: ",-1)),t.localOrder.remaining_amount?(p(),g("span",_o,"€ "+x((+t.localOrder.remaining_amount).toFixed(2)),1)):(p(),g("span",vo,"-"))])],64)):t.localOrder.multi_payment&&(!t.localOrder.payments||t.localOrder.payments.length===0)?(p(),Q(f,{key:4,label:"Acconto / Saldo",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[0]||(e[0]=r=>t.addAmount()),class:"mt-2"})):A("",!0)])]),t.localOrder.payments&&t.localOrder.payments.length?(p(),g(te,{key:0},[l("div",yo,[l("div",go,[e[9]||(e[9]=l("label",null,"Pagamenti",-1)),t.localOrder.remaining_amount!=="0.0"?(p(),Q(f,{key:0,label:"Acconto / Saldo",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[1]||(e[1]=r=>t.addAmount())})):A("",!0)]),a(h,{value:t.localOrder.payments,dataKey:"id",size:"small",editingRows:t.editingRows,"onUpdate:editingRows":e[2]||(e[2]=r=>t.editingRows=r),editMode:"row",onRowEditSave:t.onRowEditSave,loading:t.loadingPayments},{default:w(()=>[a(d,{field:"amount",header:"Importo"},{editor:w(({data:r,field:s})=>[a(k,{modelValue:r[s],"onUpdate:modelValue":F=>r[s]=F,inputId:"currency-germany",mode:"currency",currency:"EUR",locale:"it-IT",class:"w-full"},null,8,["modelValue","onUpdate:modelValue"])]),body:w(r=>[E(x(r.data.amount?Number(r.data.amount).toFixed(2):"0.00")+" € ",1)]),_:1}),a(d,{field:"paid_at",header:"Data pagamento"},{body:w(r=>[E(x(r.data.paid_at),1)]),editor:w(({data:r,field:s})=>[a(u,{modelValue:r[s],"onUpdate:modelValue":F=>r[s]=F},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(d,{field:"payment_method",header:"Metodo"},{editor:w(({data:r,field:s})=>[a(m,{modelValue:r[s],"onUpdate:modelValue":F=>r[s]=F,options:t.dynamicPaymentMethods,optionLabel:"label",optionValue:"id",class:"w-full",placeholder:"Seleziona metodo..."},null,8,["modelValue","onUpdate:modelValue","options"])]),body:w(r=>[E(x(t.prettyPaymentMethod(r.data.payment_method)),1)]),_:1}),a(d,{field:"typology",header:"Tipologia"},{editor:w(({data:r,field:s})=>[a(m,{modelValue:r[s],"onUpdate:modelValue":F=>r[s]=F,options:t.typologyOptions,optionLabel:"label",optionValue:"value",class:"w-full",placeholder:"Seleziona tipologia"},null,8,["modelValue","onUpdate:modelValue","options"])]),body:w(r=>[E(x(t.prettyTypology(r.data.typology)),1)]),_:1}),a(d,{rowEditor:!0,style:{width:"8rem"},bodyStyle:"text-align:right"}),a(d,{header:""},{body:w(r=>[r.data.id!=="-1"?(p(),Q(f,{key:0,icon:"pi pi-trash",class:"p-button-text p-button-sm p-button-danger",onClick:s=>t.confirm1(r.data,s)},null,8,["onClick"])):A("",!0)]),_:1})]),_:1},8,["value","editingRows","onRowEditSave","loading"])]),a(V)],64)):A("",!0),n.order.notes?(p(),g("div",ho,[e[10]||(e[10]=l("i",{class:"pi pi-comment mt-1"},null,-1)),l("div",null,x(n.order.notes),1)])):A("",!0)])}const ko=X(It,[["render",bo]]),Co={props:["order","location_permalink"],setup(o,e){Y(()=>{o.order&&o.order.notes&&(n.value=o.order.notes)});const n=D(),{showLoader:t,hideLoader:y}=me(),_=$(),i=oe(),f=P(()=>i.getCurrentOrder);return{notes:n,updateOrder:async function(){const d={id:o.location_permalink,order_id:o.order.id,notes:n.value,api_version:"v2"};t(),await i.updateOrder(d).then(()=>{y(),Z(_,{message:"Nota aggiornata correttamente",error:!1}),e.emit("closeDialog",f.value)}).catch(u=>{y(),R(_,u)})}}}},wo={class:"pt-5 px-2"},xo={class:"flex align-items-center justify-content-end mt-3"};function Do(o,e,n,t,y,_){const i=C("Textarea"),f=C("Button");return p(),g("div",wo,[a(i,{modelValue:t.notes,"onUpdate:modelValue":e[0]||(e[0]=k=>t.notes=k),rows:"8",cols:"30",class:"w-full"},null,8,["modelValue"]),l("div",xo,[a(f,{label:"Annulla",text:"",onClick:e[1]||(e[1]=k=>o.$emit("closeDialog",null))}),a(f,{label:"Conferma",onClick:e[2]||(e[2]=k=>t.updateOrder())})])])}const Oo=X(Co,[["render",Do]]),So={props:["order","location_permalink","date"],setup(o,e){Y(()=>{var m;o.order&&o.order.note&&(n.value=(m=o.order.note)==null?void 0:m.note)});const n=D(),{showLoader:t,hideLoader:y}=me(),_=$(),i=oe(),f=async function(){var h;const m={location:o.location_permalink,time_slot_note:{course_id:o.order.course_id,start_at:o.order.start_at,date:o.date,note:n.value}};(h=o.order.note)!=null&&h.id?k(m):d(m)},k=async function(m){t(),m.id=o.order.note.id,await i.updateNote(m).then(()=>{y(),Z(_,{message:"Nota aggiornata correttamente",error:!1}),e.emit("closeDialog",null)}).catch(h=>{y(),R(_,h)})},d=async function(m){t(),await i.createNote(m).then(()=>{y(),Z(_,{message:"Nota creata correttamente",error:!1}),e.emit("closeDialog",null)}).catch(h=>{y(),R(_,h)})};return{notes:n,addNote:f,deleteNote:async function(){const m={location:o.location_permalink,id:o.order.note.id};t(),await i.deleteNote(m).then(()=>{y(),Z(_,{message:"Nota eliminata correttamente",error:!1}),e.emit("closeDialog",null)}).catch(h=>{y(),R(_,h)})}}}},Vo={class:"pt-5 px-2"},To={class:"flex align-items-center justify-content-end mt-3"};function Lo(o,e,n,t,y,_){var k,d;const i=C("Textarea"),f=C("Button");return p(),g("div",Vo,[a(i,{modelValue:t.notes,"onUpdate:modelValue":e[0]||(e[0]=u=>t.notes=u),rows:"8",cols:"30",class:"w-full"},null,8,["modelValue"]),l("div",To,[(d=(k=n.order)==null?void 0:k.note)!=null&&d.id?(p(),Q(f,{key:0,label:"Elimina",text:"",onClick:e[1]||(e[1]=u=>t.deleteNote()),severity:"danger",class:"mr-2"})):A("",!0),a(f,{label:"Conferma",onClick:e[2]||(e[2]=u=>t.addNote())})])])}const Ao=X(So,[["render",Lo]]),No={props:["filters"],setup(o,e){Y(()=>{T.value=!0,O.value={first:0,rows:V.value.rows,sortField:null,sortOrder:null},O.value.page=0,o.filters.location&&ne()});const n=oe(),t=Te(),y=P(()=>n.responseOrders),_=P(()=>n.status),i=gt(),f=P(()=>i.submitDialog),k=P(()=>n.paymentStatus),d=P(()=>n.getDeleteResponse),{showLoader:u,hideLoader:m}=me(),h=$(),V=D(),r=D(),s=D(),F=D(),j=D(),T=D(!0),O=D(),c=D(0),S=D([]),b=D([]),B=D(!1),se=D(!1),L=D(),z=D(!1),H=D(!1),ae=D();function ne(){T.value=!0;let v=new Map;for(const N in o.filters){if(N=="date"){let M="";ke(o.filters.date)=="Invalid DateTime"?M=be(o.filters.date):M=ke(o.filters.date),v.set("date",M),ae.value=M}else o.filters.location&&v.set("location_permalink",o.filters.location.permalink);N=="course"&&o.filters.course.id!="-1"&&v.set("course",o.filters.course.id),N=="hour"&&o.filters.hour!="Tutti gli orari"&&v.set("hour",o.filters.hour),N=="name"&&v.set("name",o.filters.name)}setTimeout(()=>{re(v)},Math.random()*1e3+250)}const re=async function(v){await n.fetchAllOrders(v).then(()=>{T.value=!1}).catch(N=>{T.value=!1,R(h,N)})},U=v=>{s.value.toggle(v),L.value.toggle(v)},I=(v,N)=>v>v+N?"red":"green",q=function(v,N){N&&(s.value.note=N,s.value.toggle(v))},G=function(v){v.order&&y.value.time_slots&&y.value.time_slots.forEach((N,M)=>{N.orders.forEach((K,W)=>{K.id==v.order.id&&(y.value.time_slots[M].orders[W]=v.order,v.check_in_done!=null&&(y.value.time_slots[M].check_in_done+=v.check_in_done))})})},ve=async function(v,N){let M=[],K=!1;b.value.forEach(ee=>{if(ee.id==v.id){K=!0;return}});for(let ee of v.tickets)M.push(ee.order_item_id);const W={check_in:N,order_item_ids:M,location_permalink:o.filters.location};await n.checkInOrder(W).then(()=>{G(d.value),Z(h,{message:"Check-in registrato correttamente",error:!1}),K&&ye(b.value,d.value.order)}).catch(ee=>{R(h,ee)})},ze=async function(v,N){let M=[],K=!1;b.value.forEach(ee=>{if(ee.id==v.id){K=!0;return}});for(let ee of v.tickets)M.push(ee.order_item_id);const W={order_item_ids:M,no_show:N,location_permalink:o.filters.location.permalink};await n.noShowOrder(W).then(()=>{G(d.value),Z(h,{message:"No-show registrato correttamente",error:!1}),K&&ye(b.value,d.value.order)}).catch(ee=>{R(h,ee)})},qe=async function(v,N,M){const K={id:v,check_in:N,location_permalink:o.filters.location.permalink};await n.checkInTicket(K).then(()=>{Z(h,{message:"Check-in registrato correttamente",error:!1}),G(d.value),ye(b.value,d.value.order)}).catch(W=>{R(h,W)})},He=async function(v,N,M){const K={id:v,no_show:N,location_permalink:o.filters.location.permalink};await n.noShowTicket(K).then(()=>{Z(h,{message:"No-show registrato correttamente",error:!1}),G(d.value),ye(b.value,d.value.order)}).catch(W=>{R(h,W)})},ye=function(v,N){let M=Ke(b.value,d.value.order.id);M!=-1&&b.value.splice(M,1),b.value.push(d.value.order)},Ke=function(v,N){for(let M=0;M<v.length;M++)if(v[M].id===N)return M;return-1},Je=function(v){const N={course_name:v.course_name,start_at:v.start_at,date:o.filters.date,hour:v.start_at,max_seats:v.is_free_slot?null:v.remaing_seats+""};e.emit("updateFilters",N)},Ge=function(v){B.value=!0,F.value=v},We=function(v){G({order:v}),B.value=!1,z.value=!1},Qe=function(){H.value=!1,ne()},Xe=function(v){return v!=null&&v.created_by&&(v==null?void 0:v.created_by)=="WEB"?"WEB":"KALATA"},Ze=function(v,N){let M=0;if(v&&v.tickets){v.tickets.forEach(W=>{N?W.no_show&&(M+=1):W.check_in&&(M+=1)});let K=v.tickets.length;if(M!=K&&M!=0)return M+"/"+K}},Ye=function(v,N){L.value.data=N,L.value.toggle(v)},$e=function(v,N){j.value=N.id;let M="Sei sicuro di voler eliminare questa prenotazione?";M+='<br><br> <i>N.B. Eventuali voucher presenti nella prenotazione vanno liberati manualmente dalla sezione "Data aperta"</i>',i.setDialog("Elimina prenotazione","Elimina","Annulla",M),i.setBtnSubmit(!1),i.setDynamicDialogVisibility(!0)},et=function(){if(u(),j.value){const v={id:j.value,location_permalink:o.filters.location.permalink};n.deleteOrder(v).then(()=>{m(),Z(h,{message:"La prenotazione è stata eliminata correttamente",error:!1}),y.value.time_slots&&y.value.time_slots.forEach((N,M)=>{N.orders.forEach((K,W)=>{K.id==j.value&&(y.value.time_slots[M].orders.splice(W,1),d.value,y.value.time_slots[M].check_in_done+=d.value.check_in_done,y.value.time_slots[M].confirmed_seats+=d.value.confirmed_seats,y.value.time_slots[M].remaing_seats-=d.value.confirmed_seats)})})}).catch(N=>{m(),R(h,N)})}},tt=function(v){S.value=v.data?[v.data]:[]},ot=function(v){b.value=v.data?[v.data]:[]},nt=function(v){se.value=!0,r.value=v},lt=function(v){z.value=!0,r.value=v},at=function(v){H.value=!0,r.value=v},it=function(v){const N=new Map;N.set("id",v.id),N.set("location_permalink",o.filters.location.permalink),u(),n.downloadTicket(N).then(()=>{m()}).catch(M=>{m(),R(h,M)})},st=function(v,N){u(),Ce(v,N.location.permalink).then(()=>{m()}).catch(()=>{m()})},rt=function(v,N){u(),Se(v,N.location.permalink).then(()=>{m()}).catch(()=>{m()})},ct=async()=>{await ne(),r.value&&r.value.id&&(await n.fetchOrderDetail(r.value.id),r.value={...n.getCurrentOrder})};return le(f,v=>{v&&et()}),le(o.filters,()=>{o.filters.location&&ne()}),{dt:V,responseOrders:y,loading:T,totalRecords:c,lazyParams:O,currentOrder:r,status:_,expandedRows:S,expandedRows1:b,op:s,dialogStore:t,paymentList:k,visibleDialog:B,currentTimeSlot:F,visibleMenu:L,visibleDetailDialog:se,visibleNotesDialog:z,toast:h,visibleAddNotesDialog:H,formattedDate:ae,loadLazyData:ne,toggle:U,getProgressClass:I,showNotes:q,checkAll:ve,noShowAll:ze,openDialog:Je,checkInSingleTicket:qe,noShowSingleTicket:He,prettyPaymentStatus:Ee,openPaymentStatusDialog:Ge,onClosePaymentStatusDialog:We,getRowClass:Xe,printPDF:Se,showLabelCheckbox:Ze,confirmDeleteOrder:$e,showMenu:Ye,openOrderDetailDialog:nt,openNotesDialog:lt,downloadPDF:it,handleRowToggle:tt,handleRowToggle1:ot,openPDFTab:st,openPDFTicketTab:rt,onRefreshOrder:ct,openAddNotesDialog:at,onCloseNoteDialog:Qe,formatDataFromUnixTimestamps:Ct,printOrderPDF:Ce}},components:{PaymentStatusDialog:jt,OrderDetailDialog:ko,NotesDialog:Oo,AddNotesDialog:Ao}};const Mo={class:"order-table"},Po={class:""},jo={style:{width:"15rem"}},Fo={class:"m-0 text-right",style:{"font-size":"12px"}},Uo={key:0,class:"pi pi-exclamation-triangle cursor-pointer",style:{color:"var(--orange-400)"}},Eo={style:{width:"15rem"}},Ro={class:"m-0 text-right",style:{"font-size":"12px"}},Bo={key:0},Io=["onClick"],zo={key:0},qo={class:"flex justify-content-center"},Ho={class:"flex flex-column",style:{"margin-top":"8px"}},Ko={class:"text-sm",style:{"min-height":"15px"}},Jo={class:"flex justify-content-center"},Go={class:"flex flex-column",style:{"margin-top":"8px"}},Wo={class:"text-sm",style:{"min-height":"15px"}},Qo=["onClick"],Xo={class:"p-3"},Zo={class:"overlay-menu"},Yo=["onClick"],$o=["onClick"],en=["onClick"],tn=["onClick"],on=["onClick"],nn=["disabled","onClick"],ln=["disabled","onClick"],an={key:0},sn={key:1},rn={class:"flex justify-content-center"},cn={class:"flex justify-content-center"},dn={class:"flex justify-content-center"},un={key:0,class:"flex mx-4"};function mn(o,e,n,t,y,_){const i=C("Column"),f=C("ProgressBar"),k=C("Button"),d=C("Badge"),u=C("Checkbox"),m=C("OverlayPanel"),h=C("DataTable"),V=C("PaymentStatusDialog"),r=C("Dialog"),s=C("OrderDetailDialog"),F=C("NotesDialog"),j=C("AddNotesDialog"),T=pe("tooltip"),O=pe("badge");return p(),g("div",Mo,[a(h,{value:t.responseOrders.time_slots,totalRecords:t.responseOrders.total,lazy:!0,paginator:!1,ref:"dt",loading:t.loading,stripedRows:"",expandedRows:t.expandedRows,"onUpdate:expandedRows":e[1]||(e[1]=c=>t.expandedRows=c),onRowExpand:t.handleRowToggle},{empty:w(()=>e[9]||(e[9]=[E(" Nessuna prenotazione trovata. ",-1)])),expansion:w(c=>[a(h,{value:c.data.orders,class:"m-4 mx-4 table-order-detail",expandedRows:t.expandedRows1,"onUpdate:expandedRows":e[0]||(e[0]=S=>t.expandedRows1=S),rowClass:t.getRowClass,onRowExpand:t.handleRowToggle1},{empty:w(()=>e[10]||(e[10]=[E(" Nessuna prenotazione trovata. ",-1)])),expansion:w(S=>[a(h,{value:S.data.tickets,class:"m-4 mx-5"},{default:w(()=>[a(i,{header:"Codice biglietto",field:"code"}),a(i,{header:"Tipo biglietto",field:"type"},{body:w(({data:b})=>[a(d,{value:b.ticket_name,class:J([b.ticket_name,"px-3 border-round-lg"])},null,8,["value","class"])]),_:1}),a(i,{header:"Prezzo"},{body:w(({data:b})=>[b.ticket_price?(p(),g("span",an," € "+x((+b.ticket_price).toFixed(2)),1)):(p(),g("span",sn,"-"))]),_:1}),a(i,null,{header:w(()=>e[20]||(e[20]=[l("div",{class:"flex justify-content-center w-full"},"Check-in",-1)])),body:w(({data:b})=>[l("div",rn,[a(u,{modelValue:b.check_in,"onUpdate:modelValue":B=>b.check_in=B,binary:!0,onChange:B=>t.checkInSingleTicket(b.id,b.check_in,S.data),class:"check_in"},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:2},1024),a(i,null,{header:w(()=>e[21]||(e[21]=[l("div",{class:"flex justify-content-center w-full"},"No-show",-1)])),body:w(({data:b})=>[l("div",cn,[a(u,{modelValue:b.no_show,"onUpdate:modelValue":B=>b.no_show=B,binary:!0,onChange:B=>t.noShowSingleTicket(b.id,b.no_show,S.data),class:"no_show"},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:2},1024),a(i,{field:"tickets_url"},{header:w(()=>e[22]||(e[22]=[l("div",{class:"flex justify-content-center w-full"},null,-1)])),body:w(({data:b})=>[l("div",dn,[de(a(k,{link:"",icon:"pi pi-print",href:b.tickets_url,target:"_blank",style:{color:"var(--surface-400)"},text:"",rounded:"",onClick:B=>t.openPDFTicketTab(b.id,n.filters)},null,8,["href","onClick"]),[[T,"Stampa",void 0,{top:!0}]])])]),_:1})]),_:2},1032,["value"])]),default:w(()=>[a(i,{header:"Codice",field:"reservation_number"}),a(i,{header:"Acquirente"},{body:w(({data:S})=>[E(x(S.user_name)+" "+x(S.user_surname)+" ",1),!S.user_name&&!S.user_surname?(p(),g("span",Bo,"-")):A("",!0)]),_:1}),a(i,{header:"Gruppo"},{body:w(({data:S})=>[l("div",{class:"group cursor-pointer",onClick:b=>t.showNotes(b,S.group_name)},x(S.group_name||"-"),9,Io)]),_:1}),a(i,{header:"Pagamento"},{body:w(({data:S})=>[S.status?(p(),g("span",zo,[a(d,{value:t.prettyPaymentStatus(S.status),class:J([S.status,"px-3 border-round-lg"])},null,8,["value","class"])])):A("",!0)]),_:1}),a(i,{header:"Q.ta",field:"tickets_number"}),a(i,null,{header:w(()=>e[11]||(e[11]=[l("div",{class:"flex justify-content-center w-full"},"Check-in",-1)])),body:w(({data:S})=>[l("div",qo,[l("div",Ho,[a(u,{modelValue:S.check_in,"onUpdate:modelValue":b=>S.check_in=b,binary:!0,onChange:b=>t.checkAll(S,S.check_in),class:"check_in"},null,8,["modelValue","onUpdate:modelValue","onChange"]),l("span",Ko,x(t.showLabelCheckbox(S,!1)),1)])])]),_:1}),a(i,null,{header:w(()=>e[12]||(e[12]=[l("div",{class:"flex justify-content-center w-full"},"No-show",-1)])),body:w(({data:S})=>[l("div",Jo,[l("div",Go,[a(u,{modelValue:S.no_show,"onUpdate:modelValue":b=>S.no_show=b,binary:!0,onChange:b=>t.noShowAll(S,S.no_show),class:"no_show"},null,8,["modelValue","onUpdate:modelValue","onChange"]),l("span",Wo,x(t.showLabelCheckbox(S,!0)),1)])])]),_:1}),a(i,{header:"Note"},{body:w(({data:S})=>[l("div",{class:"notes cursor-pointer",onClick:b=>t.showNotes(b,S.notes)},x(S.notes||"-"),9,Qo),a(m,{ref:"op"},{default:w(()=>[l("div",Xo,x(t.op.note),1)]),_:1},512)]),_:1}),a(i,{header:"",style:{"padding-right":"0",width:"4rem"}},{body:w(({data:S})=>[a(k,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",icon:"pi pi-ellipsis-v",text:"",rounded:"",onClick:b=>t.showMenu(b,S)},null,8,["onClick"]),a(m,{ref:"visibleMenu"},{default:w(()=>[l("ul",Zo,[l("li",{onClick:b=>t.openOrderDetailDialog(t.visibleMenu.data)},e[13]||(e[13]=[l("i",{class:"pi pi-eye mr-3"},null,-1),E("Dettaglio ordine ",-1)]),8,Yo),l("li",{onClick:b=>t.openOrderDetailDialog(t.visibleMenu.data)},e[14]||(e[14]=[l("i",{class:"pi pi-shopping-cart mr-3"},null,-1),E("Dettaglio pagamento ",-1)]),8,$o),l("li",{onClick:b=>t.openPDFTab(t.visibleMenu.data,n.filters)},e[15]||(e[15]=[l("i",{class:"pi pi-print mr-3"},null,-1),E("Stampa ",-1)]),8,en),l("li",{onClick:b=>t.downloadPDF(t.visibleMenu.data)},e[16]||(e[16]=[l("i",{class:"pi pi-download mr-3"},null,-1),E("Scarica PDF ",-1)]),8,tn),l("li",{onClick:b=>t.openNotesDialog(t.visibleMenu.data)},e[17]||(e[17]=[l("i",{class:"pi pi-comment mr-3"},null,-1),E("Modifica nota ",-1)]),8,on),l("li",{disabled:!t.visibleMenu.data.can_change_status,onClick:b=>t.openPaymentStatusDialog(t.visibleMenu.data)},e[18]||(e[18]=[l("i",{class:"pi pi-pencil mr-3"},null,-1),E("Cambia stato ",-1)]),8,nn),l("li",{disabled:!t.visibleMenu.data.can_cancel,onClick:b=>t.confirmDeleteOrder(b,t.visibleMenu.data)},e[19]||(e[19]=[l("i",{class:"pi pi-trash mr-3"},null,-1),E("Elimina ",-1)]),8,ln)])]),_:2},1536)]),_:1}),a(i,{expander:"",class:"pl-0 ml-0"})]),_:2},1032,["value","expandedRows","rowClass","onRowExpand"]),c.data.orders&&c.data.orders.length>0?(p(),g("div",un,e[23]||(e[23]=[l("div",null,[l("div",{class:"p-0 m-0 flex align-items-center"},[l("p",{style:{width:"2rem",height:"5px"},class:"mr-2 web my-0"}),l("span",{class:"text-sm"},"WEB")]),l("div",{class:"p-0 m-0 flex align-items-center justify-content-between"},[l("p",{style:{width:"2rem",height:"5px"},class:"mr-2 kalata"}),l("span",{class:"text-sm"},"SUPERGA")])],-1)]))):A("",!0)]),default:w(()=>[a(i,{header:"Percorso",field:"course_name",filterMatchMode:"contains",ref:"course_name"},null,512),a(i,{header:"Orario",field:"start_at",filterMatchMode:"contains",ref:"start_at"},{body:w(({data:c})=>[l("div",Po,[l("span",{class:J(c.is_free_slot?"free":"")},x(c.start_at),3)])]),_:1},512),a(i,{header:"Posti prenotati",ref:"availabe_tickets",field:"availabe_tickets"},{body:w(({data:c})=>[l("div",jo,[l("p",Fo,[E(x(c.confirmed_seats)+"/"+x(c.remaing_seats+c.confirmed_seats)+" ",1),c.confirmed_seats>c.remaing_seats+c.confirmed_seats?de((p(),g("i",Uo,null,512)),[[T,c.confirmed_seats-(c.remaing_seats+c.confirmed_seats)+" posti in overbooking",void 0,{top:!0}]]):A("",!0)]),a(f,{value:c.confirmed_seats*100/(c.remaing_seats+c.confirmed_seats),showValue:!1,style:{height:"10px"},class:J(["available-progress",t.getProgressClass(c.confirmed_seats,c.remaing_seats)])},null,8,["value","class"])])]),_:1},512),a(i,{header:"Check-in",ref:"confirmed_tickets",field:"confirmed_tickets"},{body:w(({data:c})=>[l("div",Eo,[l("p",Ro,x(c.check_in_done)+"/"+x(c.confirmed_seats),1),a(f,{value:c.check_in_done*100/(c.remaing_seats+c.confirmed_seats),showValue:!1,style:{height:"10px"},class:"check-in-progress"},null,8,["value"])])]),_:1},512),a(i,null,{body:w(({data:c})=>[de(a(k,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",class:J(["mr-2 text-primary",{"is-present":c.note&&c.note!==0}]),icon:"pi pi-comment",text:"",rounded:"",onClick:S=>t.openAddNotesDialog(c)},null,8,["class","onClick"]),[[T,"Nota",void 0,{top:!0}],[O,void 0,void 0,{danger:!0}]]),de(a(k,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-0 text-primary",icon:"pi pi-calendar",text:"",rounded:"",onClick:S=>t.openDialog(c)},null,8,["onClick"]),[[T,"Prenota",void 0,{top:!0}]])]),_:1}),a(i,{expander:"",style:{width:"5rem"}})]),_:1},8,["value","totalRecords","loading","expandedRows","onRowExpand"]),a(r,{visible:t.visibleDialog,"onUpdate:visible":e[3]||(e[3]=c=>t.visibleDialog=c),modal:"",header:"Stato pagamento",style:{width:"35rem"}},{default:w(()=>[a(V,{location_permalink:n.filters.location.permalink,time_slot:t.currentTimeSlot,onCloseDialog:e[2]||(e[2]=c=>t.onClosePaymentStatusDialog(c))},null,8,["location_permalink","time_slot"])]),_:1},8,["visible"]),a(r,{visible:t.visibleDetailDialog,"onUpdate:visible":e[4]||(e[4]=c=>t.visibleDetailDialog=c),modal:"",header:"Dettaglio ordine",style:{width:"70rem"},onAfterHide:t.loadLazyData},{default:w(()=>[a(s,{order:t.currentOrder},null,8,["order"])]),_:1},8,["visible","onAfterHide"]),a(r,{visible:t.visibleNotesDialog,"onUpdate:visible":e[6]||(e[6]=c=>t.visibleNotesDialog=c),modal:"",header:"Modifica nota",style:{width:"35rem"}},{default:w(()=>[a(F,{order:t.currentOrder,location_permalink:n.filters.location.permalink,onCloseDialog:e[5]||(e[5]=c=>t.onClosePaymentStatusDialog(c))},null,8,["order","location_permalink"])]),_:1},8,["visible"]),a(r,{visible:t.visibleAddNotesDialog,"onUpdate:visible":e[8]||(e[8]=c=>t.visibleAddNotesDialog=c),modal:"",header:"Nota",style:{width:"35rem"}},{default:w(()=>[a(j,{date:t.formattedDate,order:t.currentOrder,location_permalink:n.filters.location.permalink,onCloseDialog:e[7]||(e[7]=c=>t.onCloseNoteDialog(c))},null,8,["date","order","location_permalink"])]),_:1},8,["visible"])])}const fn=X(No,[["render",mn]]),pn={props:["filters"],setup(o,e){Y(()=>{h(),n.value=o.filters,n.value.date=new Date,s()});const n=D({}),t=_e(),y=oe(),_=$(),i=D([]),f=D(),k=ue.now().plus({years:1}),d=P(()=>t.allLocations),u=P(()=>y.getCalendar),m=async function(T){await y.fetchCalendar(T).then(()=>{}).catch(O=>{R(_,O)})},h=async function(){await t.fetchAllLocations().then(()=>{}).catch(T=>{R(_,T)})},V=function(){if(o.filters.location){const T=d.value.find(O=>O.permalink===o.filters.location);i.value=T.courses}},r=function(T){let O={};O.month=ue.fromJSDate(new Date(T)).month,O.year=ue.fromJSDate(new Date(T)).year,O.location_permalink=o.filters.location.permalink?o.filters.location.permalink:o.filters.location,f.value={month:O.month,year:O.year},m(O)},s=function(){let T=ue.now(),O={location_permalink:"",month:"",year:""};O.location_permalink=o.filters.location.permalink?o.filters.location.permalink:o.filters.location,O.month=T.month+"",O.year=T.year+"",m(O)},F=function(T){if(u.value.web_dates&&u.value.web_dates.length!=0){let O=T.month+1;O=O<10?"0"+O:O;let c=T.day<10?"0"+T.day:T.day,S=T.year+"-"+O+"-"+c;return u.value.web_dates.find(b=>b==S)}},j=function(T){let O={location_permalink:o.filters.location.permalink?o.filters.location.permalink:o.filters.location,month:T.month,year:T.year};m(O)};return le(o.filters,()=>{if(f.value){let T={location_permalink:o.filters.location.permalink?o.filters.location.permalink:o.filters.location,month:f.value.month,year:f.value.year};m(T)}else s()}),{form:n,courses:i,maxAllowedDate:k,locations:d,calendar:u,getCourses:V,onDateChange:r,getDayFromDate:F,onMonthChange:j}}};const _n={class:"flex calendar-filter"},vn={key:0,class:"special-day"};function yn(o,e,n,t,y,_){const i=C("Calendar");return p(),g("div",_n,[a(i,{modelValue:t.form.date,"onUpdate:modelValue":e[0]||(e[0]=f=>t.form.date=f),inline:"",onDateSelect:e[1]||(e[1]=f=>t.onDateChange(f)),onMonthChange:e[2]||(e[2]=f=>t.onMonthChange(f)),maxDate:t.maxAllowedDate.toJSDate()},{date:w(f=>[t.getDayFromDate(f.date)?(p(),g("div",vn,[l("span",null,x(f.date.day),1)])):(p(),g(te,{key:1},[E(x(f.date.day),1)],64))]),_:1},8,["modelValue","maxDate"])])}const gn=X(pn,[["render",yn]]);class hn{static async fetchAll(e){const n=e.location_permalink;return delete e.location_permalink,(await Oe(`/ticket_office/${n}/search/courses`,e)).data}}const Ie=we({id:"course",state:()=>({course:{},courses:[],response_courses:{}}),getters:{allCourses:o=>o.response_courses.tickets,responseCourses:o=>o.response_courses,getTotalCourses:o=>o.response_courses?o.response_courses.total:0,getCurrentCourse:o=>o.course},actions:{async fetchAllCourses(o){await hn.fetchAll(o).then(e=>this.response_courses=e)}}}),bn={props:["filters"],setup(o,e){Y(()=>{n.value=Object.assign({},o.filters),n.value.date=ue.now().toFormat("dd/MM/yyyy"),i.value=Re(8,20),i.value.unshift("Tutti gli orari"),n.value.hour="Tutti gli orari"});const n=D({}),t=D([]),y=_e(),_=$(),i=D([]),f=oe(),k=Ie(),d=P(()=>y.allLocations),u=P(()=>f.responseOrders),m=P(()=>k.allCourses),h=function(){n.value.name=null,n.value.course=t.value[0].name,n.value.hour=i.value[0],e.emit("onSubmit",n.value)},V=async function(){const r={location_permalink:n.value.location.permalink,api_version:"v2"};await k.fetchAllCourses(r).then(()=>{}).catch(s=>{R(_,s)})};return le(d,()=>{o.filters.location&&d.value&&(n.value=Object.assign({},o.filters),n.value.hour||(n.value.hour="Tutti gli orari"),V())}),le(o.filters,()=>{o.filters.location&&d.value&&n.value.location&&n.value.location!=o.filters.location&&(n.value=Object.assign({},o.filters),n.value.hour||(n.value.hour="Tutti gli orari"))}),le(m,()=>{var r;t.value=Object.assign([],m.value),t.value&&((r=t.value[0])==null?void 0:r.id)!="-1"&&t.value.unshift({id:"-1",name:"Tutti i percorsi"}),n.value.course=t.value[0].name}),{form:n,courses:t,hours:i,locations:d,responseOrders:u,resetField:h}}},kn={class:"formgrid grid px-0 align-items-center"},Cn={key:0,class:"field col-4 flex flex-column"},wn={key:1,class:"field col-3 flex flex-column"},xn={class:"field col-4 flex flex-column"},Dn={class:"flex col-12 justify-content-end pt-1"};function On(o,e,n,t,y,_){const i=C("Dropdown"),f=C("InputText"),k=C("Button"),d=C("AccordionTab"),u=C("Accordion");return p(),Q(u,{activeIndex:0},{default:w(()=>[a(d,{header:"FILTRI"},{default:w(()=>[l("div",kn,[t.form.location&&t.courses?(p(),g("div",Cn,[e[5]||(e[5]=l("label",{for:"typology"},"Filtra per percorso",-1)),a(i,{modelValue:t.form.course,"onUpdate:modelValue":e[0]||(e[0]=m=>t.form.course=m),options:t.courses,optionLabel:"name",optionValue:"name",placeholder:""},null,8,["modelValue","options"])])):A("",!0),t.responseOrders?(p(),g("div",wn,[e[6]||(e[6]=l("label",{for:"typology"},"Filtra per orario (dalle)",-1)),a(i,{modelValue:t.form.hour,"onUpdate:modelValue":e[1]||(e[1]=m=>t.form.hour=m),options:t.hours,placeholder:""},null,8,["modelValue","options"])])):A("",!0),e[8]||(e[8]=l("div",{class:"col-12"},null,-1)),l("div",xn,[e[7]||(e[7]=l("label",{for:"typology"},"Filtra per acquirente",-1)),a(f,{modelValue:t.form.name,"onUpdate:modelValue":e[2]||(e[2]=m=>t.form.name=m),placeholder:""},null,8,["modelValue"])])]),l("div",Dn,[a(k,{label:"Ricerca",class:"mr-2",onClick:e[3]||(e[3]=m=>o.$emit("onSubmit",t.form))}),a(k,{label:"Annulla",class:"p-button-outlined",onClick:e[4]||(e[4]=m=>t.resetField())})])]),_:1})]),_:1})}const Sn=X(bn,[["render",On]]),Vn={props:["form","price","index","ticket"],setup(o,e){const n=D(0),t=function(){n.value++,_()},y=function(){n.value>0&&n.value--,_()},_=function(){n.value==null&&(n.value=0);const i={counter:n.value,price:o.price,index:o.index,ticket:o.ticket};e.emit("changeCounter",i)};return{counter:n,decrement:y,increment:t,emitEvent:_}}};const Tn={class:"btn-plus-min flex align-items-center"},Ln={class:"counter"};function An(o,e,n,t,y,_){const i=C("Button"),f=C("InputNumber");return p(),g("div",Tn,[a(i,{icon:"pi pi-minus",rounded:"",outlined:"",severity:"secondary",onClick:t.decrement,disabled:t.counter===0},null,8,["onClick","disabled"]),l("div",Ln,[a(f,{modelValue:t.counter,"onUpdate:modelValue":[e[0]||(e[0]=k=>t.counter=k),e[1]||(e[1]=k=>t.emitEvent())],min:0},null,8,["modelValue"])]),a(i,{icon:"pi pi-plus",rounded:"",outlined:"",severity:"secondary",onClick:t.increment},null,8,["onClick"])])}const Nn=X(Vn,[["render",An]]),Mn={props:["tickets","form"],setup(o,e){Y(()=>{y.value=!1,i.discount={},_.value=null,o.form.max_seats&&o.form.max_seats<0?(d.value=!0,u.value=-o.form.max_seats):d.value=!1});const n=D(0),t=D([]),y=D(!1),_=D(),i=oe(),f=$(),k=D(!1),d=D(!1),u=D(),m=P(()=>i.getDiscount),h=function(j){t.value[j.index]={partial_total:j.price*j.counter,ticket:j.ticket,quantity:j.counter},n.value=0;let T=0;t.value.forEach(O=>{n.value+=O.partial_total,T+=O.quantity}),d.value||(o.form.max_seats&&T>+o.form.max_seats?(u.value=T-+o.form.max_seats,k.value=!0):(u.value=null,k.value=!1)),_.value&&r()},V=function(){r()},r=async function(){let j=[];t.value.forEach(O=>{j.push({id:O.ticket.id,quantity:O.quantity})});const T={discount_code:_.value,location_permalink:o.form.location_permalink,tickets:j};await i.cost(T).then(()=>{}).catch(O=>{R(f,O)})};return{total:n,partialTotals:t,showDiscount:y,discountCode:_,discount:m,showAlert:k,showAlert2:d,numOverbooking:u,onChangeCounter:h,applyDiscount:V,checkDisabled:function(){let j=!1;(!t.value||t.value.length==0)&&(j=!0);let T=0;return t.value.forEach(O=>{T+=O.quantity}),T==0&&(j=!0),e.emit("disableSecondoTab",!0),j},nextTab:function(){const j={discount_code:_.value,partial_total:t.value};e.emit("nextTab",j)}}},components:{PlusMinusButton:Nn}};const Pn={key:0},jn={key:1},Fn={key:0},Un={key:1},En={key:0,class:"flex justify-content-between align-items-center"},Rn={class:"flex align-items-center col-9"},Bn={class:"col-7 pl-0"},In={class:"text-right col-2"},zn={class:"col-3 flex justify-content-end"},qn={key:2,class:"mt-3 mb-5"},Hn={class:"flex align-items-center justify-content-between py-0"},Kn={class:"col-9 flex"},Jn={class:"col-2 text-right font-bold"},Gn={class:"col-3 flex justify-content-end"};function Wn(o,e,n,t,y,_){const i=C("Message"),f=C("PlusMinusButton"),k=C("Button");return p(),g(te,null,[t.showAlert?(p(),Q(i,{key:0,severity:"warn",closable:!1},{default:w(()=>[E("Attenzione! Si sta andando in overbooking di "+x(t.numOverbooking)+" ",1),t.numOverbooking==1?(p(),g("span",Pn,"posto")):(p(),g("span",jn,"posti"))]),_:1})):A("",!0),t.showAlert2?(p(),Q(i,{key:1,severity:"warn",closable:!1},{default:w(()=>[E("Attenzione! Lo slot orario è già in overbooking di "+x(t.numOverbooking)+" ",1),t.numOverbooking==1?(p(),g("span",Fn,"posto")):(p(),g("span",Un,"posti"))]),_:1})):A("",!0),(p(!0),g(te,null,he(n.tickets,(d,u)=>{var m,h,V;return p(),g("div",{key:d.id},[((m=d.course)==null?void 0:m.id)==((h=n.form.course)==null?void 0:h.id)?(p(),g("div",En,[l("div",Rn,[l("b",Bn,x(d.name),1),l("div",In,"€ "+x((V=d.price)==null?void 0:V.toFixed(2)),1)]),l("div",zn,[a(f,{onChangeCounter:e[0]||(e[0]=r=>t.onChangeCounter(r)),price:d.price,index:u,ticket:d},null,8,["price","index","ticket"])])])):A("",!0)])}),128)),n.tickets&&n.tickets.length==0?(p(),g("div",qn,e[2]||(e[2]=[l("i",null,"Nessuna tipologia di biglietto trovata.",-1)]))):A("",!0),e[4]||(e[4]=l("hr",{class:"mt-3"},null,-1)),l("div",Hn,[l("div",Kn,[l("div",{class:J(["pl-0",t.discount&&t.discount.total_amount?"col-2":"col-7"])},e[3]||(e[3]=[l("b",null,"Totale",-1)]),2),l("div",Jn,"€ "+x(t.total.toFixed(2)),1)]),l("div",Gn,[a(k,{label:"Prosegui",onClick:e[1]||(e[1]=d=>t.nextTab()),disabled:t.checkDisabled()},null,8,["disabled"])])])],64)}const Qn=X(Mn,[["render",Wn]]);class Xn{static async fetchAll(){return(await Fe("/countries")).data.countries}}const Zn=we({id:"country",state:()=>({country:{},countries:[]}),getters:{allCountries:o=>o.countries},actions:{async fetchAllCountries(){await Xn.fetchAll().then(o=>this.countries=o)}}});class Yn{static async fetchAll(){return(await Fe("/provinces")).data.provinces}}const $n=we({id:"province",state:()=>({province:{},provinces:[]}),getters:{allProvinces:o=>o.provinces,getCurrentProvince:o=>o.province},actions:{async fetchAllProvinces(){await Yn.fetchAll().then(o=>this.provinces=o)}}}),el={computed:{Code(){return Code}},props:["location_permalink"],setup(o,e){Y(()=>{j(),T()});const n=xe(),t=Zn(),y=oe(),_=$n(),i=D({}),f=D(),k=D(),d=D(),u=P(()=>t.allCountries),m=P(()=>n.allOpenTickets),h=P(()=>y.paymentStatus),V=P(()=>y.paymentModeList),r=P(()=>_.allProvinces),s=P(()=>{const b=y.getPaymentMethods;return Object.entries(b).map(([B,se])=>({id:B,label:se}))}),F=P(()=>y.paymentMethodAccountList),j=async function(){await t.fetchAllCountries().then(()=>{i.value.country_id=88,i.value.status={id:"payed",name:"Pagato"}})},T=async function(){await _.fetchAllProvinces()},O=async function(b){const B={code:b.query.toUpperCase(),location_permalink:o.location_permalink};await n.fetchAllOpenTickets(B)},c=function(){i.value.status.id&&(i.value.status.id=="free"||i.value.status.id=="to_pay")&&(i.value.payment_method=null)},S=function(){if(i.value.status&&i.value.status.id=="payed"&&i.value.open_ticket_codes){for(const b of i.value.open_ticket_codes)if(b.expired){k.value="Uno o più codici biglietto risultano scaduti";return}}i.value.amount&&(i.value.payment_method_deposit||(f.value="Seleziona un metodo di pagamento"),i.value.paid_at||(d.value="Inserisci la data di versamento dell'acconto"),f.value||d.value)||e.emit("nextTab",i.value)};return le(()=>i.value.multi_payment,b=>{b&&(i.value.status={id:"to_pay",name:"Da pagare"})}),{form:i,countries:u,paymentList:h,paymentModeList:V,errorMessage:f,errorMessageVoucher:k,errorMessageDate:d,open_tickets:m,provinces:r,dynamicPaymentMethods:s,paymentMethodAccountList:F,fetchAllOpenTickets:O,onChangeStatus:c,onConfirm:S}}};const tl={key:0,class:"formgrid grid"},ol={class:"field col-6"},nl={class:"field col-6"},ll={class:"field col-6"},al={class:"field col-6"},il={class:"field col-6"},sl={class:"field col-6"},rl={class:"field col-6"},cl={class:"field col-6"},dl={key:0,class:"field col-6"},ul={class:"p-float-label mb-0"},ml={key:1,class:"field col-6 flex flex-column"},fl={key:0,class:"pi pi-exclamation-triangle",style:{color:"#ff6767"}},pl={class:"p-error",id:"dd-error"},_l={class:"field col-12"},vl={key:2,class:"col-12 pl-0 flex flex-wrap"},yl={class:"field col-6 mb-0"},gl={class:"field col-6 mb-0"},hl={class:"p-float-label mb-0"},bl={class:"p-error",id:"dd-error"},kl={class:"field col-6"},Cl={class:"p-error",id:"dd-error"},wl={class:"field col-12"},xl={class:"field flex flex-column"},Dl={class:"col-12 flex justify-content-end"};function Ol(o,e,n,t,y,_){const i=C("InputText"),f=C("Dropdown"),k=C("AutoComplete"),d=C("Checkbox"),u=C("InputNumber"),m=C("Calendar"),h=C("Textarea"),V=C("Button"),r=pe("tooltip");return t.form?(p(),g("div",tl,[l("div",ol,[e[21]||(e[21]=l("label",{for:"user_name"},"Nome",-1)),a(i,{type:"text",modelValue:t.form.user_name,"onUpdate:modelValue":e[0]||(e[0]=s=>t.form.user_name=s),class:"w-full"},null,8,["modelValue"])]),l("div",nl,[e[22]||(e[22]=l("label",{for:"user_surname"},"Cognome",-1)),a(i,{type:"text",modelValue:t.form.user_surname,"onUpdate:modelValue":e[1]||(e[1]=s=>t.form.user_surname=s),class:"w-full"},null,8,["modelValue"])]),l("div",ll,[e[23]||(e[23]=l("label",{for:"user_surname"},"Nome gruppo",-1)),a(i,{type:"text",modelValue:t.form.group_name,"onUpdate:modelValue":e[2]||(e[2]=s=>t.form.group_name=s),class:"w-full"},null,8,["modelValue"])]),l("div",al,[e[24]||(e[24]=l("label",{for:"user_email"},"Email",-1)),a(i,{type:"text",modelValue:t.form.user_email,"onUpdate:modelValue":e[3]||(e[3]=s=>t.form.user_email=s),class:"w-full"},null,8,["modelValue"])]),l("div",il,[e[25]||(e[25]=l("label",{for:"user_phone"},"Telefono",-1)),a(i,{type:"text",modelValue:t.form.user_phone,"onUpdate:modelValue":e[4]||(e[4]=s=>t.form.user_phone=s),class:"w-full"},null,8,["modelValue"])]),l("div",sl,[e[26]||(e[26]=l("label",{for:"country_id"},"Nazione",-1)),a(f,{modelValue:t.form.country_id,"onUpdate:modelValue":e[5]||(e[5]=s=>t.form.country_id=s),options:t.countries,optionLabel:"name",optionValue:"id",class:"w-full"},null,8,["modelValue","options"])]),l("div",rl,[e[27]||(e[27]=l("label",{for:"province"},"Provincia",-1)),a(f,{modelValue:t.form.user_zip,"onUpdate:modelValue":e[6]||(e[6]=s=>t.form.user_zip=s),options:t.provinces,optionLabel:"name",optionValue:"name",class:"w-full"},null,8,["modelValue","options"])]),l("div",cl,[e[28]||(e[28]=l("label",{for:"status"},"Stato pagamento",-1)),a(f,{modelValue:t.form.status,"onUpdate:modelValue":e[7]||(e[7]=s=>t.form.status=s),options:t.paymentList,optionLabel:"name",class:"w-full mb-0",onChange:e[8]||(e[8]=s=>t.onChangeStatus())},null,8,["modelValue","options"])]),t.form.status&&t.form.status.id=="payed"?(p(),g("div",dl,[e[29]||(e[29]=l("label",{for:"payment_method"},"Modalità pagamento",-1)),l("span",ul,[a(f,{modelValue:t.form.payment_method,"onUpdate:modelValue":e[9]||(e[9]=s=>t.form.payment_method=s),options:t.dynamicPaymentMethods,optionLabel:"label",class:"w-full",disabled:t.form.status&&t.form.status.id!="payed"},null,8,["modelValue","options","disabled"])])])):A("",!0),t.form.payment_method&&t.form.payment_method.id=="voucher"?(p(),g("div",ml,[e[30]||(e[30]=l("label",{for:"user_zip"},"Codice biglietto",-1)),a(k,{modelValue:t.form.open_ticket_codes,"onUpdate:modelValue":e[10]||(e[10]=s=>t.form.open_ticket_codes=s),suggestions:t.open_tickets,class:J(["uppercase w-full",{"p-invalid":t.errorMessageVoucher}]),onComplete:e[11]||(e[11]=s=>t.fetchAllOpenTickets(s)),emptySearchMessage:"Nessun risultato",emptySelectionMessage:"Nessun risultato",optionLabel:"code",optionValue:"code",multiple:"",onChange:e[12]||(e[12]=s=>t.errorMessageVoucher=null)},{option:w(({option:s})=>[l("span",{class:"flex flex-row justify-content-between",style:Pe({color:s.expired?"#ff6767":null})},[E(x(s.code)+" ",1),s.expired?de((p(),g("i",fl,null,512)),[[r,"Scaduto"]]):A("",!0)],4)]),_:1},8,["modelValue","suggestions","class"]),l("small",pl,x(t.errorMessageVoucher||" "),1)])):A("",!0),l("div",_l,[a(d,{modelValue:t.form.multi_payment,"onUpdate:modelValue":e[13]||(e[13]=s=>t.form.multi_payment=s),binary:!0,class:"deposit"},null,8,["modelValue"]),e[31]||(e[31]=l("label",{for:"payment_method",class:"text-sm ml-2"},"Acconto",-1))]),e[36]||(e[36]=l("div",{class:"field col-6"},null,-1)),t.form.multi_payment?(p(),g("div",vl,[l("div",yl,[e[32]||(e[32]=l("label",{for:"deposit"},"Importo acconto*",-1)),a(u,{modelValue:t.form.amount,"onUpdate:modelValue":e[14]||(e[14]=s=>t.form.amount=s),inputId:"currency-germany",mode:"currency",currency:"EUR",locale:"it-IT",class:"w-full"},null,8,["modelValue"])]),l("div",gl,[e[33]||(e[33]=l("label",{for:"payment_method_deposit"},"Modalità pagamento*",-1)),l("span",hl,[a(f,{modelValue:t.form.payment_method_deposit,"onUpdate:modelValue":e[15]||(e[15]=s=>t.form.payment_method_deposit=s),options:t.dynamicPaymentMethods,optionLabel:"label",class:J(["w-full",{"p-invalid":t.errorMessage}]),onChange:e[16]||(e[16]=s=>t.errorMessage=null)},null,8,["modelValue","options","class"])]),l("small",bl,x(t.errorMessage||" "),1)]),l("div",kl,[e[34]||(e[34]=l("label",{for:"deposit"},"Data versamento acconto*",-1)),a(m,{modelValue:t.form.paid_at,"onUpdate:modelValue":e[17]||(e[17]=s=>t.form.paid_at=s),class:J(["w-full",{"p-invalid":t.errorMessageDate}]),onChange:e[18]||(e[18]=s=>t.errorMessageDate=null)},null,8,["modelValue","class"]),l("small",Cl,x(t.errorMessageDate||" "),1)])])):A("",!0),l("div",wl,[l("div",xl,[e[35]||(e[35]=l("label",{for:"notes"},"Note",-1)),a(h,{modelValue:t.form.notes,"onUpdate:modelValue":e[19]||(e[19]=s=>t.form.notes=s),rows:"5",cols:"30"},null,8,["modelValue"])])]),l("div",Dl,[a(V,{label:"Conferma",onClick:e[20]||(e[20]=s=>t.onConfirm())})])])):A("",!0)}const Sl=X(el,[["render",Ol],["__scopeId","data-v-610f3cd4"]]);var Vl={root:function(e){var n=e.instance;return["p-contextmenu p-component",{"p-ripple-disabled":n.$primevue.config.ripple===!1}]},menu:"p-contextmenu-root-list",menuitem:function(e){var n=e.instance,t=e.processedItem;return["p-menuitem",{"p-menuitem-active p-highlight":n.isItemActive(t),"p-focus":n.isItemFocused(t),"p-disabled":n.isItemDisabled(t)}]},content:"p-menuitem-content",action:"p-menuitem-link",icon:"p-menuitem-icon",label:"p-menuitem-text",submenuIcon:"p-submenu-icon",submenu:"p-submenu-list",separator:"p-menuitem-separator"};je.extend({name:"contextmenu",classes:Vl});const Tl={props:["form"],setup(o,e){Y(()=>{s()});const n=D(0),t=D([]),y=D(!1),_=D(!0),i=D(),f=D([]),{showLoader:k,hideLoader:d}=me(),u=xe(),m=oe(),h=$(),V=P(()=>u.allTickets),r=P(()=>m.getCurrentOrder),s=async function(){const L={location_permalink:o.form.location_permalink,api_version:"v2",date:j(o.form.date),course_id:o.form.course.id};await u.fetchAllTickets(L).then(()=>{}).catch(z=>{R(h,z)})},F=function(L){n.value+=1,i.value=L.discount_code,t.value=Object.assign([],L.partial_total),_.value=!1},j=function(L){return ke(L).includes("Invalid")?be(L):ke(L)},T=function(L){O(L)},O=async function(L){var ne,re,U,I;const z=[{start_at:o.form.hour,tickets:[]}];t.value.forEach(q=>{q.quantity!=0&&z[0].tickets.push({id:q.ticket.id,quantity:q.quantity})});let H=[];L.open_ticket_codes&&L.open_ticket_codes.forEach(q=>{H.push(q.code)});const ae={location_permalink:o.form.location_permalink,country_id:L.country_id,status:L.status.id,group_name:L.group_name,user_email:L.user_email,user_name:L.user_name,user_phone:L.user_phone,user_surname:L.user_surname,user_zip:L.user_zip,api_version:"v2",date:o.form.date?j(o.form.date):"",notes:L.notes,time_slots:z,payment_method:((ne=L.payment_method)==null?void 0:ne.id)||null,course_id:(U=(re=o.form)==null?void 0:re.course)==null?void 0:U.id,open_ticket_codes:H,multi_payment:L.multi_payment,payments:[]};L.multi_payment&&(L.amount&&L.payment_method_deposit?ae.payments=[{amount:L.amount,typology:"deposit",payment_method:(I=L.payment_method_deposit)==null?void 0:I.id,paid_at:be(L.paid_at)}]:ae.payments=[]),i.value&&(ae.discount_code=i.value),await m.createOrder(ae).then(()=>{n.value+=1,_.value=!0,y.value=!0}).catch(q=>{R(h,q)})},c=function(){Ce(r==null?void 0:r.value,o.form.location_permalink),e.emit("closeDialog",!0)},S=function(L){_.value=L},b=function(){Ce(r==null?void 0:r.value,o.form.location_permalink),B()},B=async function(){let L=[];if(!r.value&&!o.form.location_permalink)return;for(let H of r.value.tickets)L.push(H.order_item_id);const z={check_in:!0,order_item_ids:L,location_permalink:o.form.location_permalink};await m.checkInOrder(z).then(()=>{Z(h,{message:"Check-in registrato correttamente",error:!1}),e.emit("closeDialog",!0)}).catch(H=>{R(h,H)})},se=function(){k();const L={location_permalink:o.form.location_permalink,order_id:r.value.id};m.sendEmail(L).then(()=>{Z(h,{message:"Email inviata correttamente al cliente",error:!1}),d(),e.emit("closeDialog",!0)}).catch(z=>{d(),R(h,z)})};return le(r,()=>{f.value=[],r.value.tickets.forEach(L=>{const z=f.value.find(H=>H.ticket_name===L.ticket_name);if(!z)L.quantity=1,f.value.push(L);else{let H=f.value.indexOf(z);f.value[H].quantity+=1}})}),{tickets:V,active:n,partialTotals:t,showOrderDetail:y,currentOrder:r,tmp_tickets:f,showSecondTab:_,formatExplicitDate:Ue,formatDate:Ve,onNextTab:F,onConfirmPayment:T,printPDF:Se,onPrintPDF:c,onDisableSecondoTab:S,printAndCheckIn:b,sendEmail:se}},components:{NewOrderTicketTab:Qn,NewOrderFormTab:Sl}};const Ll={key:0,class:"info-box"},Al={class:"font-medium"},Nl={class:"font-medium"},Ml={key:0,class:"capitalize"},Pl={key:0,class:"flex pb-4"},jl={class:"flex flex-column"},Fl={key:0,class:"pb-1 pr-1"},Ul={key:1,class:"pb-1"},El={class:"py-5"},Rl={class:"m-0 text-center line-height-3"},Bl={key:0,class:"col-offset-3 col-6 flex justify-content-center flex-column align-items-center mt-4 order-summary"},Il={class:"flex flex-column col-12"},zl={key:0,class:"pb-1",style:{"min-width":"8rem"}},ql={key:1,class:"pb-1"},Hl={key:2},Kl={class:"flex flex-column col-12"},Jl={key:0,class:"p-0 m-0 font-medium flex justify-content-between"},Gl={class:"pb-1"},Wl={class:"flex align-items-center justify-content-center mt-4"};function Ql(o,e,n,t,y,_){var m,h;const i=C("NewOrderTicketTab"),f=C("TabPanel"),k=C("NewOrderFormTab"),d=C("Button"),u=C("TabView");return p(),g(te,null,[n.form?(p(),g("div",Ll,[l("p",Al,[e[7]||(e[7]=l("i",{class:"pi pi-map-marker mr-3 font-medium"},null,-1)),E(x((m=n.form.course)==null?void 0:m.name),1)]),l("p",Nl,[e[8]||(e[8]=l("i",{class:"pi pi-calendar mr-3 font-medium"},null,-1)),n.form.date?(p(),g("span",Ml,x(t.formatDate((h=n.form)==null?void 0:h.date)),1)):A("",!0),E(" - "+x(n.form.hour),1)]),t.partialTotals&&t.partialTotals.length>0?(p(),g("div",Pl,[e[9]||(e[9]=l("i",{class:"pi pi-ticket mr-3 font-medium mt-1"},null,-1)),l("div",jl,[(p(!0),g(te,null,he(t.partialTotals,V=>{var r;return p(),g("p",{class:"p-0 m-0 font-medium flex justify-content-between",key:V},[V&&V.quantity!=0?(p(),g("span",Fl,x((r=V.ticket)==null?void 0:r.name),1)):A("",!0),V&&V.quantity!=0?(p(),g("span",Ul," x "+x(V.quantity)+" "+x(V.price),1)):A("",!0)])}),128))])])):A("",!0)])):A("",!0),a(u,{activeIndex:t.active,"onUpdate:activeIndex":e[6]||(e[6]=V=>t.active=V)},{default:w(()=>[a(f,{header:"Seleziona i biglietti",disabled:t.showOrderDetail},{default:w(()=>[a(i,{tickets:t.tickets,form:n.form,onNextTab:e[0]||(e[0]=V=>t.onNextTab(V)),onDisableSecondoTab:e[1]||(e[1]=V=>t.onDisableSecondoTab(V))},null,8,["tickets","form"])]),_:1},8,["disabled"]),a(f,{header:"Inserisci i dati",disabled:t.showSecondTab},{default:w(()=>[a(k,{onNextTab:e[2]||(e[2]=V=>t.onConfirmPayment(V)),location_permalink:n.form.location_permalink},null,8,["location_permalink"])]),_:1},8,["disabled"]),t.showOrderDetail?(p(),Q(f,{key:0,header:"Ordine completato"},{default:w(()=>{var V,r;return[l("div",El,[l("div",Rl,[e[10]||(e[10]=E(" Ordine ",-1)),l("b",null,x(t.currentOrder.reservation_number),1),e[11]||(e[11]=E(" registrato correttamente!",-1)),e[12]||(e[12]=l("br",null,null,-1))]),t.currentOrder?(p(),g("div",Bl,[e[14]||(e[14]=l("p",{class:"my-2"},[l("b",null,"Riepilogo ordine:")],-1)),l("div",Il,[(p(!0),g(te,null,he(t.tmp_tickets,s=>(p(),g("p",{class:"p-0 m-0 font-medium flex justify-content-between flex-1",key:s},[s&&s.quantity!=0?(p(),g("span",zl,x(s.ticket_name),1)):A("",!0),s&&s.quantity!=0?(p(),g("span",ql," x "+x(s.quantity),1)):A("",!0),s.ticket_price?(p(),g("span",Hl," € "+x((+s.ticket_price).toFixed(2)),1)):A("",!0)]))),128))]),l("div",Kl,[t.currentOrder.total?(p(),g("p",Jl,[e[13]||(e[13]=l("span",{class:"pb-1 pr-1"},"Totale ordine ",-1)),l("span",Gl,[l("b",null,"€ "+x((+((V=t.currentOrder)==null?void 0:V.total)).toFixed(2)),1)])])):A("",!0)])])):A("",!0),l("div",Wl,[a(d,{icon:"pi pi-envelope",class:"mr-3",rounted:"",outlined:"",label:"Invia biglietti",onClick:e[3]||(e[3]=s=>t.sendEmail()),disable:!((r=t.currentOrder)!=null&&r.user_email)},null,8,["disable"]),a(d,{icon:"pi pi-print",onClick:e[4]||(e[4]=s=>t.onPrintPDF()),class:"mr-3",rounted:"",outlined:"",label:"Stampa"}),a(d,{icon:"pi print-check-icon",onClick:e[5]||(e[5]=s=>t.printAndCheckIn()),class:"mr-3",rounted:"",outlined:"",label:"Stampa e Check-in"})])])]}),_:1})):A("",!0)]),_:1},8,["activeIndex"])],64)}const Xl=X(Tl,[["render",Ql]]),Zl={props:["filters","date"],setup(o,e){Y(()=>{_.value=Re(8,24),n.value=Object.assign({},o.filters)});const n=D({}),t=Ie(),y=$(),_=D(),i=D(!1),f=Te(),k=D(!1),d=P(()=>t.allCourses),u=P(()=>f.showNewOrderDialog),m=async function(){const s={location_permalink:o.filters.location_permalink,api_version:"v2"};await t.fetchAllCourses(s).catch(F=>{R(y,F)})},h=function(){f.setNewOrderDialogVisibility(!1),n.value.hour="",n.value.course=null,e.emit("onCloseDialog")},V=function(s){n.value.date=o.date,f.setNewOrderDialogVisibility(s)},r=function(){k.value=n.value.open_ticket};return le(o.filters,()=>{if(m(),n.value=Object.assign({},o.filters),o.filters.course&&!o.filters.course.id){let s=d.value.find(F=>F.name===o.filters.course.name);s&&(n.value.course=s)}}),{courses:d,form:n,hours:_,disableForm:k,visible:i,onCloseDialog:h,updateDialog:V,onChecked:r,dialogVisible:u,dialogStore:f}},components:{NewOrderDialog:Xl}},Yl={class:"formgrid grid px-0 align-items-center mt-4"},$l={key:0,class:"field flex flex-column w-full col-12"},ea={key:1,class:"field flex flex-column w-full col-12"},ta={class:"flex justify-content-end align-items-center mt-2"},oa={class:"flex align-items-center justify-content-between w-full"};function na(o,e,n,t,y,_){const i=C("Dropdown"),f=C("Button"),k=C("NewOrderDialog"),d=C("Dialog"),u=C("Card");return p(),Q(u,{class:"mt-4"},{content:w(()=>[e[10]||(e[10]=l("h2",{class:"mt-1"},"Nuova prenotazione",-1)),l("div",Yl,[n.filters.location_permalink?(p(),g("div",$l,[e[7]||(e[7]=l("label",{for:"typology"},"Scegli il percorso",-1)),a(i,{modelValue:t.form.course,"onUpdate:modelValue":e[0]||(e[0]=m=>t.form.course=m),options:t.courses,optionLabel:"name",disabled:t.disableForm,placeholder:""},null,8,["modelValue","options","disabled"])])):A("",!0),n.filters.location_permalink?(p(),g("div",ea,[e[8]||(e[8]=l("label",{for:"typology"},"Seleziona l'orario",-1)),a(i,{modelValue:t.form.hour,"onUpdate:modelValue":e[1]||(e[1]=m=>t.form.hour=m),options:t.hours,disabled:t.disableForm,placeholder:""},null,8,["modelValue","options","disabled"])])):A("",!0)]),l("div",ta,[a(f,{label:"Prenota",disabled:!t.form.course||!t.form.hour,onClick:e[2]||(e[2]=m=>t.updateDialog(!0))},null,8,["disabled"])]),a(d,{visible:t.dialogVisible,"onUpdate:visible":e[5]||(e[5]=m=>t.dialogVisible=m),modal:"",header:"Nuova prenotazione",style:{width:"60rem"},breakpoints:{"1199px":"75vw","575px":"90vw"},closable:!1,onHide:e[6]||(e[6]=m=>t.onCloseDialog())},{header:w(()=>[l("div",oa,[e[9]||(e[9]=l("h2",null,"Nuova prenotazione",-1)),a(f,{icon:"pi pi-times",text:"",rounded:"",onClick:e[3]||(e[3]=m=>t.updateDialog(!1))})])]),default:w(()=>[a(k,{form:t.form,onCloseDialog:e[4]||(e[4]=m=>t.onCloseDialog())},null,8,["form"])]),_:1},8,["visible"])]),_:1})}const la=X(Zl,[["render",na]]),aa={props:["location_permalink"],setup(o,e){Y(()=>{t.value.start_date=ue.local().startOf("day").toFormat("dd/MM/yyyy"),t.value.end_date=ue.local().endOf("day").toFormat("dd/MM/yyyy"),t.value.created_at="false",t.value.start_hour="00:00",t.value.end_hour="23:59"});const n=$(),t=D({}),y=_e(),{showLoader:_,hideLoader:i}=me(),f=function(){let u=Ne(t.value.start_date)+" "+t.value.start_hour,m=Ne(t.value.end_date)+" "+t.value.end_hour;const h={from:u,to:m,location_permalink:o.location_permalink,created_at:"false"};k(h)},k=async function(u){_(),await y.downloadReport(u).then(()=>{i(),e.emit("onSubmit")}).catch(m=>{i(),R(n,m)})};return{form:t,onSubmit:f,setDefaultIfBlank:function(){(!t.value.start_hour||t.value.start_hour=="")&&(t.value.start_hour="00:00"),(!t.value.end_hour||t.value.end_hour=="")&&(t.value.end_hour="23:59")}}},components:{Form:xt}},ia={class:"formgrid grid mt-3"},sa={class:"field col-6 flex flex-column"},ra={class:"field col-6 flex flex-column"},ca={class:"flex align-items-center justify-content-end mt-6"};function da(o,e,n,t,y,_){const i=C("Calendar"),f=C("InputMask"),k=C("Button"),d=C("Form");return p(),Q(d,{onSubmit:t.onSubmit},{default:w(()=>[l("div",ia,[l("div",sa,[e[7]||(e[7]=l("label",{from:"start_date"},"Dal",-1)),a(i,{inputId:"start_date",modelValue:t.form.start_date,"onUpdate:modelValue":e[0]||(e[0]=u=>t.form.start_date=u),dateFormat:"dd/mm/yy",manualInput:!0},null,8,["modelValue"]),e[8]||(e[8]=l("label",{from:"start_hour",class:"mt-3"},"Dalle",-1)),a(f,{id:"start_hour",modelValue:t.form.start_hour,"onUpdate:modelValue":e[1]||(e[1]=u=>t.form.start_hour=u),mask:"99:99",placeholder:"HH:mm",onBlur:e[2]||(e[2]=u=>t.setDefaultIfBlank())},null,8,["modelValue"])]),l("div",ra,[e[9]||(e[9]=l("label",{from:"end_date"},"Al",-1)),a(i,{inputId:"end_date",modelValue:t.form.end_date,"onUpdate:modelValue":e[3]||(e[3]=u=>t.form.end_date=u),dateFormat:"dd/mm/yy",manualInput:!0},null,8,["modelValue"]),e[10]||(e[10]=l("label",{from:"end_hour",class:"mt-3"},"Alle",-1)),a(f,{id:"end_hour",modelValue:t.form.end_hour,"onUpdate:modelValue":e[4]||(e[4]=u=>t.form.end_hour=u),mask:"99:99",placeholder:"HH:mm",onBlur:e[5]||(e[5]=u=>t.setDefaultIfBlank())},null,8,["modelValue"])])]),l("div",ca,[a(k,{label:"Annulla",text:"",onClick:e[6]||(e[6]=u=>o.$emit("onSubmit"))}),a(k,{label:"Scarica",type:"submit"})])]),_:1},8,["onSubmit"])}const ua=X(aa,[["render",da]]),ma={setup(){const o=D({}),e=D({}),n=D(),t=D(!1),y=oe(),_=ht(),i=_e(),f=$(),k=Te(),d=P(()=>_.currentUser),u=P(()=>i.allLocations),m=P(()=>i.getCurrentLocation),h=P(()=>y.getPaymentMethods);Y(()=>{m.value&&(o.value.location=m.value,e.value.location_permalink=m.value.permalink),r().then(()=>{V()})});const V=async function(){var b;let c={};const S=((b=m==null?void 0:m.value)==null?void 0:b.permalink)??null;S?c.location_permalink=S:c.location_permalink=u.value[0].permalink,await y.fetchPaymentMethods(c).then(()=>{}).catch(B=>{R(f,B)})},r=async function(){await i.fetchAllLocations().then(()=>{m.value||(o.value.location=u.value[0],e.value.location_permalink=u.value[0].permalink,i.updateCurrenLocation(u.value[0]))}).catch(c=>{R(f,c)})};return{filters:o,orderTable:n,order_filters:e,visibleDialog:t,user:d,locations:u,newPaymentMethods:h,fetchAllLocations:r,formatDate:Ve,onUpdateFilters:function(c){c.course?o.value.course={id:c.course}:o.value.course="",c.name?o.value.name=c.name:o.value.name="",c.hour&&(c.hour.start_at?o.value.hour=c.hour.start_at:o.value.hour=c.hour)},onUpdateNewOrderFilters:function(c){c.start_at&&(e.value.hour=c.start_at),c.course_name&&(e.value.course={name:c.course_name}),c.date&&(e.value.date=c.date),c.hour&&(e.value.hour=c.hour),c.max_seats?e.value.max_seats=c.max_seats:e.value.max_seats=null,k.setNewOrderDialogVisibility(!0)},onCloseDialog:function(){n.value.loadLazyData()},onChangeLocation:function(){e.value.location_permalink=o.value.location.permalink,i.updateCurrenLocation(o.value.location)},onCloseReportDialog:function(){t.value=!1}}},components:{CalendarFilter:gn,OrderTable:fn,OrderFilter:Sn,NewOrderCard:la,SalesReportsDialog:ua}};const fa={class:"flex justify-content-between align-items-center"},pa={class:"field flex flex-column mt-3"},_a={class:"text-xl font-medium pl-3 py-0"},va={key:0,style:{color:"#495057"},class:"flex flex-column align-items-end"},ya={class:"capitalize text-xl"},ga={class:"flex gap-4"},ha={key:0,class:"col-3 mt-3"},ba={class:"col-9 mt-3"};function ka(o,e,n,t,y,_){var V,r;const i=C("Button"),f=C("SalesReportsDialog"),k=C("Dialog"),d=C("CalendarFilter"),u=C("NewOrderCard"),m=C("OrderFilter"),h=C("OrderTable");return p(),g("div",null,[l("div",fa,[l("div",pa,[l("p",_a,x((r=(V=t.filters)==null?void 0:V.location)==null?void 0:r.name),1)]),t.filters&&t.filters.date?(p(),g("div",va,[l("div",null,[e[6]||(e[6]=l("i",{class:"pi pi-calendar mr-2 text-xl"},null,-1)),l("span",ya,x(t.formatDate(t.filters.date)),1)]),a(i,{label:"Report visite",link:"",class:"m-0 p-0",onClick:e[0]||(e[0]=s=>t.visibleDialog=!0),icon:"pi pi-download"}),a(k,{visible:t.visibleDialog,"onUpdate:visible":e[2]||(e[2]=s=>t.visibleDialog=s),modal:"",header:"Report visite",style:{width:"35rem"}},{default:w(()=>[a(f,{onOnSubmit:e[1]||(e[1]=s=>t.onCloseReportDialog()),location_permalink:t.filters.location.permalink},null,8,["location_permalink"])]),_:1},8,["visible"])])):A("",!0)]),l("div",ga,[t.filters.location?(p(),g("div",ha,[a(d,{filters:t.filters},null,8,["filters"]),a(u,{date:t.filters.date,filters:t.order_filters,onOnCloseDialog:e[3]||(e[3]=s=>t.onCloseDialog())},null,8,["date","filters"])])):A("",!0),l("div",ba,[a(m,{filters:t.filters,onOnSubmit:e[4]||(e[4]=s=>t.onUpdateFilters(s))},null,8,["filters"]),t.filters.date?(p(),Q(h,{key:0,filters:t.filters,ref:"orderTable",class:"mt-4",onUpdateFilters:e[5]||(e[5]=s=>t.onUpdateNewOrderFilters(s))},null,8,["filters"])):A("",!0)])])])}const Oa=X(ma,[["render",ka]]);export{Oa as default};
