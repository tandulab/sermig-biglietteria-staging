import{l as Oe,m as we,o as Y,p as x,a as $,c as N,_ as X,r as k,q as pe,b as p,e as g,g as l,f as i,n as J,t as w,w as D,s as A,F as te,h as E,v as de,x as Ne,B as je,C as fe,Z as De,D as se,y as dt,O as ut,z as mt,A as ft,E as pt,G as _t,H as Q,I as ge,J as ce,K as Le,L as Ae,T as vt,M as yt,i as ae,N as he,P as gt,Q as Fe,u as ht}from"../index62470.js";import{u as oe,a as _e,f as Ue,b as Ve,c as bt,d as kt,e as be,g as Te,h as ke,i as Ct,D as ue,j as Me}from"./location62470.js";import{u as me,s as Z,e as B,p as Ee,a as wt,b as Se,c as Ce,d as Re}from"./helpers62470.js";import{F as xt}from"./vee-validate.esm62470.js";class Pe{static async fetchAll(e){const n=e.location_permalink;return delete e.location_permalink,(await Oe(`/ticket_office/${n}/search/tickets`,e)).data}static async fetchAllOpenTickets(e){const n=e.location_permalink;return delete e.location_permalink,(await Oe(`/ticket_office/${n}/orders/search_codes`,e)).data}}const xe=we({id:"ticket",state:()=>({ticket:{},tickets:[],response_tickets:{},open_tickets_codes:{}}),getters:{allTickets:o=>o.response_tickets.available_ticket_types,allOpenTickets:o=>o.open_tickets_codes.open_tickets,responseTickets:o=>o.response_tickets,getTotalTickets:o=>o.response_tickets?o.response_tickets.total:0,getCurrentTicket:o=>o.ticket},actions:{async fetchAllTickets(o){await Pe.fetchAll(o).then(e=>this.response_tickets=e)},async fetchAllOpenTickets(o){await Pe.fetchAllOpenTickets(o).then(e=>this.open_tickets_codes=e)}}}),Dt={computed:{Code(){return Code}},props:["location_permalink","time_slot"],setup(o,e){Y(()=>{n.value=Object.assign({},o.time_slot)});const n=x({}),t=xe(),y=oe(),{showLoader:_,hideLoader:a}=me(),f=$(),b=x(),u=x(),d=N(()=>t.allOpenTickets),m=N(()=>y.paymentStatus),h=N(()=>y.paymentModeList),V=N(()=>{const O=y.getPaymentMethods;return Object.entries(O).map(([c,S])=>({id:c,label:S}))}),r=N(()=>y.getCurrentOrder),s=async function(O){const c={code:O.query.toUpperCase(),location_permalink:o.location_permalink};await t.fetchAllOpenTickets(c)},F=async function(){var c,S;const O={id:o.location_permalink,order_id:n.value.id,status:(c=n.value)==null?void 0:c.status,payment_method:n.value.payment_method,open_ticket_codes:[],api_version:"v2",notes:(S=n.value)==null?void 0:S.notes};if(n.value.status&&n.value.status=="payed"&&!n.value.payment_method){b.value="Seleziona un metodo di pagamento";return}for(const C of n.value.open_tickets_used)if(C.expired){u.value="Uno o più codici biglietto risultano scaduti";return}if(n.value.open_tickets_used&&n.value.open_tickets_used.length>0){let C=[];n.value.open_tickets_used.forEach(R=>{C.push(R.code)}),O.open_ticket_codes=C}j(O)},j=async function(O){_(),await y.updateOrder(O).then(()=>{a(),Z(f,{message:"Stato aggiornato correttamente",error:!1}),e.emit("closeDialog",r.value)}).catch(c=>{a(),B(f,c)})};return{form:n,open_tickets:d,paymentList:m,paymentModeList:h,changeStatus:F,errorMessage:b,errorMessageVoucher:u,dynamicPaymentMethods:V,fetchAllOpenTickets:s,onChangeStatus:function(){(n.value.status=="free"||n.value.status=="to_pay")&&(n.value.payment_method=null)}}}},Ot={key:0,class:"formgrid grid flex-column mt-3"},St={class:"field col-12"},Vt={class:"field col-12"},Tt={class:"p-error",id:"dd-error"},Lt={key:0,class:"field col-12 flex flex-column"},At={key:0,class:"pi pi-exclamation-triangle",style:{color:"#ff6767"}},Mt={class:"p-error",id:"dd-error"},Pt={class:"flex align-items-center justify-content-end mt-3"};function Nt(o,e,n,t,y,_){const a=k("Dropdown"),f=k("AutoComplete"),b=k("Button"),u=pe("tooltip");return p(),g(te,null,[t.form?(p(),g("div",Ot,[l("div",St,[e[9]||(e[9]=l("label",{for:"status"},"Stato pagamento",-1)),i(a,{modelValue:t.form.status,"onUpdate:modelValue":e[0]||(e[0]=d=>t.form.status=d),options:t.paymentList,optionLabel:"name",optionValue:"id",class:"w-full",onChange:e[1]||(e[1]=d=>t.onChangeStatus())},null,8,["modelValue","options"])]),l("div",Vt,[e[10]||(e[10]=l("label",{for:"payment_method"},"Modalità pagamento",-1)),i(a,{modelValue:t.form.payment_method,"onUpdate:modelValue":e[2]||(e[2]=d=>t.form.payment_method=d),options:t.dynamicPaymentMethods,optionLabel:"label",optionValue:"id",class:J(["w-full",{"p-invalid":t.errorMessage}]),disabled:t.form.status!="payed",onChange:e[3]||(e[3]=d=>t.errorMessage=null)},null,8,["modelValue","options","disabled","class"]),l("small",Tt,w(t.errorMessage||" "),1)]),t.form.payment_method=="voucher"&&t.form.status=="payed"?(p(),g("div",Lt,[e[11]||(e[11]=l("label",{for:"user_zip"},"Codice biglietto",-1)),i(f,{modelValue:t.form.open_tickets_used,"onUpdate:modelValue":e[4]||(e[4]=d=>t.form.open_tickets_used=d),suggestions:t.open_tickets,class:J(["uppercase w-full",{"p-invalid":t.errorMessageVoucher}]),onComplete:e[5]||(e[5]=d=>t.fetchAllOpenTickets(d)),emptySearchMessage:"Nessun risultato",emptySelectionMessage:"Nessun risultato",optionLabel:"code",optionValue:"code",multiple:"",onChange:e[6]||(e[6]=d=>t.errorMessageVoucher=null)},{option:D(({option:d})=>[l("span",{class:"flex flex-row justify-content-between",style:Ne({color:d.expired?"#ff6767":null})},[E(w(d.code)+" ",1),d.expired?de((p(),g("i",At,null,512)),[[u,"Scaduto"]]):A("",!0)],4)]),_:1},8,["modelValue","suggestions","class"]),l("small",Mt,w(t.errorMessageVoucher||" "),1)])):A("",!0)])):A("",!0),l("div",Pt,[i(b,{label:"Annulla",text:"",onClick:e[7]||(e[7]=d=>o.$emit("closeDialog",null))}),i(b,{label:"Conferma",onClick:e[8]||(e[8]=d=>t.changeStatus())})])],64)}const jt=X(Dt,[["render",Nt]]);var Ft={root:function(e){var n=e.instance;return["p-confirm-popup p-component",{"p-ripple-disabled":n.$primevue.config.ripple===!1}]},content:"p-confirm-popup-content",icon:"p-confirm-popup-icon",message:"p-confirm-popup-message",footer:"p-confirm-popup-footer",rejectButton:function(e){var n=e.instance;return["p-confirm-popup-reject",n.confirmation&&!n.confirmation.rejectClass?"p-button-sm p-button-text":null]},acceptButton:function(e){var n=e.instance;return["p-confirm-popup-accept",n.confirmation&&!n.confirmation.acceptClass?"p-button-sm":null]}},Ut=je.extend({name:"confirmpopup",classes:Ft}),Et={name:"BaseConfirmPopup",extends:_t,props:{group:String},style:Ut,provide:function(){return{$parentInstance:this}}},Be={name:"ConfirmPopup",extends:Et,inheritAttrs:!1,data:function(){return{visible:!1,confirmation:null,autoFocusAccept:null,autoFocusReject:null,target:null}},target:null,outsideClickListener:null,scrollHandler:null,resizeListener:null,container:null,confirmListener:null,closeListener:null,mounted:function(){var e=this;this.confirmListener=function(n){n&&n.group===e.group&&(e.confirmation=n,e.target=n.target,e.confirmation.onShow&&e.confirmation.onShow(),e.visible=!0)},this.closeListener=function(){e.visible=!1,e.confirmation=null},fe.on("confirm",this.confirmListener),fe.on("close",this.closeListener)},beforeUnmount:function(){fe.off("confirm",this.confirmListener),fe.off("close",this.closeListener),this.unbindOutsideClickListener(),this.scrollHandler&&(this.scrollHandler.destroy(),this.scrollHandler=null),this.unbindResizeListener(),this.container&&(De.clear(this.container),this.container=null),this.target=null,this.confirmation=null},methods:{accept:function(){this.confirmation.accept&&this.confirmation.accept(),this.visible=!1},reject:function(){this.confirmation.reject&&this.confirmation.reject(),this.visible=!1},onHide:function(){this.confirmation.onHide&&this.confirmation.onHide(),this.visible=!1},onAcceptKeydown:function(e){(e.code==="Space"||e.code==="Enter"||e.code==="NumpadEnter")&&(this.accept(),se.focus(this.target),e.preventDefault())},onRejectKeydown:function(e){(e.code==="Space"||e.code==="Enter"||e.code==="NumpadEnter")&&(this.reject(),se.focus(this.target),e.preventDefault())},onEnter:function(e){this.autoFocusAccept=this.confirmation.defaultFocus===void 0||this.confirmation.defaultFocus==="accept",this.autoFocusReject=this.confirmation.defaultFocus==="reject",this.target=document.activeElement,this.bindOutsideClickListener(),this.bindScrollListener(),this.bindResizeListener(),De.set("overlay",e,this.$primevue.config.zIndex.overlay)},onAfterEnter:function(){this.focus()},onLeave:function(){this.autoFocusAccept=null,this.autoFocusReject=null,se.focus(this.target),this.target=null,this.unbindOutsideClickListener(),this.unbindScrollListener(),this.unbindResizeListener()},onAfterLeave:function(e){De.clear(e)},alignOverlay:function(){se.absolutePosition(this.container,this.target,!1);var e=se.getOffset(this.container),n=se.getOffset(this.target),t=0;e.left<n.left&&(t=n.left-e.left),this.container.style.setProperty("--overlayArrowLeft","".concat(t,"px")),e.top<n.top&&(this.container.setAttribute("data-p-confirm-popup-flipped","true"),!this.isUnstyled&&se.addClass(this.container,"p-confirm-popup-flipped"))},bindOutsideClickListener:function(){var e=this;this.outsideClickListener||(this.outsideClickListener=function(n){e.visible&&e.container&&!e.container.contains(n.target)&&!e.isTargetClicked(n)?(e.confirmation.onHide&&e.confirmation.onHide(),e.visible=!1):e.alignOverlay()},document.addEventListener("click",this.outsideClickListener))},unbindOutsideClickListener:function(){this.outsideClickListener&&(document.removeEventListener("click",this.outsideClickListener),this.outsideClickListener=null)},bindScrollListener:function(){var e=this;this.scrollHandler||(this.scrollHandler=new dt(this.target,function(){e.visible&&(e.visible=!1)})),this.scrollHandler.bindScrollListener()},unbindScrollListener:function(){this.scrollHandler&&this.scrollHandler.unbindScrollListener()},bindResizeListener:function(){var e=this;this.resizeListener||(this.resizeListener=function(){e.visible&&!se.isTouchDevice()&&(e.visible=!1)},window.addEventListener("resize",this.resizeListener))},unbindResizeListener:function(){this.resizeListener&&(window.removeEventListener("resize",this.resizeListener),this.resizeListener=null)},focus:function(){var e=this.container.querySelector("[autofocus]");e&&e.focus({preventScroll:!0})},isTargetClicked:function(e){return this.target&&(this.target===e.target||this.target.contains(e.target))},containerRef:function(e){this.container=e},onOverlayClick:function(e){ut.emit("overlay-click",{originalEvent:e,target:this.target})},onOverlayKeydown:function(e){e.code==="Escape"&&(fe.emit("close",this.closeListener),se.focus(this.target))},getCXOptions:function(e,n){return{contenxt:{icon:e,iconClass:n.class}}}},computed:{message:function(){return this.confirmation?this.confirmation.message:null},acceptLabel:function(){return this.confirmation?this.confirmation.acceptLabel||this.$primevue.config.locale.accept:null},rejectLabel:function(){return this.confirmation?this.confirmation.rejectLabel||this.$primevue.config.locale.reject:null},acceptIcon:function(){return this.confirmation?this.confirmation.acceptIcon:null},rejectIcon:function(){return this.confirmation?this.confirmation.rejectIcon:null}},components:{CPButton:mt,Portal:ft},directives:{focustrap:pt}},Rt=["aria-modal"];function Bt(o,e,n,t,y,_){var a=k("CPButton"),f=k("Portal"),b=pe("focustrap");return p(),Q(f,null,{default:D(function(){return[i(vt,ce({name:"p-confirm-popup",onEnter:_.onEnter,onAfterEnter:_.onAfterEnter,onLeave:_.onLeave,onAfterLeave:_.onAfterLeave},o.ptm("transition")),{default:D(function(){return[y.visible?de((p(),g("div",ce({key:0,ref:_.containerRef,role:"alertdialog",class:o.cx("root"),"aria-modal":y.visible,onClick:e[2]||(e[2]=function(){return _.onOverlayClick&&_.onOverlayClick.apply(_,arguments)}),onKeydown:e[3]||(e[3]=function(){return _.onOverlayKeydown&&_.onOverlayKeydown.apply(_,arguments)})},o.ptmi("root")),[o.$slots.container?ge(o.$slots,"container",{key:0,message:y.confirmation,onAccept:_.accept,onReject:_.reject,acceptCallback:_.accept,rejectCallback:_.reject}):(p(),g(te,{key:1},[o.$slots.message?(p(),Q(Le(o.$slots.message),{key:1,message:y.confirmation},null,8,["message"])):(p(),g("div",ce({key:0,class:o.cx("content")},o.ptm("content")),[ge(o.$slots,"icon",{},function(){return[o.$slots.icon?(p(),Q(Le(o.$slots.icon),{key:0,class:J(o.cx("icon"))},null,8,["class"])):y.confirmation.icon?(p(),g("span",ce({key:1,class:[y.confirmation.icon,o.cx("icon")]},o.ptm("icon")),null,16)):A("",!0)]}),l("span",ce({class:o.cx("message")},o.ptm("message")),w(y.confirmation.message),17)],16)),l("div",ce({class:o.cx("footer")},o.ptm("footer")),[i(a,{label:_.rejectLabel,onClick:e[0]||(e[0]=function(u){return _.reject()}),onKeydown:_.onRejectKeydown,autofocus:y.autoFocusReject,class:J([o.cx("rejectButton"),y.confirmation.rejectClass]),unstyled:o.unstyled,pt:o.ptm("rejectButton")},Ae({_:2},[_.rejectIcon||o.$slots.rejecticon?{name:"icon",fn:D(function(u){return[ge(o.$slots,"rejecticon",{},function(){return[l("span",ce({class:[_.rejectIcon,u.class]},o.ptm("rejectButton").icon,{"data-pc-section":"rejectbuttonicon"}),null,16)]})]}),key:"0"}:void 0]),1032,["label","onKeydown","autofocus","class","unstyled","pt"]),i(a,{label:_.acceptLabel,onClick:e[1]||(e[1]=function(u){return _.accept()}),onKeydown:_.onAcceptKeydown,autofocus:y.autoFocusAccept,class:J([o.cx("acceptButton"),y.confirmation.acceptClass]),unstyled:o.unstyled,pt:o.ptm("acceptButton")},Ae({_:2},[_.acceptIcon||o.$slots.accepticon?{name:"icon",fn:D(function(u){return[ge(o.$slots,"accepticon",{},function(){return[l("span",ce({class:[_.acceptIcon,u.class]},o.ptm("acceptButton").icon,{"data-pc-section":"acceptbuttonicon"}),null,16)]})]}),key:"0"}:void 0]),1032,["label","onKeydown","autofocus","class","unstyled","pt"])],16)],64))],16,Rt)),[[b]]):A("",!0)]}),_:3},16,["onEnter","onAfterEnter","onLeave","onAfterLeave"])]}),_:3})}Be.render=Bt;const It={props:["order"],setup(o,{emit:e}){Y(()=>{c.value&&O.value&&c.value.forEach(U=>{U.permalink===O.value&&(a.value=U.name)})});const n=x(0),t=x([]),y=x(!1),_=x(!0),a=x(),f=yt(),b=x([]),u=x({}),d=x(null),m=x(!1),h=x({...o.order});ae(()=>o.order,U=>{Object.assign(h,U)});const V=xe(),r=oe(),s=$(),F=_e(),j=N(()=>V.allTickets),T=N(()=>r.getCurrentOrder),O=N(()=>F.getCurrentLocation),c=N(()=>F.allLocations),S=N(()=>{const U=o.order.payment_method,I=r.getPaymentMethods;return U?I[U]:"-"}),C=N(()=>{const U=r.getPaymentMethods;return Object.entries(U).map(([I,q])=>({id:I,label:q}))}),R=N(()=>r.paymentMethodAccountList),ne=[{label:"Acconto",value:"deposit"},{label:"Saldo",value:"balance"}],L=U=>U==="deposit"?"Acconto":U==="balance"?"Saldo":"-",z=(U,I)=>{d.value=U,f.require({target:I.currentTarget,message:"Sei sicuro di voler eliminare questo acconto?",icon:"pi pi-info-circle",rejectClass:"p-button-secondary p-button-outlined p-button-sm",acceptClass:"p-button-danger p-button-sm",rejectLabel:"Annulla",acceptLabel:"Elimina",accept:async()=>{var q;await r.deletePayment({location:((q=O.value)==null?void 0:q.permalink)??"",id:o.order.id,payment_id:d.value.id}),await re(),Z(s,{message:"Acconto eliminato con successo",error:!1})}})},H=function(){let U={amount:"",payment_method:"",typology:"",id:"-1"};h.value.payments.push(U),b.value.push(U)},ie=async function(U){var I,q;m.value=!0;try{let{newData:G}=U;const ve={amount:G.amount,payment_method:G.payment_method,typology:G.typology,paid_at:be(G.paid_at)};G.id!=-1?await r.updatePayment({location:((I=O.value)==null?void 0:I.permalink)??"",id:o.order.id,payment_id:G.id,payment:ve}):await r.createPayment({location:((q=O.value)==null?void 0:q.permalink)??"",id:o.order.id,payment:ve}),await re()}catch(G){B(s,G)}finally{m.value=!1}},le=function(U,I){u.value.payments.splice(I,1)},re=async function(){var U;try{const I=await r.getPayment({location:((U=O.value)==null?void 0:U.permalink)??"",id:o.order.id});h.value.payments.splice(0,h.value.payments.length,...I.payments),h.value.paid_amount=I.paid_amount,h.value.remaining_amount=I.remaining_amount}catch{h.value.remaining_amount="0.0",h.value.paid_amount="0.0",h.value.payments=[]}};return{tickets:j,active:n,partialTotals:t,showOrderDetail:y,currentOrder:T,showSecondTab:_,currentLocation:O,selectedLocation:a,editingRows:b,localOrder:h,loadingPayments:m,formatExplicitDate:Ue,formatDate:Ve,confirm1:z,addAmount:H,onRowEditSave:ie,deleteSlot:le,dynamicPaymentMethods:C,typologyOptions:ne,getPayments:re,paymentMethodAccountList:R,prettyPaymentStatus:Ee,formatPrettyDate:bt,formatDataAndHourFromUnixTimestamps:kt,prettyPaymentMethod:wt,methodLabel:S,prettyTypology:L}},components:{ConfirmPopup:Be}};const zt={class:"mt-3 line-height-3"},qt={class:"flex gap-3"},Ht={class:"m-0 mb-1"},Kt={class:"m-0 mb-1"},Jt={class:"m-0 mb-1"},Gt={class:"m-0 mb-1"},Wt={key:0},Qt={class:"flex gap-3 mt-4"},Xt={class:"m-0 mb-1"},Zt={class:"m-0 mb-1"},Yt={key:0,class:"m-0 mb-1"},$t={class:"flex gap-3 mt-4"},eo={class:"m-0 mb-1"},to={class:"m-0 mb-1"},oo={class:"m-0 mb-1"},no={key:0,class:"m-0 mb-1"},lo={key:1,class:"m-0 mb-1"},ao={key:2,class:"m-0 mb-1"},io={class:"m-0 mb-1"},so={class:"m-0 mb-1"},ro={key:0},co={key:1},uo={class:"m-0 mb-1"},mo={key:0},fo={key:1},po={class:"m-0 mb-1"},_o={key:0},vo={key:1},yo={class:"ml-5"},go={class:"field flex justify-content-between align-items-end mt-4 mb-3"},ho={key:1,class:"flex gap-3 mt-4"};function bo(o,e,n,t,y,_){const a=k("Badge"),f=k("Button"),b=k("InputNumber"),u=k("Column"),d=k("Calendar"),m=k("Dropdown"),h=k("DataTable"),V=k("ConfirmPopup");return p(),g("div",zt,[l("div",qt,[e[3]||(e[3]=l("i",{class:"pi pi-user mt-1"},null,-1)),l("div",null,[l("p",Ht,w(n.order.user_name)+" "+w(n.order.user_surname||"-"),1),l("p",Kt,w(n.order.user_email),1),l("p",Jt,w(n.order.user_phone),1),l("p",Gt,[E(w(n.order.country)+" ",1),n.order.user_zip?(p(),g("span",Wt," - "+w(n.order.user_zip),1)):A("",!0)])])]),l("div",Qt,[e[4]||(e[4]=l("i",{class:"pi pi-map-marker mt-1"},null,-1)),l("div",null,[l("p",Xt,w(t.selectedLocation),1),l("p",Zt,w(n.order.course_name),1),n.order.date?(p(),g("p",Yt,w(t.formatPrettyDate(n.order.date))+" "+w(n.order.start_at),1)):A("",!0)])]),l("div",$t,[e[8]||(e[8]=l("i",{class:"pi pi-shopping-cart mt-1"},null,-1)),l("div",null,[l("p",eo,w(n.order.reservation_number),1),l("p",to,w(t.formatDataAndHourFromUnixTimestamps(n.order.created_at)),1),l("p",oo,w(n.order.created_by),1),n.order.status?(p(),g("p",no,[i(a,{value:t.prettyPaymentStatus(n.order.status),class:J([n.order.status,"px-3 border-round-lg"])},null,8,["value","class"])])):A("",!0),n.order.status=="payed"?(p(),g("p",lo,w(t.methodLabel),1)):A("",!0),n.order.open_tickets_used&&n.order.status=="payed"?(p(),g("p",ao,[(p(!0),g(te,null,he(n.order.open_tickets_used,r=>(p(),g("span",{key:r},[i(a,{value:r.code,class:"mr-2 voucher"},null,8,["value"])]))),128))])):A("",!0),l("p",io," Codice sconto utilizzato: "+w(t.localOrder.discount_code||"-"),1),l("p",so,[e[5]||(e[5]=E(" Totale ordine: ",-1)),t.localOrder.total?(p(),g("span",ro,"€ "+w((+t.localOrder.total).toFixed(2)),1)):(p(),g("span",co,"-"))]),t.localOrder.multi_payment&&t.localOrder.paid_amount!="0.0"?(p(),g(te,{key:3},[l("p",uo,[e[6]||(e[6]=E(" Acconto versato: ",-1)),t.localOrder.paid_amount?(p(),g("span",mo,"€ "+w((+t.localOrder.paid_amount).toFixed(2)),1)):(p(),g("span",fo,"-"))]),l("p",po,[e[7]||(e[7]=E(" Saldo rimanente: ",-1)),t.localOrder.remaining_amount?(p(),g("span",_o,"€ "+w((+t.localOrder.remaining_amount).toFixed(2)),1)):(p(),g("span",vo,"-"))])],64)):t.localOrder.multi_payment&&(!t.localOrder.payments||t.localOrder.payments.length===0)?(p(),Q(f,{key:4,label:"Acconto / Saldo",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[0]||(e[0]=r=>t.addAmount()),class:"mt-2"})):A("",!0)])]),t.localOrder.payments&&t.localOrder.payments.length?(p(),g(te,{key:0},[l("div",yo,[l("div",go,[e[9]||(e[9]=l("label",null,"Pagamenti",-1)),t.localOrder.remaining_amount!=="0.0"?(p(),Q(f,{key:0,label:"Acconto / Saldo",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[1]||(e[1]=r=>t.addAmount())})):A("",!0)]),i(h,{value:t.localOrder.payments,dataKey:"id",size:"small",editingRows:t.editingRows,"onUpdate:editingRows":e[2]||(e[2]=r=>t.editingRows=r),editMode:"row",onRowEditSave:t.onRowEditSave,loading:t.loadingPayments},{default:D(()=>[i(u,{field:"amount",header:"Importo"},{editor:D(({data:r,field:s})=>[i(b,{modelValue:r[s],"onUpdate:modelValue":F=>r[s]=F,inputId:"currency-germany",mode:"currency",currency:"EUR",locale:"it-IT",class:"w-full"},null,8,["modelValue","onUpdate:modelValue"])]),body:D(r=>[E(w(r.data.amount?Number(r.data.amount).toFixed(2):"0.00")+" € ",1)]),_:1}),i(u,{field:"paid_at",header:"Data pagamento"},{body:D(r=>[E(w(r.data.paid_at),1)]),editor:D(({data:r,field:s})=>[i(d,{modelValue:r[s],"onUpdate:modelValue":F=>r[s]=F},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),i(u,{field:"payment_method",header:"Metodo"},{editor:D(({data:r,field:s})=>[i(m,{modelValue:r[s],"onUpdate:modelValue":F=>r[s]=F,options:t.dynamicPaymentMethods,optionLabel:"label",optionValue:"id",class:"w-full",placeholder:"Seleziona metodo..."},null,8,["modelValue","onUpdate:modelValue","options"])]),body:D(r=>[E(w(t.prettyPaymentMethod(r.data.payment_method)),1)]),_:1}),i(u,{field:"typology",header:"Tipologia"},{editor:D(({data:r,field:s})=>[i(m,{modelValue:r[s],"onUpdate:modelValue":F=>r[s]=F,options:t.typologyOptions,optionLabel:"label",optionValue:"value",class:"w-full",placeholder:"Seleziona tipologia"},null,8,["modelValue","onUpdate:modelValue","options"])]),body:D(r=>[E(w(t.prettyTypology(r.data.typology)),1)]),_:1}),i(u,{rowEditor:!0,style:{width:"8rem"},bodyStyle:"text-align:right"}),i(u,{header:""},{body:D(r=>[r.data.id!=="-1"?(p(),Q(f,{key:0,icon:"pi pi-trash",class:"p-button-text p-button-sm p-button-danger",onClick:s=>t.confirm1(r.data,s)},null,8,["onClick"])):A("",!0)]),_:1})]),_:1},8,["value","editingRows","onRowEditSave","loading"])]),i(V)],64)):A("",!0),n.order.notes?(p(),g("div",ho,[e[10]||(e[10]=l("i",{class:"pi pi-comment mt-1"},null,-1)),l("div",null,w(n.order.notes),1)])):A("",!0)])}const ko=X(It,[["render",bo]]),Co={props:["order","location_permalink"],setup(o,e){Y(()=>{o.order&&o.order.notes&&(n.value=o.order.notes)});const n=x(),{showLoader:t,hideLoader:y}=me(),_=$(),a=oe(),f=N(()=>a.getCurrentOrder);return{notes:n,updateOrder:async function(){const u={id:o.location_permalink,order_id:o.order.id,notes:n.value,api_version:"v2"};t(),await a.updateOrder(u).then(()=>{y(),Z(_,{message:"Nota aggiornata correttamente",error:!1}),e.emit("closeDialog",f.value)}).catch(d=>{y(),B(_,d)})}}}},wo={class:"pt-5 px-2"},xo={class:"flex align-items-center justify-content-end mt-3"};function Do(o,e,n,t,y,_){const a=k("Textarea"),f=k("Button");return p(),g("div",wo,[i(a,{modelValue:t.notes,"onUpdate:modelValue":e[0]||(e[0]=b=>t.notes=b),rows:"8",cols:"30",class:"w-full"},null,8,["modelValue"]),l("div",xo,[i(f,{label:"Annulla",text:"",onClick:e[1]||(e[1]=b=>o.$emit("closeDialog",null))}),i(f,{label:"Conferma",onClick:e[2]||(e[2]=b=>t.updateOrder())})])])}const Oo=X(Co,[["render",Do]]),So={props:["order","location_permalink","date"],setup(o,e){Y(()=>{var m;o.order&&o.order.note&&(n.value=(m=o.order.note)==null?void 0:m.note)});const n=x(),{showLoader:t,hideLoader:y}=me(),_=$(),a=oe(),f=async function(){var h;const m={location:o.location_permalink,time_slot_note:{course_id:o.order.course_id,start_at:o.order.start_at,date:o.date,note:n.value}};(h=o.order.note)!=null&&h.id?b(m):u(m)},b=async function(m){t(),m.id=o.order.note.id,await a.updateNote(m).then(()=>{y(),Z(_,{message:"Nota aggiornata correttamente",error:!1}),e.emit("closeDialog",null)}).catch(h=>{y(),B(_,h)})},u=async function(m){t(),await a.createNote(m).then(()=>{y(),Z(_,{message:"Nota creata correttamente",error:!1}),e.emit("closeDialog",null)}).catch(h=>{y(),B(_,h)})};return{notes:n,addNote:f,deleteNote:async function(){const m={location:o.location_permalink,id:o.order.note.id};t(),await a.deleteNote(m).then(()=>{y(),Z(_,{message:"Nota eliminata correttamente",error:!1}),e.emit("closeDialog",null)}).catch(h=>{y(),B(_,h)})}}}},Vo={class:"pt-5 px-2"},To={class:"flex align-items-center justify-content-end mt-3"};function Lo(o,e,n,t,y,_){var b,u;const a=k("Textarea"),f=k("Button");return p(),g("div",Vo,[i(a,{modelValue:t.notes,"onUpdate:modelValue":e[0]||(e[0]=d=>t.notes=d),rows:"8",cols:"30",class:"w-full"},null,8,["modelValue"]),l("div",To,[(u=(b=n.order)==null?void 0:b.note)!=null&&u.id?(p(),Q(f,{key:0,label:"Elimina",text:"",onClick:e[1]||(e[1]=d=>t.deleteNote()),severity:"danger",class:"mr-2"})):A("",!0),i(f,{label:"Conferma",onClick:e[2]||(e[2]=d=>t.addNote())})])])}const Ao=X(So,[["render",Lo]]),Mo={props:["filters"],setup(o,e){Y(()=>{T.value=!0,O.value={first:0,rows:V.value.rows,sortField:null,sortOrder:null},O.value.page=0,o.filters.location&&le()});const n=oe(),t=Te(),y=N(()=>n.responseOrders),_=N(()=>n.status),a=gt(),f=N(()=>a.submitDialog),b=N(()=>n.paymentStatus),u=N(()=>n.getDeleteResponse),{showLoader:d,hideLoader:m}=me(),h=$(),V=x(),r=x(),s=x(),F=x(),j=x(),T=x(!0),O=x(),c=x(0),S=x([]),C=x([]),R=x(!1),ne=x(!1),L=x(),z=x(!1),H=x(!1),ie=x();function le(){T.value=!0;let v=new Map;for(const M in o.filters){if(M=="date"){let P="";ke(o.filters.date)=="Invalid DateTime"?P=be(o.filters.date):P=ke(o.filters.date),v.set("date",P),ie.value=P}else o.filters.location&&v.set("location_permalink",o.filters.location.permalink);M=="course"&&o.filters.course.id!="-1"&&v.set("course",o.filters.course.id),M=="hour"&&o.filters.hour!="Tutti gli orari"&&v.set("hour",o.filters.hour),M=="name"&&v.set("name",o.filters.name)}setTimeout(()=>{re(v)},Math.random()*1e3+250)}const re=async function(v){await n.fetchAllOrders(v).then(()=>{T.value=!1}).catch(M=>{T.value=!1,B(h,M)})},U=v=>{s.value.toggle(v),L.value.toggle(v)},I=(v,M)=>v>v+M?"red":"green",q=function(v,M){M&&(s.value.note=M,s.value.toggle(v))},G=function(v){v.order&&y.value.time_slots&&y.value.time_slots.forEach((M,P)=>{M.orders.forEach((K,W)=>{K.id==v.order.id&&(y.value.time_slots[P].orders[W]=v.order,v.check_in_done!=null&&(y.value.time_slots[P].check_in_done+=v.check_in_done))})})},ve=async function(v,M){let P=[],K=!1;C.value.forEach(ee=>{if(ee.id==v.id){K=!0;return}});for(let ee of v.tickets)P.push(ee.order_item_id);const W={check_in:M,order_item_ids:P,location_permalink:o.filters.location};await n.checkInOrder(W).then(()=>{G(u.value),Z(h,{message:"Check-in registrato correttamente",error:!1}),K&&ye(C.value,u.value.order)}).catch(ee=>{B(h,ee)})},ze=async function(v,M){let P=[],K=!1;C.value.forEach(ee=>{if(ee.id==v.id){K=!0;return}});for(let ee of v.tickets)P.push(ee.order_item_id);const W={order_item_ids:P,no_show:M,location_permalink:o.filters.location.permalink};await n.noShowOrder(W).then(()=>{G(u.value),Z(h,{message:"No-show registrato correttamente",error:!1}),K&&ye(C.value,u.value.order)}).catch(ee=>{B(h,ee)})},qe=async function(v,M,P){const K={id:v,check_in:M,location_permalink:o.filters.location.permalink};await n.checkInTicket(K).then(()=>{Z(h,{message:"Check-in registrato correttamente",error:!1}),G(u.value),ye(C.value,u.value.order)}).catch(W=>{B(h,W)})},He=async function(v,M,P){const K={id:v,no_show:M,location_permalink:o.filters.location.permalink};await n.noShowTicket(K).then(()=>{Z(h,{message:"No-show registrato correttamente",error:!1}),G(u.value),ye(C.value,u.value.order)}).catch(W=>{B(h,W)})},ye=function(v,M){let P=Ke(C.value,u.value.order.id);P!=-1&&C.value.splice(P,1),C.value.push(u.value.order)},Ke=function(v,M){for(let P=0;P<v.length;P++)if(v[P].id===M)return P;return-1},Je=function(v){const M={course_name:v.course_name,start_at:v.start_at,date:o.filters.date,hour:v.start_at,max_seats:v.is_free_slot?null:v.remaing_seats+""};e.emit("updateFilters",M)},Ge=function(v){R.value=!0,F.value=v},We=function(v){G({order:v}),R.value=!1,z.value=!1},Qe=function(){H.value=!1,le()},Xe=function(v){return v!=null&&v.created_by&&(v==null?void 0:v.created_by)=="WEB"?"WEB":"KALATA"},Ze=function(v,M){let P=0;if(v&&v.tickets){v.tickets.forEach(W=>{M?W.no_show&&(P+=1):W.check_in&&(P+=1)});let K=v.tickets.length;if(P!=K&&P!=0)return P+"/"+K}},Ye=function(v,M){L.value.data=M,L.value.toggle(v)},$e=function(v,M){j.value=M.id;let P="Sei sicuro di voler eliminare questa prenotazione?";P+='<br><br> <i>N.B. Eventuali voucher presenti nella prenotazione vanno liberati manualmente dalla sezione "Data aperta"</i>',a.setDialog("Elimina prenotazione","Elimina","Annulla",P),a.setBtnSubmit(!1),a.setDynamicDialogVisibility(!0)},et=function(){if(d(),j.value){const v={id:j.value,location_permalink:o.filters.location.permalink};n.deleteOrder(v).then(()=>{m(),Z(h,{message:"La prenotazione è stata eliminata correttamente",error:!1}),y.value.time_slots&&y.value.time_slots.forEach((M,P)=>{M.orders.forEach((K,W)=>{K.id==j.value&&(y.value.time_slots[P].orders.splice(W,1),u.value,y.value.time_slots[P].check_in_done+=u.value.check_in_done,y.value.time_slots[P].confirmed_seats+=u.value.confirmed_seats,y.value.time_slots[P].remaing_seats-=u.value.confirmed_seats)})})}).catch(M=>{m(),B(h,M)})}},tt=function(v){S.value=v.data?[v.data]:[]},ot=function(v){C.value=v.data?[v.data]:[]},nt=function(v){ne.value=!0,r.value=v},lt=function(v){z.value=!0,r.value=v},at=function(v){H.value=!0,r.value=v},it=function(v){const M=new Map;M.set("id",v.id),M.set("location_permalink",o.filters.location.permalink),d(),n.downloadTicket(M).then(()=>{m()}).catch(P=>{m(),B(h,P)})},st=function(v,M){d(),Ce(v,M.location.permalink).then(()=>{m()}).catch(()=>{m()})},rt=function(v,M){d(),Se(v,M.location.permalink).then(()=>{m()}).catch(()=>{m()})},ct=async()=>{await le(),r.value&&r.value.id&&(await n.fetchOrderDetail(r.value.id),r.value={...n.getCurrentOrder})};return ae(f,v=>{v&&et()}),ae(o.filters,()=>{o.filters.location&&le()}),{dt:V,responseOrders:y,loading:T,totalRecords:c,lazyParams:O,currentOrder:r,status:_,expandedRows:S,expandedRows1:C,op:s,dialogStore:t,paymentList:b,visibleDialog:R,currentTimeSlot:F,visibleMenu:L,visibleDetailDialog:ne,visibleNotesDialog:z,toast:h,visibleAddNotesDialog:H,formattedDate:ie,loadLazyData:le,toggle:U,getProgressClass:I,showNotes:q,checkAll:ve,noShowAll:ze,openDialog:Je,checkInSingleTicket:qe,noShowSingleTicket:He,prettyPaymentStatus:Ee,openPaymentStatusDialog:Ge,onClosePaymentStatusDialog:We,getRowClass:Xe,printPDF:Se,showLabelCheckbox:Ze,confirmDeleteOrder:$e,showMenu:Ye,openOrderDetailDialog:nt,openNotesDialog:lt,downloadPDF:it,handleRowToggle:tt,handleRowToggle1:ot,openPDFTab:st,openPDFTicketTab:rt,onRefreshOrder:ct,openAddNotesDialog:at,onCloseNoteDialog:Qe,formatDataFromUnixTimestamps:Ct,printOrderPDF:Ce}},components:{PaymentStatusDialog:jt,OrderDetailDialog:ko,NotesDialog:Oo,AddNotesDialog:Ao}};const Po={class:"order-table"},No={class:""},jo={style:{width:"15rem"}},Fo={class:"m-0 text-right",style:{"font-size":"12px"}},Uo={key:0,class:"pi pi-exclamation-triangle cursor-pointer",style:{color:"var(--orange-400)"}},Eo={style:{width:"15rem"}},Ro={class:"m-0 text-right",style:{"font-size":"12px"}},Bo={key:0},Io=["onClick"],zo={key:0},qo={class:"flex justify-content-center"},Ho={class:"flex flex-column",style:{"margin-top":"8px"}},Ko={class:"text-sm",style:{"min-height":"15px"}},Jo={class:"flex justify-content-center"},Go={class:"flex flex-column",style:{"margin-top":"8px"}},Wo={class:"text-sm",style:{"min-height":"15px"}},Qo=["onClick"],Xo={class:"p-3"},Zo={class:"overlay-menu"},Yo=["onClick"],$o=["onClick"],en=["onClick"],tn=["onClick"],on=["onClick"],nn=["disabled","onClick"],ln=["disabled","onClick"],an={key:0},sn={key:1},rn={class:"flex justify-content-center"},cn={class:"flex justify-content-center"},dn={class:"flex justify-content-center"},un={key:0,class:"flex mx-4"};function mn(o,e,n,t,y,_){const a=k("Column"),f=k("ProgressBar"),b=k("Button"),u=k("Badge"),d=k("Checkbox"),m=k("OverlayPanel"),h=k("DataTable"),V=k("PaymentStatusDialog"),r=k("Dialog"),s=k("OrderDetailDialog"),F=k("NotesDialog"),j=k("AddNotesDialog"),T=pe("tooltip"),O=pe("badge");return p(),g("div",Po,[i(h,{value:t.responseOrders.time_slots,totalRecords:t.responseOrders.total,lazy:!0,paginator:!1,ref:"dt",loading:t.loading,stripedRows:"",expandedRows:t.expandedRows,"onUpdate:expandedRows":e[1]||(e[1]=c=>t.expandedRows=c),onRowExpand:t.handleRowToggle},{empty:D(()=>e[9]||(e[9]=[E(" Nessuna prenotazione trovata. ",-1)])),expansion:D(c=>[i(h,{value:c.data.orders,class:"m-4 mx-4 table-order-detail",expandedRows:t.expandedRows1,"onUpdate:expandedRows":e[0]||(e[0]=S=>t.expandedRows1=S),rowClass:t.getRowClass,onRowExpand:t.handleRowToggle1},{empty:D(()=>e[10]||(e[10]=[E(" Nessuna prenotazione trovata. ",-1)])),expansion:D(S=>[i(h,{value:S.data.tickets,class:"m-4 mx-5"},{default:D(()=>[i(a,{header:"Codice biglietto",field:"code"}),i(a,{header:"Tipo biglietto",field:"type"},{body:D(({data:C})=>[i(u,{value:C.ticket_name,class:J([C.ticket_name,"px-3 border-round-lg"])},null,8,["value","class"])]),_:1}),i(a,{header:"Prezzo"},{body:D(({data:C})=>[C.ticket_price?(p(),g("span",an," € "+w((+C.ticket_price).toFixed(2)),1)):(p(),g("span",sn,"-"))]),_:1}),i(a,null,{header:D(()=>e[20]||(e[20]=[l("div",{class:"flex justify-content-center w-full"},"Check-in",-1)])),body:D(({data:C})=>[l("div",rn,[i(d,{modelValue:C.check_in,"onUpdate:modelValue":R=>C.check_in=R,binary:!0,onChange:R=>t.checkInSingleTicket(C.id,C.check_in,S.data),class:"check_in"},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:2},1024),i(a,null,{header:D(()=>e[21]||(e[21]=[l("div",{class:"flex justify-content-center w-full"},"No-show",-1)])),body:D(({data:C})=>[l("div",cn,[i(d,{modelValue:C.no_show,"onUpdate:modelValue":R=>C.no_show=R,binary:!0,onChange:R=>t.noShowSingleTicket(C.id,C.no_show,S.data),class:"no_show"},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:2},1024),i(a,{field:"tickets_url"},{header:D(()=>e[22]||(e[22]=[l("div",{class:"flex justify-content-center w-full"},null,-1)])),body:D(({data:C})=>[l("div",dn,[de(i(b,{link:"",icon:"pi pi-print",href:C.tickets_url,target:"_blank",style:{color:"var(--surface-400)"},text:"",rounded:"",onClick:R=>t.openPDFTicketTab(C.id,n.filters)},null,8,["href","onClick"]),[[T,"Stampa",void 0,{top:!0}]])])]),_:1})]),_:2},1032,["value"])]),default:D(()=>[i(a,{header:"Codice",field:"reservation_number"}),i(a,{header:"Acquirente"},{body:D(({data:S})=>[E(w(S.user_name)+" "+w(S.user_surname)+" ",1),!S.user_name&&!S.user_surname?(p(),g("span",Bo,"-")):A("",!0)]),_:1}),i(a,{header:"Gruppo"},{body:D(({data:S})=>[l("div",{class:"group cursor-pointer",onClick:C=>t.showNotes(C,S.group_name)},w(S.group_name||"-"),9,Io)]),_:1}),i(a,{header:"Pagamento"},{body:D(({data:S})=>[S.status?(p(),g("span",zo,[i(u,{value:t.prettyPaymentStatus(S.status),class:J([S.status,"px-3 border-round-lg"])},null,8,["value","class"])])):A("",!0)]),_:1}),i(a,{header:"Q.ta",field:"tickets_number"}),i(a,null,{header:D(()=>e[11]||(e[11]=[l("div",{class:"flex justify-content-center w-full"},"Check-in",-1)])),body:D(({data:S})=>[l("div",qo,[l("div",Ho,[i(d,{modelValue:S.check_in,"onUpdate:modelValue":C=>S.check_in=C,binary:!0,onChange:C=>t.checkAll(S,S.check_in),class:"check_in"},null,8,["modelValue","onUpdate:modelValue","onChange"]),l("span",Ko,w(t.showLabelCheckbox(S,!1)),1)])])]),_:1}),i(a,null,{header:D(()=>e[12]||(e[12]=[l("div",{class:"flex justify-content-center w-full"},"No-show",-1)])),body:D(({data:S})=>[l("div",Jo,[l("div",Go,[i(d,{modelValue:S.no_show,"onUpdate:modelValue":C=>S.no_show=C,binary:!0,onChange:C=>t.noShowAll(S,S.no_show),class:"no_show"},null,8,["modelValue","onUpdate:modelValue","onChange"]),l("span",Wo,w(t.showLabelCheckbox(S,!0)),1)])])]),_:1}),i(a,{header:"Note"},{body:D(({data:S})=>[l("div",{class:"notes cursor-pointer",onClick:C=>t.showNotes(C,S.notes)},w(S.notes||"-"),9,Qo),i(m,{ref:"op"},{default:D(()=>[l("div",Xo,w(t.op.note),1)]),_:1},512)]),_:1}),i(a,{header:"",style:{"padding-right":"0",width:"4rem"}},{body:D(({data:S})=>[i(b,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",icon:"pi pi-ellipsis-v",text:"",rounded:"",onClick:C=>t.showMenu(C,S)},null,8,["onClick"]),i(m,{ref:"visibleMenu"},{default:D(()=>[l("ul",Zo,[l("li",{onClick:C=>t.openOrderDetailDialog(t.visibleMenu.data)},e[13]||(e[13]=[l("i",{class:"pi pi-eye mr-3"},null,-1),E("Dettaglio ordine ",-1)]),8,Yo),l("li",{onClick:C=>t.openOrderDetailDialog(t.visibleMenu.data)},e[14]||(e[14]=[l("i",{class:"pi pi-shopping-cart mr-3"},null,-1),E("Dettaglio pagamento ",-1)]),8,$o),l("li",{onClick:C=>t.openPDFTab(t.visibleMenu.data,n.filters)},e[15]||(e[15]=[l("i",{class:"pi pi-print mr-3"},null,-1),E("Stampa ",-1)]),8,en),l("li",{onClick:C=>t.downloadPDF(t.visibleMenu.data)},e[16]||(e[16]=[l("i",{class:"pi pi-download mr-3"},null,-1),E("Scarica PDF ",-1)]),8,tn),l("li",{onClick:C=>t.openNotesDialog(t.visibleMenu.data)},e[17]||(e[17]=[l("i",{class:"pi pi-comment mr-3"},null,-1),E("Modifica nota ",-1)]),8,on),l("li",{disabled:!t.visibleMenu.data.can_change_status,onClick:C=>t.openPaymentStatusDialog(t.visibleMenu.data)},e[18]||(e[18]=[l("i",{class:"pi pi-pencil mr-3"},null,-1),E("Cambia stato ",-1)]),8,nn),l("li",{disabled:!t.visibleMenu.data.can_cancel,onClick:C=>t.confirmDeleteOrder(C,t.visibleMenu.data)},e[19]||(e[19]=[l("i",{class:"pi pi-trash mr-3"},null,-1),E("Elimina ",-1)]),8,ln)])]),_:2},1536)]),_:1}),i(a,{expander:"",class:"pl-0 ml-0"})]),_:2},1032,["value","expandedRows","rowClass","onRowExpand"]),c.data.orders&&c.data.orders.length>0?(p(),g("div",un,e[23]||(e[23]=[l("div",null,[l("div",{class:"p-0 m-0 flex align-items-center"},[l("p",{style:{width:"2rem",height:"5px"},class:"mr-2 web my-0"}),l("span",{class:"text-sm"},"WEB")]),l("div",{class:"p-0 m-0 flex align-items-center justify-content-between"},[l("p",{style:{width:"2rem",height:"5px"},class:"mr-2 kalata"}),l("span",{class:"text-sm"},"SUPERGA")])],-1)]))):A("",!0)]),default:D(()=>[i(a,{header:"Percorso",field:"course_name",filterMatchMode:"contains",ref:"course_name"},null,512),i(a,{header:"Orario",field:"start_at",filterMatchMode:"contains",ref:"start_at"},{body:D(({data:c})=>[l("div",No,[l("span",{class:J(c.is_free_slot?"free":"")},w(c.start_at),3)])]),_:1},512),i(a,{header:"Posti prenotati",ref:"availabe_tickets",field:"availabe_tickets"},{body:D(({data:c})=>[l("div",jo,[l("p",Fo,[E(w(c.confirmed_seats)+"/"+w(c.remaing_seats+c.confirmed_seats)+" ",1),c.confirmed_seats>c.remaing_seats+c.confirmed_seats?de((p(),g("i",Uo,null,512)),[[T,c.confirmed_seats-(c.remaing_seats+c.confirmed_seats)+" posti in overbooking",void 0,{top:!0}]]):A("",!0)]),i(f,{value:c.confirmed_seats*100/(c.remaing_seats+c.confirmed_seats),showValue:!1,style:{height:"10px"},class:J(["available-progress",t.getProgressClass(c.confirmed_seats,c.remaing_seats)])},null,8,["value","class"])])]),_:1},512),i(a,{header:"Check-in",ref:"confirmed_tickets",field:"confirmed_tickets"},{body:D(({data:c})=>[l("div",Eo,[l("p",Ro,w(c.check_in_done)+"/"+w(c.confirmed_seats),1),i(f,{value:c.check_in_done*100/(c.remaing_seats+c.confirmed_seats),showValue:!1,style:{height:"10px"},class:"check-in-progress"},null,8,["value"])])]),_:1},512),i(a,null,{body:D(({data:c})=>[de(i(b,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",class:J(["mr-2 text-primary",{"is-present":c.note&&c.note!==0}]),icon:"pi pi-comment",text:"",rounded:"",onClick:S=>t.openAddNotesDialog(c)},null,8,["class","onClick"]),[[T,"Nota",void 0,{top:!0}],[O,void 0,void 0,{danger:!0}]]),de(i(b,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-0 text-primary",icon:"pi pi-calendar",text:"",rounded:"",onClick:S=>t.openDialog(c)},null,8,["onClick"]),[[T,"Prenota",void 0,{top:!0}]])]),_:1}),i(a,{expander:"",style:{width:"5rem"}})]),_:1},8,["value","totalRecords","loading","expandedRows","onRowExpand"]),i(r,{visible:t.visibleDialog,"onUpdate:visible":e[3]||(e[3]=c=>t.visibleDialog=c),modal:"",header:"Stato pagamento",style:{width:"35rem"}},{default:D(()=>[i(V,{location_permalink:n.filters.location.permalink,time_slot:t.currentTimeSlot,onCloseDialog:e[2]||(e[2]=c=>t.onClosePaymentStatusDialog(c))},null,8,["location_permalink","time_slot"])]),_:1},8,["visible"]),i(r,{visible:t.visibleDetailDialog,"onUpdate:visible":e[4]||(e[4]=c=>t.visibleDetailDialog=c),modal:"",header:"Dettaglio ordine",style:{width:"70rem"},onAfterHide:t.loadLazyData},{default:D(()=>[i(s,{order:t.currentOrder},null,8,["order"])]),_:1},8,["visible","onAfterHide"]),i(r,{visible:t.visibleNotesDialog,"onUpdate:visible":e[6]||(e[6]=c=>t.visibleNotesDialog=c),modal:"",header:"Modifica nota",style:{width:"35rem"}},{default:D(()=>[i(F,{order:t.currentOrder,location_permalink:n.filters.location.permalink,onCloseDialog:e[5]||(e[5]=c=>t.onClosePaymentStatusDialog(c))},null,8,["order","location_permalink"])]),_:1},8,["visible"]),i(r,{visible:t.visibleAddNotesDialog,"onUpdate:visible":e[8]||(e[8]=c=>t.visibleAddNotesDialog=c),modal:"",header:"Nota",style:{width:"35rem"}},{default:D(()=>[i(j,{date:t.formattedDate,order:t.currentOrder,location_permalink:n.filters.location.permalink,onCloseDialog:e[7]||(e[7]=c=>t.onCloseNoteDialog(c))},null,8,["date","order","location_permalink"])]),_:1},8,["visible"])])}const fn=X(Mo,[["render",mn]]),pn={props:["filters"],setup(o,e){Y(()=>{h(),n.value=o.filters,n.value.date=new Date,s()});const n=x({}),t=_e(),y=oe(),_=$(),a=x([]),f=x(),b=ue.now().plus({years:1}),u=N(()=>t.allLocations),d=N(()=>y.getCalendar),m=async function(T){await y.fetchCalendar(T).then(()=>{}).catch(O=>{B(_,O)})},h=async function(){await t.fetchAllLocations().then(()=>{}).catch(T=>{B(_,T)})},V=function(){if(o.filters.location){const T=u.value.find(O=>O.permalink===o.filters.location);a.value=T.courses}},r=function(T){let O={};O.month=ue.fromJSDate(new Date(T)).month,O.year=ue.fromJSDate(new Date(T)).year,O.location_permalink=o.filters.location.permalink?o.filters.location.permalink:o.filters.location,f.value={month:O.month,year:O.year},m(O)},s=function(){let T=ue.now(),O={location_permalink:"",month:"",year:""};O.location_permalink=o.filters.location.permalink?o.filters.location.permalink:o.filters.location,O.month=T.month+"",O.year=T.year+"",m(O)},F=function(T){if(d.value.web_dates&&d.value.web_dates.length!=0){let O=T.month+1;O=O<10?"0"+O:O;let c=T.day<10?"0"+T.day:T.day,S=T.year+"-"+O+"-"+c;return d.value.web_dates.find(C=>C==S)}},j=function(T){let O={location_permalink:o.filters.location.permalink?o.filters.location.permalink:o.filters.location,month:T.month,year:T.year};m(O)};return ae(o.filters,()=>{if(f.value){let T={location_permalink:o.filters.location.permalink?o.filters.location.permalink:o.filters.location,month:f.value.month,year:f.value.year};m(T)}else s()}),{form:n,courses:a,maxAllowedDate:b,locations:u,calendar:d,getCourses:V,onDateChange:r,getDayFromDate:F,onMonthChange:j}}};const _n={class:"flex calendar-filter"},vn={key:0,class:"special-day"};function yn(o,e,n,t,y,_){const a=k("Calendar");return p(),g("div",_n,[i(a,{modelValue:t.form.date,"onUpdate:modelValue":e[0]||(e[0]=f=>t.form.date=f),inline:"",onDateSelect:e[1]||(e[1]=f=>t.onDateChange(f)),onMonthChange:e[2]||(e[2]=f=>t.onMonthChange(f)),maxDate:t.maxAllowedDate.toJSDate()},{date:D(f=>[t.getDayFromDate(f.date)?(p(),g("div",vn,[l("span",null,w(f.date.day),1)])):(p(),g(te,{key:1},[E(w(f.date.day),1)],64))]),_:1},8,["modelValue","maxDate"])])}const gn=X(pn,[["render",yn]]);class hn{static async fetchAll(e){const n=e.location_permalink;return delete e.location_permalink,(await Oe(`/ticket_office/${n}/search/courses`,e)).data}}const Ie=we({id:"course",state:()=>({course:{},courses:[],response_courses:{}}),getters:{allCourses:o=>o.response_courses.tickets,responseCourses:o=>o.response_courses,getTotalCourses:o=>o.response_courses?o.response_courses.total:0,getCurrentCourse:o=>o.course},actions:{async fetchAllCourses(o){await hn.fetchAll(o).then(e=>this.response_courses=e)}}}),bn={props:["filters"],setup(o,e){Y(()=>{n.value=Object.assign({},o.filters),n.value.date=ue.now().toFormat("dd/MM/yyyy"),a.value=Re(8,20),a.value.unshift("Tutti gli orari"),n.value.hour="Tutti gli orari"});const n=x({}),t=x([]),y=_e(),_=$(),a=x([]),f=oe(),b=Ie(),u=N(()=>y.allLocations),d=N(()=>f.responseOrders),m=N(()=>b.allCourses),h=function(){n.value.name=null,n.value.course=t.value[0].name,n.value.hour=a.value[0],e.emit("onSubmit",n.value)},V=async function(){const r={location_permalink:n.value.location.permalink,api_version:"v2"};await b.fetchAllCourses(r).then(()=>{}).catch(s=>{B(_,s)})};return ae(u,()=>{o.filters.location&&u.value&&(n.value=Object.assign({},o.filters),n.value.hour||(n.value.hour="Tutti gli orari"),V())}),ae(o.filters,()=>{o.filters.location&&u.value&&n.value.location&&n.value.location!=o.filters.location&&(n.value=Object.assign({},o.filters),n.value.hour||(n.value.hour="Tutti gli orari"))}),ae(m,()=>{var r;t.value=Object.assign([],m.value),t.value&&((r=t.value[0])==null?void 0:r.id)!="-1"&&t.value.unshift({id:"-1",name:"Tutti i percorsi"}),n.value.course=t.value[0].name}),{form:n,courses:t,hours:a,locations:u,responseOrders:d,resetField:h}}},kn={class:"formgrid grid px-0 align-items-center"},Cn={key:0,class:"field col-4 flex flex-column"},wn={key:1,class:"field col-3 flex flex-column"},xn={class:"field col-4 flex flex-column"},Dn={class:"flex col-12 justify-content-end pt-1"};function On(o,e,n,t,y,_){const a=k("Dropdown"),f=k("InputText"),b=k("Button"),u=k("AccordionTab"),d=k("Accordion");return p(),Q(d,{activeIndex:0},{default:D(()=>[i(u,{header:"FILTRI"},{default:D(()=>[l("div",kn,[t.form.location&&t.courses?(p(),g("div",Cn,[e[5]||(e[5]=l("label",{for:"typology"},"Filtra per percorso",-1)),i(a,{modelValue:t.form.course,"onUpdate:modelValue":e[0]||(e[0]=m=>t.form.course=m),options:t.courses,optionLabel:"name",optionValue:"name",placeholder:""},null,8,["modelValue","options"])])):A("",!0),t.responseOrders?(p(),g("div",wn,[e[6]||(e[6]=l("label",{for:"typology"},"Filtra per orario (dalle)",-1)),i(a,{modelValue:t.form.hour,"onUpdate:modelValue":e[1]||(e[1]=m=>t.form.hour=m),options:t.hours,placeholder:""},null,8,["modelValue","options"])])):A("",!0),e[8]||(e[8]=l("div",{class:"col-12"},null,-1)),l("div",xn,[e[7]||(e[7]=l("label",{for:"typology"},"Filtra per acquirente",-1)),i(f,{modelValue:t.form.name,"onUpdate:modelValue":e[2]||(e[2]=m=>t.form.name=m),placeholder:""},null,8,["modelValue"])])]),l("div",Dn,[i(b,{label:"Ricerca",class:"mr-2",onClick:e[3]||(e[3]=m=>o.$emit("onSubmit",t.form))}),i(b,{label:"Annulla",class:"p-button-outlined",onClick:e[4]||(e[4]=m=>t.resetField())})])]),_:1})]),_:1})}const Sn=X(bn,[["render",On]]),Vn={props:["form","price","index","ticket"],setup(o,e){const n=x(0),t=function(){n.value++,_()},y=function(){n.value>0&&n.value--,_()},_=function(){n.value==null&&(n.value=0);const a={counter:n.value,price:o.price,index:o.index,ticket:o.ticket};e.emit("changeCounter",a)};return{counter:n,decrement:y,increment:t,emitEvent:_}}};const Tn={class:"btn-plus-min flex align-items-center"},Ln={class:"counter"};function An(o,e,n,t,y,_){const a=k("Button"),f=k("InputNumber");return p(),g("div",Tn,[i(a,{icon:"pi pi-minus",rounded:"",outlined:"",severity:"secondary",onClick:t.decrement,disabled:t.counter===0},null,8,["onClick","disabled"]),l("div",Ln,[i(f,{modelValue:t.counter,"onUpdate:modelValue":[e[0]||(e[0]=b=>t.counter=b),e[1]||(e[1]=b=>t.emitEvent())],min:0},null,8,["modelValue"])]),i(a,{icon:"pi pi-plus",rounded:"",outlined:"",severity:"secondary",onClick:t.increment},null,8,["onClick"])])}const Mn=X(Vn,[["render",An]]),Pn={props:["tickets","form"],setup(o,e){Y(()=>{y.value=!1,a.discount={},_.value=null,o.form.max_seats&&o.form.max_seats<0?(u.value=!0,d.value=-o.form.max_seats):u.value=!1});const n=x(0),t=x([]),y=x(!1),_=x(),a=oe(),f=$(),b=x(!1),u=x(!1),d=x(),m=N(()=>a.getDiscount),h=function(j){t.value[j.index]={partial_total:j.price*j.counter,ticket:j.ticket,quantity:j.counter},n.value=0;let T=0;t.value.forEach(O=>{n.value+=O.partial_total,T+=O.quantity}),u.value||(o.form.max_seats&&T>+o.form.max_seats?(d.value=T-+o.form.max_seats,b.value=!0):(d.value=null,b.value=!1)),_.value&&r()},V=function(){r()},r=async function(){let j=[];t.value.forEach(O=>{j.push({id:O.ticket.id,quantity:O.quantity})});const T={discount_code:_.value,location_permalink:o.form.location_permalink,tickets:j};await a.cost(T).then(()=>{}).catch(O=>{B(f,O)})};return{total:n,partialTotals:t,showDiscount:y,discountCode:_,discount:m,showAlert:b,showAlert2:u,numOverbooking:d,onChangeCounter:h,applyDiscount:V,checkDisabled:function(){let j=!1;(!t.value||t.value.length==0)&&(j=!0);let T=0;return t.value.forEach(O=>{T+=O.quantity}),T==0&&(j=!0),e.emit("disableSecondoTab",!0),j},nextTab:function(){const j={discount_code:_.value,partial_total:t.value};e.emit("nextTab",j)}}},components:{PlusMinusButton:Mn}};const Nn={key:0},jn={key:1},Fn={key:0},Un={key:1},En={key:0,class:"flex justify-content-between align-items-center"},Rn={class:"flex align-items-center col-9"},Bn={class:"col-7 pl-0"},In={class:"text-right col-2"},zn={class:"col-3 flex justify-content-end"},qn={key:2,class:"mt-3 mb-5"},Hn={class:"flex align-items-center justify-content-between py-0"},Kn={class:"col-9 flex"},Jn={class:"col-2 text-right font-bold"},Gn={class:"col-3 flex justify-content-end"};function Wn(o,e,n,t,y,_){const a=k("Message"),f=k("PlusMinusButton"),b=k("Button");return p(),g(te,null,[t.showAlert?(p(),Q(a,{key:0,severity:"warn",closable:!1},{default:D(()=>[E("Attenzione! Si sta andando in overbooking di "+w(t.numOverbooking)+" ",1),t.numOverbooking==1?(p(),g("span",Nn,"posto")):(p(),g("span",jn,"posti"))]),_:1})):A("",!0),t.showAlert2?(p(),Q(a,{key:1,severity:"warn",closable:!1},{default:D(()=>[E("Attenzione! Lo slot orario è già in overbooking di "+w(t.numOverbooking)+" ",1),t.numOverbooking==1?(p(),g("span",Fn,"posto")):(p(),g("span",Un,"posti"))]),_:1})):A("",!0),(p(!0),g(te,null,he(n.tickets,(u,d)=>{var m,h,V;return p(),g("div",{key:u.id},[((m=u.course)==null?void 0:m.id)==((h=n.form.course)==null?void 0:h.id)?(p(),g("div",En,[l("div",Rn,[l("b",Bn,w(u.name),1),l("div",In,"€ "+w((V=u.price)==null?void 0:V.toFixed(2)),1)]),l("div",zn,[i(f,{onChangeCounter:e[0]||(e[0]=r=>t.onChangeCounter(r)),price:u.price,index:d,ticket:u},null,8,["price","index","ticket"])])])):A("",!0)])}),128)),n.tickets&&n.tickets.length==0?(p(),g("div",qn,e[2]||(e[2]=[l("i",null,"Nessuna tipologia di biglietto trovata.",-1)]))):A("",!0),e[4]||(e[4]=l("hr",{class:"mt-3"},null,-1)),l("div",Hn,[l("div",Kn,[l("div",{class:J(["pl-0",t.discount&&t.discount.total_amount?"col-2":"col-7"])},e[3]||(e[3]=[l("b",null,"Totale",-1)]),2),l("div",Jn,"€ "+w(t.total.toFixed(2)),1)]),l("div",Gn,[i(b,{label:"Prosegui",onClick:e[1]||(e[1]=u=>t.nextTab()),disabled:t.checkDisabled()},null,8,["disabled"])])])],64)}const Qn=X(Pn,[["render",Wn]]);class Xn{static async fetchAll(){return(await Fe("/countries")).data.countries}}const Zn=we({id:"country",state:()=>({country:{},countries:[]}),getters:{allCountries:o=>o.countries},actions:{async fetchAllCountries(){await Xn.fetchAll().then(o=>this.countries=o)}}});class Yn{static async fetchAll(){return(await Fe("/provinces")).data.provinces}}const $n=we({id:"province",state:()=>({province:{},provinces:[]}),getters:{allProvinces:o=>o.provinces,getCurrentProvince:o=>o.province},actions:{async fetchAllProvinces(){await Yn.fetchAll().then(o=>this.provinces=o)}}}),el={computed:{Code(){return Code}},props:["location_permalink"],setup(o,e){Y(()=>{T(),O()});const n=xe(),t=Zn(),y=oe(),_=$n(),a=x({}),f=x(),b=x(),u=x(),d=x(),m=N(()=>t.allCountries),h=N(()=>n.allOpenTickets),V=N(()=>y.paymentStatus),r=N(()=>y.paymentModeList),s=N(()=>_.allProvinces),F=N(()=>{const R=y.getPaymentMethods;return Object.entries(R).map(([ne,L])=>({id:ne,label:L}))}),j=N(()=>y.paymentMethodAccountList),T=async function(){await t.fetchAllCountries().then(()=>{a.value.country_id=88,a.value.status={id:"payed",name:"Pagato"}})},O=async function(){await _.fetchAllProvinces()},c=async function(R){const ne={code:R.query.toUpperCase(),location_permalink:o.location_permalink};await n.fetchAllOpenTickets(ne)},S=function(){a.value.status.id&&(a.value.status.id=="free"||a.value.status.id=="to_pay")&&(a.value.payment_method=null)},C=function(){if(a.value.status&&a.value.status.id=="payed"&&a.value.open_ticket_codes){for(const R of a.value.open_ticket_codes)if(R.expired){b.value="Uno o più codici biglietto risultano scaduti";return}}if(!(a.value.amount&&(a.value.payment_method_deposit||(f.value="Seleziona un metodo di pagamento"),a.value.paid_at||(u.value="Inserisci la data di versamento dell'acconto"),f.value||u.value))){if(!a.value.payment_method){d.value="Seleziona un metodo di pagamento";return}e.emit("nextTab",a.value)}};return ae(()=>a.value.multi_payment,R=>{R&&(a.value.status={id:"to_pay",name:"Da pagare"})}),{form:a,countries:m,paymentList:V,paymentModeList:r,errorMessage:f,errorMessageVoucher:b,errorMessageDate:u,errorPaymentMethod:d,open_tickets:h,provinces:s,dynamicPaymentMethods:F,paymentMethodAccountList:j,fetchAllOpenTickets:c,onChangeStatus:S,onConfirm:C}}};const tl={key:0,class:"formgrid grid"},ol={class:"field col-6"},nl={class:"field col-6"},ll={class:"field col-6"},al={class:"field col-6"},il={class:"field col-6"},sl={class:"field col-6"},rl={class:"field col-6"},cl={class:"field col-6"},dl={key:0,class:"field col-6"},ul={class:"p-float-label mb-0"},ml={class:"p-error",id:"dd-error"},fl={key:1,class:"field col-6 flex flex-column"},pl={key:0,class:"pi pi-exclamation-triangle",style:{color:"#ff6767"}},_l={class:"p-error",id:"dd-error"},vl={class:"field col-12"},yl={key:2,class:"col-12 pl-0 flex flex-wrap"},gl={class:"field col-6 mb-0"},hl={class:"field col-6 mb-0"},bl={class:"p-float-label mb-0"},kl={class:"p-error",id:"dd-error"},Cl={class:"field col-6"},wl={class:"p-error",id:"dd-error"},xl={class:"field col-12"},Dl={class:"field flex flex-column"},Ol={class:"col-12 flex justify-content-end"};function Sl(o,e,n,t,y,_){const a=k("InputText"),f=k("Dropdown"),b=k("AutoComplete"),u=k("Checkbox"),d=k("InputNumber"),m=k("Calendar"),h=k("Textarea"),V=k("Button"),r=pe("tooltip");return t.form?(p(),g("div",tl,[l("div",ol,[e[22]||(e[22]=l("label",{for:"user_name"},"Nome",-1)),i(a,{type:"text",modelValue:t.form.user_name,"onUpdate:modelValue":e[0]||(e[0]=s=>t.form.user_name=s),class:"w-full"},null,8,["modelValue"])]),l("div",nl,[e[23]||(e[23]=l("label",{for:"user_surname"},"Cognome",-1)),i(a,{type:"text",modelValue:t.form.user_surname,"onUpdate:modelValue":e[1]||(e[1]=s=>t.form.user_surname=s),class:"w-full"},null,8,["modelValue"])]),l("div",ll,[e[24]||(e[24]=l("label",{for:"user_surname"},"Nome gruppo",-1)),i(a,{type:"text",modelValue:t.form.group_name,"onUpdate:modelValue":e[2]||(e[2]=s=>t.form.group_name=s),class:"w-full"},null,8,["modelValue"])]),l("div",al,[e[25]||(e[25]=l("label",{for:"user_email"},"Email",-1)),i(a,{type:"text",modelValue:t.form.user_email,"onUpdate:modelValue":e[3]||(e[3]=s=>t.form.user_email=s),class:"w-full"},null,8,["modelValue"])]),l("div",il,[e[26]||(e[26]=l("label",{for:"user_phone"},"Telefono",-1)),i(a,{type:"text",modelValue:t.form.user_phone,"onUpdate:modelValue":e[4]||(e[4]=s=>t.form.user_phone=s),class:"w-full"},null,8,["modelValue"])]),l("div",sl,[e[27]||(e[27]=l("label",{for:"country_id"},"Nazione",-1)),i(f,{modelValue:t.form.country_id,"onUpdate:modelValue":e[5]||(e[5]=s=>t.form.country_id=s),options:t.countries,optionLabel:"name",optionValue:"id",class:"w-full"},null,8,["modelValue","options"])]),l("div",rl,[e[28]||(e[28]=l("label",{for:"province"},"Provincia",-1)),i(f,{modelValue:t.form.user_zip,"onUpdate:modelValue":e[6]||(e[6]=s=>t.form.user_zip=s),options:t.provinces,optionLabel:"name",optionValue:"name",class:"w-full"},null,8,["modelValue","options"])]),l("div",cl,[e[29]||(e[29]=l("label",{for:"status"},"Stato pagamento",-1)),i(f,{modelValue:t.form.status,"onUpdate:modelValue":e[7]||(e[7]=s=>t.form.status=s),options:t.paymentList,optionLabel:"name",class:"w-full mb-0",onChange:e[8]||(e[8]=s=>t.onChangeStatus())},null,8,["modelValue","options"])]),t.form.status&&t.form.status.id=="payed"?(p(),g("div",dl,[e[30]||(e[30]=l("label",{for:"payment_method"},"Modalità pagamento*",-1)),l("span",ul,[i(f,{modelValue:t.form.payment_method,"onUpdate:modelValue":e[9]||(e[9]=s=>t.form.payment_method=s),options:t.dynamicPaymentMethods,optionLabel:"label",class:J(["w-full",{"p-invalid":t.errorPaymentMethod}]),disabled:t.form.status&&t.form.status.id!="payed",onChange:e[10]||(e[10]=s=>t.errorPaymentMethod=null)},null,8,["modelValue","options","disabled","class"])]),l("small",ml,w(t.errorPaymentMethod||" "),1)])):A("",!0),t.form.payment_method&&t.form.payment_method.id=="voucher"?(p(),g("div",fl,[e[31]||(e[31]=l("label",{for:"user_zip"},"Codice biglietto",-1)),i(b,{modelValue:t.form.open_ticket_codes,"onUpdate:modelValue":e[11]||(e[11]=s=>t.form.open_ticket_codes=s),suggestions:t.open_tickets,class:J(["uppercase w-full",{"p-invalid":t.errorMessageVoucher}]),onComplete:e[12]||(e[12]=s=>t.fetchAllOpenTickets(s)),emptySearchMessage:"Nessun risultato",emptySelectionMessage:"Nessun risultato",optionLabel:"code",optionValue:"code",multiple:"",onChange:e[13]||(e[13]=s=>t.errorMessageVoucher=null)},{option:D(({option:s})=>[l("span",{class:"flex flex-row justify-content-between",style:Ne({color:s.expired?"#ff6767":null})},[E(w(s.code)+" ",1),s.expired?de((p(),g("i",pl,null,512)),[[r,"Scaduto"]]):A("",!0)],4)]),_:1},8,["modelValue","suggestions","class"]),l("small",_l,w(t.errorMessageVoucher||" "),1)])):A("",!0),l("div",vl,[i(u,{modelValue:t.form.multi_payment,"onUpdate:modelValue":e[14]||(e[14]=s=>t.form.multi_payment=s),binary:!0,class:"deposit"},null,8,["modelValue"]),e[32]||(e[32]=l("label",{for:"payment_method",class:"text-sm ml-2"},"Acconto",-1))]),e[37]||(e[37]=l("div",{class:"field col-6"},null,-1)),t.form.multi_payment?(p(),g("div",yl,[l("div",gl,[e[33]||(e[33]=l("label",{for:"deposit"},"Importo acconto",-1)),i(d,{modelValue:t.form.amount,"onUpdate:modelValue":e[15]||(e[15]=s=>t.form.amount=s),inputId:"currency-germany",mode:"currency",currency:"EUR",locale:"it-IT",class:"w-full"},null,8,["modelValue"])]),l("div",hl,[e[34]||(e[34]=l("label",{for:"payment_method_deposit"},"Modalità pagamento*",-1)),l("span",bl,[i(f,{modelValue:t.form.payment_method_deposit,"onUpdate:modelValue":e[16]||(e[16]=s=>t.form.payment_method_deposit=s),options:t.dynamicPaymentMethods,optionLabel:"label",class:J(["w-full",{"p-invalid":t.errorMessage}]),onChange:e[17]||(e[17]=s=>t.errorMessage=null)},null,8,["modelValue","options","class"])]),l("small",kl,w(t.errorMessage||" "),1)]),l("div",Cl,[e[35]||(e[35]=l("label",{for:"deposit"},"Data versamento acconto*",-1)),i(m,{modelValue:t.form.paid_at,"onUpdate:modelValue":e[18]||(e[18]=s=>t.form.paid_at=s),class:J(["w-full",{"p-invalid":t.errorMessageDate}]),onChange:e[19]||(e[19]=s=>t.errorMessageDate=null)},null,8,["modelValue","class"]),l("small",wl,w(t.errorMessageDate||" "),1)])])):A("",!0),l("div",xl,[l("div",Dl,[e[36]||(e[36]=l("label",{for:"notes"},"Note",-1)),i(h,{modelValue:t.form.notes,"onUpdate:modelValue":e[20]||(e[20]=s=>t.form.notes=s),rows:"5",cols:"30"},null,8,["modelValue"])])]),l("div",Ol,[i(V,{label:"Conferma",onClick:e[21]||(e[21]=s=>t.onConfirm())})])])):A("",!0)}const Vl=X(el,[["render",Sl],["__scopeId","data-v-d0a8ab2e"]]);var Tl={root:function(e){var n=e.instance;return["p-contextmenu p-component",{"p-ripple-disabled":n.$primevue.config.ripple===!1}]},menu:"p-contextmenu-root-list",menuitem:function(e){var n=e.instance,t=e.processedItem;return["p-menuitem",{"p-menuitem-active p-highlight":n.isItemActive(t),"p-focus":n.isItemFocused(t),"p-disabled":n.isItemDisabled(t)}]},content:"p-menuitem-content",action:"p-menuitem-link",icon:"p-menuitem-icon",label:"p-menuitem-text",submenuIcon:"p-submenu-icon",submenu:"p-submenu-list",separator:"p-menuitem-separator"};je.extend({name:"contextmenu",classes:Tl});const Ll={props:["form"],setup(o,e){Y(()=>{s()});const n=x(0),t=x([]),y=x(!1),_=x(!0),a=x(),f=x([]),{showLoader:b,hideLoader:u}=me(),d=xe(),m=oe(),h=$(),V=N(()=>d.allTickets),r=N(()=>m.getCurrentOrder),s=async function(){const L={location_permalink:o.form.location_permalink,api_version:"v2",date:j(o.form.date),course_id:o.form.course.id};await d.fetchAllTickets(L).then(()=>{}).catch(z=>{B(h,z)})},F=function(L){n.value+=1,a.value=L.discount_code,t.value=Object.assign([],L.partial_total),_.value=!1},j=function(L){return ke(L).includes("Invalid")?be(L):ke(L)},T=function(L){O(L)},O=async function(L){var le,re,U,I;const z=[{start_at:o.form.hour,tickets:[]}];t.value.forEach(q=>{q.quantity!=0&&z[0].tickets.push({id:q.ticket.id,quantity:q.quantity})});let H=[];L.open_ticket_codes&&L.open_ticket_codes.forEach(q=>{H.push(q.code)});const ie={location_permalink:o.form.location_permalink,country_id:L.country_id,status:L.status.id,group_name:L.group_name,user_email:L.user_email,user_name:L.user_name,user_phone:L.user_phone,user_surname:L.user_surname,user_zip:L.user_zip,api_version:"v2",date:o.form.date?j(o.form.date):"",notes:L.notes,time_slots:z,payment_method:((le=L.payment_method)==null?void 0:le.id)||null,course_id:(U=(re=o.form)==null?void 0:re.course)==null?void 0:U.id,open_ticket_codes:H,multi_payment:L.multi_payment,payments:[]};L.multi_payment&&(L.amount&&L.payment_method_deposit?ie.payments=[{amount:L.amount,typology:"deposit",payment_method:(I=L.payment_method_deposit)==null?void 0:I.id,paid_at:be(L.paid_at)}]:ie.payments=[]),a.value&&(ie.discount_code=a.value),await m.createOrder(ie).then(()=>{n.value+=1,_.value=!0,y.value=!0}).catch(q=>{B(h,q)})},c=function(){Ce(r==null?void 0:r.value,o.form.location_permalink),e.emit("closeDialog",!0)},S=function(L){_.value=L},C=function(){Ce(r==null?void 0:r.value,o.form.location_permalink),R()},R=async function(){let L=[];if(!r.value&&!o.form.location_permalink)return;for(let H of r.value.tickets)L.push(H.order_item_id);const z={check_in:!0,order_item_ids:L,location_permalink:o.form.location_permalink};await m.checkInOrder(z).then(()=>{Z(h,{message:"Check-in registrato correttamente",error:!1}),e.emit("closeDialog",!0)}).catch(H=>{B(h,H)})},ne=function(){b();const L={location_permalink:o.form.location_permalink,order_id:r.value.id};m.sendEmail(L).then(()=>{Z(h,{message:"Email inviata correttamente al cliente",error:!1}),u(),e.emit("closeDialog",!0)}).catch(z=>{u(),B(h,z)})};return ae(r,()=>{f.value=[],r.value.tickets.forEach(L=>{const z=f.value.find(H=>H.ticket_name===L.ticket_name);if(!z)L.quantity=1,f.value.push(L);else{let H=f.value.indexOf(z);f.value[H].quantity+=1}})}),{tickets:V,active:n,partialTotals:t,showOrderDetail:y,currentOrder:r,tmp_tickets:f,showSecondTab:_,formatExplicitDate:Ue,formatDate:Ve,onNextTab:F,onConfirmPayment:T,printPDF:Se,onPrintPDF:c,onDisableSecondoTab:S,printAndCheckIn:C,sendEmail:ne}},components:{NewOrderTicketTab:Qn,NewOrderFormTab:Vl}};const Al={key:0,class:"info-box"},Ml={class:"font-medium"},Pl={class:"font-medium"},Nl={key:0,class:"capitalize"},jl={key:0,class:"flex pb-4"},Fl={class:"flex flex-column"},Ul={key:0,class:"pb-1 pr-1"},El={key:1,class:"pb-1"},Rl={class:"py-5"},Bl={class:"m-0 text-center line-height-3"},Il={key:0,class:"col-offset-3 col-6 flex justify-content-center flex-column align-items-center mt-4 order-summary"},zl={class:"flex flex-column col-12"},ql={key:0,class:"pb-1",style:{"min-width":"8rem"}},Hl={key:1,class:"pb-1"},Kl={key:2},Jl={class:"flex flex-column col-12"},Gl={key:0,class:"p-0 m-0 font-medium flex justify-content-between"},Wl={class:"pb-1"},Ql={class:"flex align-items-center justify-content-center mt-4"};function Xl(o,e,n,t,y,_){var m,h;const a=k("NewOrderTicketTab"),f=k("TabPanel"),b=k("NewOrderFormTab"),u=k("Button"),d=k("TabView");return p(),g(te,null,[n.form?(p(),g("div",Al,[l("p",Ml,[e[7]||(e[7]=l("i",{class:"pi pi-map-marker mr-3 font-medium"},null,-1)),E(w((m=n.form.course)==null?void 0:m.name),1)]),l("p",Pl,[e[8]||(e[8]=l("i",{class:"pi pi-calendar mr-3 font-medium"},null,-1)),n.form.date?(p(),g("span",Nl,w(t.formatDate((h=n.form)==null?void 0:h.date)),1)):A("",!0),E(" - "+w(n.form.hour),1)]),t.partialTotals&&t.partialTotals.length>0?(p(),g("div",jl,[e[9]||(e[9]=l("i",{class:"pi pi-ticket mr-3 font-medium mt-1"},null,-1)),l("div",Fl,[(p(!0),g(te,null,he(t.partialTotals,V=>{var r;return p(),g("p",{class:"p-0 m-0 font-medium flex justify-content-between",key:V},[V&&V.quantity!=0?(p(),g("span",Ul,w((r=V.ticket)==null?void 0:r.name),1)):A("",!0),V&&V.quantity!=0?(p(),g("span",El," x "+w(V.quantity)+" "+w(V.price),1)):A("",!0)])}),128))])])):A("",!0)])):A("",!0),i(d,{activeIndex:t.active,"onUpdate:activeIndex":e[6]||(e[6]=V=>t.active=V)},{default:D(()=>[i(f,{header:"Seleziona i biglietti",disabled:t.showOrderDetail},{default:D(()=>[i(a,{tickets:t.tickets,form:n.form,onNextTab:e[0]||(e[0]=V=>t.onNextTab(V)),onDisableSecondoTab:e[1]||(e[1]=V=>t.onDisableSecondoTab(V))},null,8,["tickets","form"])]),_:1},8,["disabled"]),i(f,{header:"Inserisci i dati",disabled:t.showSecondTab},{default:D(()=>[i(b,{onNextTab:e[2]||(e[2]=V=>t.onConfirmPayment(V)),location_permalink:n.form.location_permalink},null,8,["location_permalink"])]),_:1},8,["disabled"]),t.showOrderDetail?(p(),Q(f,{key:0,header:"Ordine completato"},{default:D(()=>{var V,r;return[l("div",Rl,[l("div",Bl,[e[10]||(e[10]=E(" Ordine ",-1)),l("b",null,w(t.currentOrder.reservation_number),1),e[11]||(e[11]=E(" registrato correttamente!",-1)),e[12]||(e[12]=l("br",null,null,-1))]),t.currentOrder?(p(),g("div",Il,[e[14]||(e[14]=l("p",{class:"my-2"},[l("b",null,"Riepilogo ordine:")],-1)),l("div",zl,[(p(!0),g(te,null,he(t.tmp_tickets,s=>(p(),g("p",{class:"p-0 m-0 font-medium flex justify-content-between flex-1",key:s},[s&&s.quantity!=0?(p(),g("span",ql,w(s.ticket_name),1)):A("",!0),s&&s.quantity!=0?(p(),g("span",Hl," x "+w(s.quantity),1)):A("",!0),s.ticket_price?(p(),g("span",Kl," € "+w((+s.ticket_price).toFixed(2)),1)):A("",!0)]))),128))]),l("div",Jl,[t.currentOrder.total?(p(),g("p",Gl,[e[13]||(e[13]=l("span",{class:"pb-1 pr-1"},"Totale ordine ",-1)),l("span",Wl,[l("b",null,"€ "+w((+((V=t.currentOrder)==null?void 0:V.total)).toFixed(2)),1)])])):A("",!0)])])):A("",!0),l("div",Ql,[i(u,{icon:"pi pi-envelope",class:"mr-3",rounted:"",outlined:"",label:"Invia biglietti",onClick:e[3]||(e[3]=s=>t.sendEmail()),disable:!((r=t.currentOrder)!=null&&r.user_email)},null,8,["disable"]),i(u,{icon:"pi pi-print",onClick:e[4]||(e[4]=s=>t.onPrintPDF()),class:"mr-3",rounted:"",outlined:"",label:"Stampa"}),i(u,{icon:"pi print-check-icon",onClick:e[5]||(e[5]=s=>t.printAndCheckIn()),class:"mr-3",rounted:"",outlined:"",label:"Stampa e Check-in"})])])]}),_:1})):A("",!0)]),_:1},8,["activeIndex"])],64)}const Zl=X(Ll,[["render",Xl]]),Yl={props:["filters","date"],setup(o,e){Y(()=>{_.value=Re(8,24),n.value=Object.assign({},o.filters)});const n=x({}),t=Ie(),y=$(),_=x(),a=x(!1),f=Te(),b=x(!1),u=N(()=>t.allCourses),d=N(()=>f.showNewOrderDialog),m=async function(){const s={location_permalink:o.filters.location_permalink,api_version:"v2"};await t.fetchAllCourses(s).catch(F=>{B(y,F)})},h=function(){f.setNewOrderDialogVisibility(!1),n.value.hour="",n.value.course=null,e.emit("onCloseDialog")},V=function(s){n.value.date=o.date,f.setNewOrderDialogVisibility(s)},r=function(){b.value=n.value.open_ticket};return ae(o.filters,()=>{if(m(),n.value=Object.assign({},o.filters),o.filters.course&&!o.filters.course.id){let s=u.value.find(F=>F.name===o.filters.course.name);s&&(n.value.course=s)}}),{courses:u,form:n,hours:_,disableForm:b,visible:a,onCloseDialog:h,updateDialog:V,onChecked:r,dialogVisible:d,dialogStore:f}},components:{NewOrderDialog:Zl}},$l={class:"formgrid grid px-0 align-items-center mt-4"},ea={key:0,class:"field flex flex-column w-full col-12"},ta={key:1,class:"field flex flex-column w-full col-12"},oa={class:"flex justify-content-end align-items-center mt-2"},na={class:"flex align-items-center justify-content-between w-full"};function la(o,e,n,t,y,_){const a=k("Dropdown"),f=k("Button"),b=k("NewOrderDialog"),u=k("Dialog"),d=k("Card");return p(),Q(d,{class:"mt-4"},{content:D(()=>[e[10]||(e[10]=l("h2",{class:"mt-1"},"Nuova prenotazione",-1)),l("div",$l,[n.filters.location_permalink?(p(),g("div",ea,[e[7]||(e[7]=l("label",{for:"typology"},"Scegli il percorso",-1)),i(a,{modelValue:t.form.course,"onUpdate:modelValue":e[0]||(e[0]=m=>t.form.course=m),options:t.courses,optionLabel:"name",disabled:t.disableForm,placeholder:""},null,8,["modelValue","options","disabled"])])):A("",!0),n.filters.location_permalink?(p(),g("div",ta,[e[8]||(e[8]=l("label",{for:"typology"},"Seleziona l'orario",-1)),i(a,{modelValue:t.form.hour,"onUpdate:modelValue":e[1]||(e[1]=m=>t.form.hour=m),options:t.hours,disabled:t.disableForm,placeholder:""},null,8,["modelValue","options","disabled"])])):A("",!0)]),l("div",oa,[i(f,{label:"Prenota",disabled:!t.form.course||!t.form.hour,onClick:e[2]||(e[2]=m=>t.updateDialog(!0))},null,8,["disabled"])]),i(u,{visible:t.dialogVisible,"onUpdate:visible":e[5]||(e[5]=m=>t.dialogVisible=m),modal:"",header:"Nuova prenotazione",style:{width:"60rem"},breakpoints:{"1199px":"75vw","575px":"90vw"},closable:!1,onHide:e[6]||(e[6]=m=>t.onCloseDialog())},{header:D(()=>[l("div",na,[e[9]||(e[9]=l("h2",null,"Nuova prenotazione",-1)),i(f,{icon:"pi pi-times",text:"",rounded:"",onClick:e[3]||(e[3]=m=>t.updateDialog(!1))})])]),default:D(()=>[i(b,{form:t.form,onCloseDialog:e[4]||(e[4]=m=>t.onCloseDialog())},null,8,["form"])]),_:1},8,["visible"])]),_:1})}const aa=X(Yl,[["render",la]]),ia={props:["location_permalink"],setup(o,e){Y(()=>{t.value.start_date=ue.local().startOf("day").toFormat("dd/MM/yyyy"),t.value.end_date=ue.local().endOf("day").toFormat("dd/MM/yyyy"),t.value.created_at="false",t.value.start_hour="00:00",t.value.end_hour="23:59"});const n=$(),t=x({}),y=_e(),{showLoader:_,hideLoader:a}=me(),f=function(){let d=Me(t.value.start_date)+" "+t.value.start_hour,m=Me(t.value.end_date)+" "+t.value.end_hour;const h={from:d,to:m,location_permalink:o.location_permalink,created_at:"false"};b(h)},b=async function(d){_(),await y.downloadReport(d).then(()=>{a(),e.emit("onSubmit")}).catch(m=>{a(),B(n,m)})};return{form:t,onSubmit:f,setDefaultIfBlank:function(){(!t.value.start_hour||t.value.start_hour=="")&&(t.value.start_hour="00:00"),(!t.value.end_hour||t.value.end_hour=="")&&(t.value.end_hour="23:59")}}},components:{Form:xt}},sa={class:"formgrid grid mt-3"},ra={class:"field col-6 flex flex-column"},ca={class:"field col-6 flex flex-column"},da={class:"flex align-items-center justify-content-end mt-6"};function ua(o,e,n,t,y,_){const a=k("Calendar"),f=k("InputMask"),b=k("Button"),u=k("Form");return p(),Q(u,{onSubmit:t.onSubmit},{default:D(()=>[l("div",sa,[l("div",ra,[e[7]||(e[7]=l("label",{from:"start_date"},"Dal",-1)),i(a,{inputId:"start_date",modelValue:t.form.start_date,"onUpdate:modelValue":e[0]||(e[0]=d=>t.form.start_date=d),dateFormat:"dd/mm/yy",manualInput:!0},null,8,["modelValue"]),e[8]||(e[8]=l("label",{from:"start_hour",class:"mt-3"},"Dalle",-1)),i(f,{id:"start_hour",modelValue:t.form.start_hour,"onUpdate:modelValue":e[1]||(e[1]=d=>t.form.start_hour=d),mask:"99:99",placeholder:"HH:mm",onBlur:e[2]||(e[2]=d=>t.setDefaultIfBlank())},null,8,["modelValue"])]),l("div",ca,[e[9]||(e[9]=l("label",{from:"end_date"},"Al",-1)),i(a,{inputId:"end_date",modelValue:t.form.end_date,"onUpdate:modelValue":e[3]||(e[3]=d=>t.form.end_date=d),dateFormat:"dd/mm/yy",manualInput:!0},null,8,["modelValue"]),e[10]||(e[10]=l("label",{from:"end_hour",class:"mt-3"},"Alle",-1)),i(f,{id:"end_hour",modelValue:t.form.end_hour,"onUpdate:modelValue":e[4]||(e[4]=d=>t.form.end_hour=d),mask:"99:99",placeholder:"HH:mm",onBlur:e[5]||(e[5]=d=>t.setDefaultIfBlank())},null,8,["modelValue"])])]),l("div",da,[i(b,{label:"Annulla",text:"",onClick:e[6]||(e[6]=d=>o.$emit("onSubmit"))}),i(b,{label:"Scarica",type:"submit"})])]),_:1},8,["onSubmit"])}const ma=X(ia,[["render",ua]]),fa={setup(){const o=x({}),e=x({}),n=x(),t=x(!1),y=oe(),_=ht(),a=_e(),f=$(),b=Te(),u=N(()=>_.currentUser),d=N(()=>a.allLocations),m=N(()=>a.getCurrentLocation),h=N(()=>y.getPaymentMethods);Y(()=>{m.value&&(o.value.location=m.value,e.value.location_permalink=m.value.permalink),r().then(()=>{V()})});const V=async function(){var C;let c={};const S=((C=m==null?void 0:m.value)==null?void 0:C.permalink)??null;S?c.location_permalink=S:c.location_permalink=d.value[0].permalink,await y.fetchPaymentMethods(c).then(()=>{}).catch(R=>{B(f,R)})},r=async function(){await a.fetchAllLocations().then(()=>{m.value||(o.value.location=d.value[0],e.value.location_permalink=d.value[0].permalink,a.updateCurrenLocation(d.value[0]))}).catch(c=>{B(f,c)})};return{filters:o,orderTable:n,order_filters:e,visibleDialog:t,user:u,locations:d,newPaymentMethods:h,fetchAllLocations:r,formatDate:Ve,onUpdateFilters:function(c){c.course?o.value.course={id:c.course}:o.value.course="",c.name?o.value.name=c.name:o.value.name="",c.hour&&(c.hour.start_at?o.value.hour=c.hour.start_at:o.value.hour=c.hour)},onUpdateNewOrderFilters:function(c){c.start_at&&(e.value.hour=c.start_at),c.course_name&&(e.value.course={name:c.course_name}),c.date&&(e.value.date=c.date),c.hour&&(e.value.hour=c.hour),c.max_seats?e.value.max_seats=c.max_seats:e.value.max_seats=null,b.setNewOrderDialogVisibility(!0)},onCloseDialog:function(){n.value.loadLazyData()},onChangeLocation:function(){e.value.location_permalink=o.value.location.permalink,a.updateCurrenLocation(o.value.location)},onCloseReportDialog:function(){t.value=!1}}},components:{CalendarFilter:gn,OrderTable:fn,OrderFilter:Sn,NewOrderCard:aa,SalesReportsDialog:ma}};const pa={class:"flex justify-content-between align-items-center"},_a={class:"field flex flex-column mt-3"},va={class:"text-xl font-medium pl-3 py-0"},ya={key:0,style:{color:"#495057"},class:"flex flex-column align-items-end"},ga={class:"capitalize text-xl"},ha={class:"flex gap-4"},ba={key:0,class:"col-3 mt-3"},ka={class:"col-9 mt-3"};function Ca(o,e,n,t,y,_){var V,r;const a=k("Button"),f=k("SalesReportsDialog"),b=k("Dialog"),u=k("CalendarFilter"),d=k("NewOrderCard"),m=k("OrderFilter"),h=k("OrderTable");return p(),g("div",null,[l("div",pa,[l("div",_a,[l("p",va,w((r=(V=t.filters)==null?void 0:V.location)==null?void 0:r.name),1)]),t.filters&&t.filters.date?(p(),g("div",ya,[l("div",null,[e[6]||(e[6]=l("i",{class:"pi pi-calendar mr-2 text-xl"},null,-1)),l("span",ga,w(t.formatDate(t.filters.date)),1)]),i(a,{label:"Report visite",link:"",class:"m-0 p-0",onClick:e[0]||(e[0]=s=>t.visibleDialog=!0),icon:"pi pi-download"}),i(b,{visible:t.visibleDialog,"onUpdate:visible":e[2]||(e[2]=s=>t.visibleDialog=s),modal:"",header:"Report visite",style:{width:"35rem"}},{default:D(()=>[i(f,{onOnSubmit:e[1]||(e[1]=s=>t.onCloseReportDialog()),location_permalink:t.filters.location.permalink},null,8,["location_permalink"])]),_:1},8,["visible"])])):A("",!0)]),l("div",ha,[t.filters.location?(p(),g("div",ba,[i(u,{filters:t.filters},null,8,["filters"]),i(d,{date:t.filters.date,filters:t.order_filters,onOnCloseDialog:e[3]||(e[3]=s=>t.onCloseDialog())},null,8,["date","filters"])])):A("",!0),l("div",ka,[i(m,{filters:t.filters,onOnSubmit:e[4]||(e[4]=s=>t.onUpdateFilters(s))},null,8,["filters"]),t.filters.date?(p(),Q(h,{key:0,filters:t.filters,ref:"orderTable",class:"mt-4",onUpdateFilters:e[5]||(e[5]=s=>t.onUpdateNewOrderFilters(s))},null,8,["filters"])):A("",!0)])])])}const Sa=X(fa,[["render",Ca]]);export{Sa as default};
